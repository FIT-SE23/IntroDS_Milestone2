\setcounter{page}{1}

\appendix
\onecolumn
\begin{center}
	\Large{\textbf{HMOE: Hypernetwork-based Mixture of Experts for Domain Generalization}} \\
	\vspace{1.0em} \Large{Supplementary Material}\\
	\vspace{2.0em}
\end{center}

\section{Toy Regression Problem}

For the toy regression problem, HMOE uses three embedding vectors of dimension $D=8$, which are initialized using the standard normal distribution. All networks of HMOE are MLPs. The featurizer is a three-layer MLP with 32 hidden units, and its input size is 1 and output size is 32. The encoder is a three-layer MLP with 32 hidden units, and its input size is 1 and output size is $D$. The classifier is a two-layer MLP with 32 hidden units, and its input size is 32 and output size is 1. The hypernetwork is a four-layer MLP with 32 hidden units, and its input size is $D$ and output size is the total number of learnable parameters (\ie, weights and biases) of the classifier. In addition, all MLPs use SiLU \cite{hendrycksGaussianErrorLinear2016} except the output layers.

\section{DomainBed}

\subsection{Description and visualization of datasets}

\begin{table}[htbp]
	\centering
	\small
	\setlength\tabcolsep{3pt}
	\begin{tabular}{cccccccccc}
		\toprule
		\textbf{Dataset} & \multicolumn{6}{c}{\textbf{Domains}}  & \textbf{\# of classes} & \textbf{\# of samples}   & \textbf{Image size}\\
		\toprule
		& \footnotesize{+90\%} & \footnotesize{+80\%} & \footnotesize{-90\%} & & & & & & \\
		ColoredMNIST \cite{arjovskyInvariantRiskMinimization2019} &
		\raisebox{-.5\height}{\includegraphics[width=25pt, height=25pt]{dataset_images/ColorMNIST_env00.1_30_idx13207_class1.png}}   &
		\raisebox{-.5\height}{\includegraphics[width=25pt, height=25pt]{dataset_images/ColorMNIST_env10.2_27_idx2676_class0.png}}    &
		\raisebox{-.5\height}{\includegraphics[width=25pt, height=25pt]{dataset_images/ColorMNIST_env20.9_25_idx16596_class1.png}}   & & & & 2 & 70,000 & (2, 28, 28) \\
		& \multicolumn{6}{l}{\footnotesize{\emph{(degree of correlation between color and label)}}} & & & \\
		& \footnotesize{0$^{\circ}$} & \footnotesize{15$^{\circ}$} & \footnotesize{30$^{\circ}$} & \footnotesize{45$^{\circ}$} & \footnotesize{60$^{\circ}$} & \footnotesize{75$^{\circ}$} & & & \\
		RotatedMNIST \cite{ghifaryDomainGeneralizationObject2015} &
		\raisebox{-.5\height}{\includegraphics[width=25pt, height=25pt]{dataset_images/RotatedMNIST_env00_15_idx1402_class9.png}}   &
		\raisebox{-.5\height}{\includegraphics[width=25pt, height=25pt]{dataset_images/RotatedMNIST_env115_6_idx1082_class9.png}}   &
		\raisebox{-.5\height}{\includegraphics[width=25pt, height=25pt]{dataset_images/RotatedMNIST_env230_16_idx9314_class9.png}}  &
		\raisebox{-.5\height}{\includegraphics[width=25pt, height=25pt]{dataset_images/RotatedMNIST_env345_5_idx4978_class9.png}}   &
		\raisebox{-.5\height}{\includegraphics[width=25pt, height=25pt]{dataset_images/RotatedMNIST_env460_2_idx1096_class9.png}}   &
		\raisebox{-.5\height}{\includegraphics[width=25pt, height=25pt]{dataset_images/RotatedMNIST_env575_41_idx6482_class9.png}}  & 10 & 70,000 & (1, 28, 28) \\
		& \footnotesize{Caltech101} & \footnotesize{LabelMe} & \footnotesize{SUN09} & \footnotesize{VOC2007} & & & & & \\
		VLCS \cite{fangUnbiasedMetricLearning2013} &
		\raisebox{-.5\height}{\includegraphics[width=25pt, height=25pt]{dataset_images/VLCS_env0Caltech101_17_idx34_class0}} &
		\raisebox{-.5\height}{\includegraphics[width=25pt, height=25pt]{dataset_images/VLCS_env1LabelMe_30_idx59_class0}} &
		\raisebox{-.5\height}{\includegraphics[width=25pt, height=25pt]{dataset_images/VLCS_env2SUN09_11_idx16_class0}} &
		\raisebox{-.5\height}{\includegraphics[width=25pt, height=25pt]{dataset_images/VLCS_env3VOC2007_6_idx219_class0}} & & & 5 & 10,729 & (3, 224, 224) \\
		& \footnotesize{Art} & \footnotesize{Cartoon} & \footnotesize{Photo} & \footnotesize{Sketch} & & & & & \\
		PACS \cite{liDeeperBroaderArtier2017} &
		\raisebox{-.5\height}{\includegraphics[width=25pt, height=25pt]{dataset_images/PACS_env0art_painting_3_idx170_class0}} &
		\raisebox{-.5\height}{\includegraphics[width=25pt, height=25pt]{dataset_images/PACS_env1cartoon_2_idx81_class0}} &
		\raisebox{-.5\height}{\includegraphics[width=25pt, height=25pt]{dataset_images/PACS_env2photo_7_idx165_class0}} &
		\raisebox{-.5\height}{\includegraphics[width=25pt, height=25pt]{dataset_images/PACS_env3sketch_7_idx516_class0}} & & & 7 & 9,991 & (3, 224, 224) \\
		& \footnotesize{Art} & \footnotesize{Clipart} & \footnotesize{Product} & \footnotesize{Photo} & & & & & \\
		OfficeHome \cite{venkateswaraDeepHashingNetwork2017} &
		\raisebox{-.5\height}{\includegraphics[width=25pt, height=25pt]{dataset_images/OfficeHome_env0Art_4_idx585_class10}} &
		\raisebox{-.5\height}{\includegraphics[width=25pt, height=25pt]{dataset_images/OfficeHome_env1Clipart_18_idx772_class10}} &
		\raisebox{-.5\height}{\includegraphics[width=25pt, height=25pt]{dataset_images/OfficeHome_env2Product_18_idx748_class10}} &
		\raisebox{-.5\height}{\includegraphics[width=25pt, height=25pt]{dataset_images/OfficeHome_env3Real_World_26_idx852_class10}} & & & 65 & 15,588 & (3, 224, 224) \\
		& \footnotesize{L100} & \footnotesize{L38} & \footnotesize{L43} & \footnotesize{L46} & & & & & \\
		TerraIncognita \cite{beeryRecognitionTerraIncognita2018} &
		\raisebox{-.5\height}{\includegraphics[width=25pt, height=25pt]{dataset_images/TerraIncognita_env0location_100_1_idx1967_class7}} &
		\raisebox{-.5\height}{\includegraphics[width=25pt, height=25pt]{dataset_images/TerraIncognita_env1location_38_11_idx7940_class7}} &
		\raisebox{-.5\height}{\includegraphics[width=25pt, height=25pt]{dataset_images/TerraIncognita_env2location_43_10_idx3571_class7}} &
		\raisebox{-.5\height}{\includegraphics[width=25pt, height=25pt]{dataset_images/TerraIncognita_env3location_46_23_idx4220_class7}} & & & 10 & 24,788 & (3, 224, 224) \\
		& \multicolumn{6}{l}{\footnotesize{\emph{(camera trap location)}}} & & & \\
	\end{tabular}
	\label{table:datasets}
	\caption{Description and visualization of datasets used in our experiments (Adapted from \cite{gulrajaniSearchLostDomain2020})}
\end{table}


\subsection{Detailed domain generalization results}
We provide the domain generalization results of each test domain for each dataset, and the best results are underlined.


%%%%%%%%%%%%%%%%%%%
% ColoredMNIST
%%%%%%%%%%%%%%%%%%%
\begin{table}[htbp]
	\centering
	\small
	\setlength\tabcolsep{5pt}
	\begin{tabular}{ccccc>{\columncolor[gray]{0.8}}c}
		\hline
		\textbf{Algorithm}  &  & \textbf{+90\%}     & \textbf{+80\%}     & \textbf{-90\%}     & \textbf{Avg} \\
		\hline
		\multicolumn{6}{c}{\emph{w/ Domain Labels}} \\
		\hline
		
		IRM      \cite{arjovskyInvariantRiskMinimization2019}            &  & 72.5            & 73.3            & 10.2            & 52.0        \\
		GroupDRO \cite{sagawaDistributionallyRobustNeural2020}           &  & 73.1            & 73.2            & 10.0            & 52.1        \\
		Mixup    \cite{yanImproveUnsupervisedDomain2020}                 &  & 72.7            & 73.4            & 10.1            & 52.1        \\
		MLDG     \cite{liLearningGeneralizeMetalearning2018}             &  & 71.5            & 73.1            & 9.8             & 51.5        \\
		CORAL    \cite{sunDeepCoralCorrelation2016}                      &  & 71.6            & 73.1            & 9.9             & 51.5        \\
		MMD      \cite{liDomainGeneralizationAdversarial2018}            &  & 71.4            & 73.1            & 9.9             & 51.5        \\
		DANN     \cite{ganinDomainadversarialTrainingNeural2016}         &  & 71.4            & 73.1            & 10.0            & 51.5        \\
		CDANN    \cite{liDeepDomainGeneralization2018}                   &  & 72.0            & 73.0            & 10.2            & 51.7        \\
		MTL      \cite{blanchardDomainGeneralizationMarginal2021}        &  & 70.9            & 72.8            & 10.5            & 51.4        \\
		ARM      \cite{zhangAdaptiveRiskMinimization2021}                &  & \underline{\textbf{82.0}}  & \underline{\textbf{76.5}}  & 10.2            & \underline{\textbf{56.2}}        \\
		VREx     \cite{kruegerOutofdistributionGeneralizationRisk2021}   &  & 72.4            & 72.9            & 10.2            & 51.8        \\
		\hline
		\multirow{3}{5em}{HMOE-DL}                                   &  MIX & 71.8            & 72.9            & 10.1            & 51.6        \\
		&  MAX & 71.9            & 73.1            & 10.1            & 51.7        \\
		&  OOD & 71.9            & 73.2            & 10.1            & 51.7        \\
		\hline
		\multicolumn{6}{c}{\emph{w/o Domain Labels}} \\
		\hline
		ERM      \cite{vapnikNatureStatisticalLearning1999}              &  & 71.7            & 72.9            & 10.0            & 51.5        \\
		RSC      \cite{huangSelfchallengingImprovesCrossdomain2020}      &  & 71.9            & 73.1            & 10.0            & 51.7        \\
		SagNet   \cite{namReducingDomainGap2021}                         &  & 71.8            & 73.0            & 10.3            & 51.7        \\
		\hline
		\multirow{3}{5em}{HMOE-DN}                                   &  MIX & 72.0            & 73.0            & \underline{\textbf{10.7}}            & 51.9        \\
		&  MAX & 72.0            & 73.0            & \underline{\textbf{10.7}}            & 51.9        \\
		&  OOD & 72.0            & 73.0            & \underline{\textbf{10.7}}            & 51.9        \\
		\hline
		\multirow{3}{5em}{HMOE-ND}                                   &  MIX & 71.6            & 73.2            & 10.1            & 51.6        \\
		&  MAX & 71.9            & 73.2            & 10.2            & 51.7        \\
		&  OOD & 71.6            & 73.5            & 10.1            & 51.7        \\
		\hline
	\end{tabular}
	\caption{Domain generalization results on ColoredMNIST}
	\label{tab:res_ColoredMNIST}
\end{table}


%%%%%%%%%%%%%%%%%%%
% RotatedMNIST
%%%%%%%%%%%%%%%%%%%
\begin{table}[htbp]
	\centering
	\small
	\setlength\tabcolsep{6pt}
	\begin{tabular}{cccccccc>{\columncolor[gray]{0.8}}c}
		\hline
		\textbf{Algorithm}  &  & \textbf{0}     & \textbf{15}     & \textbf{30}          & \textbf{45}          & \textbf{60}             & \textbf{75}             & \textbf{Avg} \\
		\hline
		\multicolumn{9}{c}{\emph{w/ Domain Labels}} \\
		\hline
		
		IRM      \cite{arjovskyInvariantRiskMinimization2019}            &  & 95.5  & 98.8  & 98.7  & 98.6  & 98.7  & 95.9  & 97.7    \\
		GroupDRO \cite{sagawaDistributionallyRobustNeural2020}           &  & 95.6  & 98.9  & 98.9  & 99.0  & 98.9  & \underline{\textbf{96.5}}  & 98.0    \\
		Mixup    \cite{yanImproveUnsupervisedDomain2020}                 &  & 95.8  & 98.9  & 98.9  & 98.9  & 98.8  & \underline{\textbf{96.5}}  & 98.0    \\
		MLDG     \cite{liLearningGeneralizeMetalearning2018}             &  & 95.8  & 98.9  & \underline{\textbf{99.0}}  & 98.9  & 99.0  & 95.8  & 97.9    \\
		CORAL    \cite{sunDeepCoralCorrelation2016}                      &  & 95.8  & 98.8  & 98.9  & 99.0  & 98.9  & 96.4  & 98.0    \\
		MMD      \cite{liDomainGeneralizationAdversarial2018}            &  & 95.6  & 98.9  & \underline{\textbf{99.0}}  & 99.0  & 98.9  & 96.0  & 97.9    \\
		DANN     \cite{ganinDomainadversarialTrainingNeural2016}         &  & 95.0  & 98.9  & \underline{\textbf{99.0}}  & 99.0  & 98.9  & 96.3  & 97.8    \\
		CDANN    \cite{liDeepDomainGeneralization2018}                   &  & 95.7  & 98.8  & 98.9  & 98.9  & 98.9  & 96.1  & 97.9    \\
		MTL      \cite{blanchardDomainGeneralizationMarginal2021}        &  & 95.6  & 99.0  & \underline{\textbf{99.0}}  & 98.9  & 99.0  & 95.8  & 97.9    \\
		ARM      \cite{zhangAdaptiveRiskMinimization2021}                &  & \underline{\textbf{96.7}}  & \underline{\textbf{99.1}}  & \underline{\textbf{99.0}}  & 99.0  & \underline{\textbf{99.1}}  & \underline{\textbf{96.5}}  & \underline{\textbf{98.2}}    \\
		VREx     \cite{kruegerOutofdistributionGeneralizationRisk2021}   &  & 95.9  & 99.0  & 98.9  & 98.9  & 98.7  & 96.2  & 97.9    \\
		\hline
		\multirow{3}{5em}{HMOE-DL}                                   &  MIX & 94.5  & 97.7  & 98.8  & 98.7  & 99.0  & 94.9  & 97.3    \\
																	 &  MAX & 94.1  & 97.9  & 98.5  & 98.5  & 98.6  & 94.7  & 97.0    \\    
																	 &  OOD & 95.0  & 97.9  & 98.6  & 98.9  & \underline{\textbf{99.1}}  & 94.7  & 97.4    \\
		\hline
		\multicolumn{9}{c}{\emph{w/o Domain Labels}}  \\
		\hline
		ERM      \cite{vapnikNatureStatisticalLearning1999}              &  & 95.9  & 98.9  & 98.8  & 98.9  & 98.9  & 96.4  & 98.0    \\
		RSC      \cite{huangSelfchallengingImprovesCrossdomain2020}      &  & 94.8  & 98.7  & 98.8  & 98.8  & 98.9  & 95.9  & 97.6    \\
		SagNet   \cite{namReducingDomainGap2021}                         &  & 95.9  & 98.9  & \underline{\textbf{99.0}}  & \underline{\textbf{99.1}}  & 99.0  & 96.3  & 98.0    \\
		\hline
		\multirow{3}{5em}{HMOE-DN}                                   &  MIX & 94.1  & 98.6  & 98.7  & 98.6  & 99.0  & 95.9  & 97.5    \\
																	 &  MAX & 94.0  & 98.6  & 98.7  & 98.6  & 98.8  & 95.9  & 97.4    \\
																	 &  OOD & 94.0  & 98.6  & 98.7  & 98.6  & 99.0  & 95.9  & 97.5    \\
		\hline
		\multirow{3}{5em}{HMOE-ND}                                   &  MIX & 94.1  & 98.6  & 98.7  & 98.6  & 99.0  & 95.9  & 97.5    \\
																	 &  MAX & 94.0  & 98.6  & 98.7  & 98.6  & 98.8  & 95.9  & 97.4    \\
																	 &  OOD & 94.0  & 98.6  & 98.7  & 98.6  & 99.0  & 95.9  & 97.5    \\
		\hline
	\end{tabular}
	\caption{Domain generalization results on RotatedMNIST}
	\label{tab:res_RotatedMNIST}
\end{table}

%%%%%%%%%%%%%%%%%%%
% VLCS
%%%%%%%%%%%%%%%%%%%
\begin{table}[htbp]
	\centering
	\small
	\setlength\tabcolsep{6pt}
	\begin{tabular}{cccccc>{\columncolor[gray]{0.8}}c}
		\hline
		\textbf{Algorithm}  &  & \textbf{Caltech101}     & \textbf{LabelMe}     & \textbf{SUN09}             & \textbf{VOC2007}             & \textbf{Avg} \\
		\hline
		\multicolumn{7}{c}{\emph{w/ Domain Labels}} \\
		\hline
		
		IRM      \cite{arjovskyInvariantRiskMinimization2019}            &  & 98.6            & 64.9            & 73.4            & 77.3            & 78.5            \\
		GroupDRO \cite{sagawaDistributionallyRobustNeural2020}           &  & 97.3            & 63.4            & 69.5            & 76.7            & 76.7            \\
		Mixup    \cite{yanImproveUnsupervisedDomain2020}                 &  & 98.3            & 64.8            & 72.1            & 74.3            & 77.4            \\
		MLDG     \cite{liLearningGeneralizeMetalearning2018}             &  & 97.4            & 65.2            & 71.0            & 75.3            & 77.2            \\
		CORAL    \cite{sunDeepCoralCorrelation2016}                      &  & 98.3            & \underline{\textbf{66.1}}            & 73.4            & \underline{\textbf{77.5}}            & \underline{\textbf{78.8}}            \\
		MMD      \cite{liDomainGeneralizationAdversarial2018}            &  & 97.7            & 64.0            & 72.8            & 75.3            & 77.5            \\
		DANN     \cite{ganinDomainadversarialTrainingNeural2016}         &  & \underline{\textbf{99.0}}            & 65.1            & 73.1            & 77.2            & 78.6            \\
		CDANN    \cite{liDeepDomainGeneralization2018}                   &  & 97.1            & 65.1            & 70.7            & 77.1            & 77.5            \\
		MTL      \cite{blanchardDomainGeneralizationMarginal2021}        &  & 97.8            & 64.3            & 71.5            & 75.3            & 77.2            \\
		ARM      \cite{zhangAdaptiveRiskMinimization2021}                &  & 98.7            & 63.6            & 71.3            & 76.7            & 77.6            \\
		VREx     \cite{kruegerOutofdistributionGeneralizationRisk2021}   &  & 98.4            & 64.4            & \underline{\textbf{74.1}}            & 76.2            & 78.3            \\
		\hline
		\multirow{3}{5em}{HMOE-DL}                                   &  MIX & 97.7            & 62.3            & 72.0            & 74.8            & 76.7            \\
																	 &  MAX & 97.0            & 63.6            & 73.2            & 76.7            & 77.6            \\
																	 &  OOD & 97.0            & 63.4            & 72.0            & 74.9            & 76.8            \\
		\hline
		\multicolumn{7}{c}{\emph{w/o Domain Labels}}  \\
		\hline
		ERM      \cite{vapnikNatureStatisticalLearning1999}              &  & 97.7            & 64.3            & 73.4            & 74.6            & 77.5            \\
		RSC      \cite{huangSelfchallengingImprovesCrossdomain2020}      &  & 97.9            & 62.5            & 72.3            & 75.6            & 77.1            \\
		SagNet   \cite{namReducingDomainGap2021}                         &  & 97.9            & 64.5            & 71.4            & \underline{\textbf{77.5}}            & 77.8            \\
		\hline
		\multirow{3}{5em}{HMOE-DN}                                   &  MIX & 97.1            & 63.8            & 71.2            & 75.1            & 76.8            \\
																	 &  MAX & 97.4            & 63.4            & 70.9            & 74.8            & 76.6            \\
																	 &  OOD & 96.4            & 62.9            & 69.3            & 74.7            & 75.8            \\
		\hline
		\multirow{3}{5em}{HMOE-ND}                                   &  MIX & 95.8            & 65.7            & 72.4            & 72.5            & 76.6            \\
																	 &  MAX & 97.3            & 61.7            & 72.1            & 76.1            & 76.8            \\
																     &  OOD & 96.9            & 61.8            & 72.0            & 76.0            & 76.7            \\
		\hline
	\end{tabular}
	\caption{Domain generalization results on VLCS}
	\label{tab:res_VLCS}
\end{table}


%%%%%%%%%%%%%%%%%%%
% PACS
%%%%%%%%%%%%%%%%%%%
\begin{table}[htbp]
	\centering
	\small
	\setlength\tabcolsep{6pt}
	\begin{tabular}{cccccc>{\columncolor[gray]{0.8}}c}
		\hline
		\textbf{Algorithm}  &  & \textbf{Art}     & \textbf{Cartoon}     & \textbf{Photo}             & \textbf{Sketch}             & \textbf{Avg} \\
		\hline
		\multicolumn{7}{c}{\emph{w/ Domain Labels}} \\
		\hline
		
		IRM      \cite{arjovskyInvariantRiskMinimization2019}            &  & 84.8       & 76.4       & 96.7       & 76.1       & 83.5                 \\
		GroupDRO \cite{sagawaDistributionallyRobustNeural2020}           &  & 83.5       & 79.1       & 96.7       & 78.3       & 84.4                 \\
		Mixup    \cite{yanImproveUnsupervisedDomain2020}                 &  & 86.1       & 78.9       & \underline{\textbf{97.6}}       & 75.8       & 84.6                 \\
		MLDG     \cite{liLearningGeneralizeMetalearning2018}             &  & 85.5       & 80.1       & 97.4       & 76.6       & 84.9                 \\
		CORAL    \cite{sunDeepCoralCorrelation2016}                      &  & 88.3       & 80.0       & 97.5       & 78.8       & 86.2                 \\
		MMD      \cite{liDomainGeneralizationAdversarial2018}            &  & 86.1       & 79.4       & 96.6       & 76.5       & 84.6                 \\
		DANN     \cite{ganinDomainadversarialTrainingNeural2016}         &  & 86.4       & 77.4       & 97.3       & 73.5       & 83.6                 \\
		CDANN    \cite{liDeepDomainGeneralization2018}                   &  & 84.6       & 75.5       & 96.8       & 73.5       & 82.6                 \\
		MTL      \cite{blanchardDomainGeneralizationMarginal2021}        &  & 87.5       & 77.1       & 96.4       & 77.3       & 84.6                 \\
		ARM      \cite{zhangAdaptiveRiskMinimization2021}                &  & 86.8       & 76.8       & 97.4       & 79.3       & 85.1                 \\
		VREx     \cite{kruegerOutofdistributionGeneralizationRisk2021}   &  & 86.0       & 79.1       & 96.9       & 77.7       & 84.9                 \\
		\hline
		\multirow{3}{5em}{HMOE-DL}                                   &  MIX & 84.1       & 77.3       & 96.3       & 76.4       & 83.5                 \\
																	 &  MAX & 82.9       & 78.6       & 95.9       & 78.1       & 83.9                 \\
																	 &  OOD & 85.0       & 78.3       & 95.3       & 79.4       & 84.5                 \\
		\hline
		\multicolumn{7}{c}{\emph{w/o Domain Labels}} \\
		\hline
		ERM      \cite{vapnikNatureStatisticalLearning1999}              &  & 84.7       & 80.8       & 97.2       & 79.3       & 85.5                 \\
		RSC      \cite{huangSelfchallengingImprovesCrossdomain2020}      &  & 85.4       & 79.7       & \underline{\textbf{97.6}}       & 78.2       & 85.2                 \\
		SagNet   \cite{namReducingDomainGap2021}                         &  & 87.4       & 80.7       & 97.1       & 80.0       & 86.3                 \\
		\hline
		\multirow{3}{5em}{HMOE-DN}                                   &  MIX & 83.9       & 82.3       & 95.0       & 77.9       & 84.8                 \\
																	 &  MAX & 84.7       & 82.4       & 96.4       & 76.9       & 85.1                 \\
																	 &  OOD & 83.9       & 80.2       & 95.6       & \underline{\textbf{80.1}}       & 84.9                 \\
		\hline
		\multirow{3}{5em}{HMOE-ND}                                   &  MIX & 88.8       & 78.9       & 96.6       & 73.9       & 84.5                 \\
																	 &  MAX & 88.8       & 82.7       & 95.7       & 79.1       & 86.6                 \\
																	 &  OOD & \underline{\textbf{88.9}}       & \underline{\textbf{84.3}}       & 95.7       & 79.0       & \underline{\textbf{87.0}}  \\
		\hline
	\end{tabular}
	\caption{Domain generalization results on PACS}
	\label{tab:res_PACS}
\end{table}


%%%%%%%%%%%%%%%%%%%
% OfficeHome
%%%%%%%%%%%%%%%%%%%
\begin{table}[htbp]
	\centering
	\small
	\setlength\tabcolsep{6pt}
	\begin{tabular}{cccccc>{\columncolor[gray]{0.8}}c}
		\hline
		\textbf{Algorithm}  &  & \textbf{Art}     & \textbf{Clipart}     & \textbf{Product}             & \textbf{Real}             & \textbf{Avg} \\
		\hline
		\multicolumn{7}{c}{\emph{w/ Domain Labels}} \\
		\hline
		
		IRM      \cite{arjovskyInvariantRiskMinimization2019}            &  & 58.9       & 52.2       & 72.1       & 74.0       & 64.3                 \\
		GroupDRO \cite{sagawaDistributionallyRobustNeural2020}           &  & 60.4       & 52.7       & 75.0       & 76.0       & 66.0                 \\
		Mixup    \cite{yanImproveUnsupervisedDomain2020}                 &  & 62.4       & \underline{\textbf{54.8}}       & \underline{\textbf{76.9}}       & 78.3       & 68.1                 \\
		MLDG     \cite{liLearningGeneralizeMetalearning2018}             &  & 61.5       & 53.2       & 75.0       & 77.5       & 66.8                 \\
		CORAL    \cite{sunDeepCoralCorrelation2016}                      &  & \underline{\textbf{65.3}}       & 54.4       & 76.5       & \underline{\textbf{78.4}}       & \underline{\textbf{68.7}}  \\
		MMD      \cite{liDomainGeneralizationAdversarial2018}            &  & 60.4       & 53.3       & 74.3       & 77.4       & 66.3                 \\
		DANN     \cite{ganinDomainadversarialTrainingNeural2016}         &  & 59.9       & 53.0       & 73.6       & 76.9       & 65.9                 \\
		CDANN    \cite{liDeepDomainGeneralization2018}                   &  & 61.5       & 50.4       & 74.4       & 76.6       & 65.8                 \\
		MTL      \cite{blanchardDomainGeneralizationMarginal2021}        &  & 61.5       & 52.4       & 74.9       & 76.8       & 66.4                 \\
		ARM      \cite{zhangAdaptiveRiskMinimization2021}                &  & 58.9       & 51.0       & 74.1       & 75.2       & 64.8                 \\
		VREx     \cite{kruegerOutofdistributionGeneralizationRisk2021}   &  & 60.7       & 53.0       & 75.3       & 76.6       & 66.4                 \\
		\hline
		\multirow{3}{5em}{HMOE-DL}                                   &  MIX & 59.5       & 50.5       & 73.6       & 75.2       & 64.7                 \\
																	 &  MAX & 58.5       & 47.7       & 72.5       & 74.1       & 63.2                 \\
																	 &  OOD & 58.6       & 49.9       & 72.8       & 73.7       & 63.7                 \\
		\hline
		\multicolumn{7}{c}{\emph{w/o Domain Labels}} \\
		\hline
		ERM      \cite{vapnikNatureStatisticalLearning1999}              &  & 61.3       & 52.4       & 75.8       & 76.6       & 66.5                 \\
		RSC      \cite{huangSelfchallengingImprovesCrossdomain2020}      &  & 60.7       & 51.4       & 74.8       & 75.1       & 65.5                 \\
		SagNet   \cite{namReducingDomainGap2021}                         &  & 63.4       & \underline{\textbf{54.8}}       & 75.8       & 78.3       & 68.1                 \\
		\hline
		\multirow{3}{5em}{HMOE-DN}                                   &  MIX & 59.4       & 52.9       & 74.6       & 74.7       & 65.4                 \\
																	 &  MAX & 60.0       & 52.1       & 74.6       & 74.9       & 65.4                 \\
																	 &  OOD & 60.2       & 52.5       & 73.6       & 74.7       & 65.3                 \\
		\hline
		\multirow{3}{5em}{HMOE-ND}                                   &  MIX & 60.0       & 52.4       & 74.3       & 75.1       & 65.5                 \\
																	 &  MAX & 60.0       & 52.4       & 73.3       & 76.3       & 65.5                 \\
																	 &  OOD & 60.0       & 54.1       & 72.8       & 75.6       & 65.6                 \\
		\hline
	\end{tabular}
	\caption{Domain generalization results on OfficeHome}
	\label{tab:res_OfficeHome}
\end{table}


%%%%%%%%%%%%%%%%%%%
% TerraIncognita
%%%%%%%%%%%%%%%%%%%
\begin{table}[htbp]
	\centering
	\small
	\setlength\tabcolsep{6pt}
	\begin{tabular}{cccccc>{\columncolor[gray]{0.8}}c}
		\hline
		\textbf{Algorithm}  &  & \textbf{L100}     & \textbf{L38}     & \textbf{L43}             & \textbf{L46}             & \textbf{Avg} \\
		\hline
		\multicolumn{7}{c}{\emph{w/ Domain Labels}} \\
		\hline
		
		IRM      \cite{arjovskyInvariantRiskMinimization2019}            &  & 54.6       & 39.8       & 56.2       & 39.6       & 47.6                 \\
		GroupDRO \cite{sagawaDistributionallyRobustNeural2020}           &  & 41.2       & 38.6       & 56.7       & 36.4       & 43.2                 \\
		Mixup    \cite{yanImproveUnsupervisedDomain2020}                 &  & \underline{\textbf{59.6}}       & 42.2       & 55.9       & 33.9       & 47.9                 \\
		MLDG     \cite{liLearningGeneralizeMetalearning2018}             &  & 54.2       & 44.3       & 55.6       & 36.9       & 47.7                 \\
		CORAL    \cite{sunDeepCoralCorrelation2016}                      &  & 51.6       & 42.2       & 57.0       & 39.8       & 47.6                 \\
		MMD      \cite{liDomainGeneralizationAdversarial2018}            &  & 41.9       & 34.8       & 57.0       & 35.2       & 42.2                 \\
		DANN     \cite{ganinDomainadversarialTrainingNeural2016}         &  & 51.1       & 40.6       & 57.4       & 37.7       & 46.7                 \\
		CDANN    \cite{liDeepDomainGeneralization2018}                   &  & 47.0       & 41.3       & 54.9       & 39.8       & 45.8                 \\
		MTL      \cite{blanchardDomainGeneralizationMarginal2021}        &  & 49.3       & 39.6       & 55.6       & 37.8       & 45.6                 \\
		ARM      \cite{zhangAdaptiveRiskMinimization2021}                &  & 49.3       & 38.3       & 55.8       & 38.7       & 45.5                 \\
		VREx     \cite{kruegerOutofdistributionGeneralizationRisk2021}   &  & 48.2       & 41.7       & 56.8       & 38.7       & 46.4                 \\
		\hline
		\multirow{3}{5em}{HMOE-DL}                                   &  MIX & 43.1       & 44.9       & 55.8       & 36.1       & 45.0                 \\
																	 &  MAX & 42.2       & 38.1       & 55.0       & 37.4       & 43.2                 \\
																	 &  OOD & 43.0       & 42.2       & 54.6       & 36.3       & 44.0                 \\
		\hline
		\rowcolor{white}
		\multicolumn{7}{c}{\emph{w/o Domain Labels}} \\
		\hline
		ERM      \cite{vapnikNatureStatisticalLearning1999}              &  & 49.8       & 42.1       & 56.9       & 35.7       & 46.1                 \\
		RSC      \cite{huangSelfchallengingImprovesCrossdomain2020}      &  & 50.2       & 39.2       & 56.3       & \underline{\textbf{40.8}}       & 46.6                 \\
		SagNet   \cite{namReducingDomainGap2021}                         &  & 53.0       & 43.0       & 57.9       & 40.4       & 48.6                 \\
		\hline
		\multirow{3}{5em}{HMOE-DN}                                   &  MIX & 54.0       & 43.6       & \underline{\textbf{58.3}}       & 38.8       & 48.7                 \\
																	 &  MAX & 54.0       & \underline{\textbf{47.0}}       & \underline{\textbf{58.3}}       & 38.8       & \underline{\textbf{49.5}}    \\
																	 &  OOD & 54.1       & 42.1       & \underline{\textbf{58.3}}       & 39.0       & 48.4                 \\
		\hline
		\multirow{3}{5em}{HMOE-ND}                                   &  MIX & 58.8       & 41.8       & 56.1       & 36.8       & 48.4                 \\
																	 &  MAX & 44.7       & 41.8       & 56.5       & 36.8       & 45.0                 \\
																	 &  OOD & 53.4       & 41.8       & 55.6       & 37.5       & 47.1                 \\
		\hline
	\end{tabular}
	\caption{Domain generalization results on TerraIncognita}
	\label{tab:res_TerraIncognita}
\end{table}
