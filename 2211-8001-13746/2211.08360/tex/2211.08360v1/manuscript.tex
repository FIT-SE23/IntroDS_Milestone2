%\documentclass[final,1p,times,onecolumn,12pt]{elsarticle}
\documentclass[final,3p,times,twocolumn]{elsarticle}

\usepackage{geometry}
\geometry{
	a4paper,
	total={170mm,257mm},
	left=12mm,
	right=12mm,
	top=10mm,
	bottom=18mm,
}

\usepackage[utf8]{inputenc}
\usepackage{graphicx}
\usepackage{float}
\usepackage{caption}
\usepackage{subcaption}

\usepackage[T1]{fontenc}
\usepackage[american]{babel}
\usepackage{fix-cm}
\usepackage{textcomp}
\usepackage{helvet}
\usepackage{float}
\usepackage{mathtools}
\usepackage{graphicx}
\usepackage{newfloat}
\usepackage{amssymb}
\usepackage[switch]{lineno}
\usepackage{epigraph}
\usepackage{parskip}
\usepackage{bm}
\usepackage{enumitem}
\usepackage{rotating}
\usepackage[svgnames]{xcolor}
%Left orientation of aligns
\makeatletter
\newcommand\flausr{\@fleqntrue}
\makeatother

%Hyperlinks (PDF-Bookmarks)
\usepackage{hyperref}
\usepackage{caption}
\DeclareCaptionType{InfoBox}

%Font color
\usepackage{color}

%Backround color of tables
\usepackage{colortbl}
\definecolor{hellgrau}{rgb}{0.9,0.9,0.9}
\definecolor{mygreen}{RGB}{28,172,0} % color values Red, Green, Blue
\definecolor{mylilas}{RGB}{170,55,241}

%Equations side by side
\usepackage{amsmath}
%Allow mathematical symbols like \mathbb{}
\usepackage{amsfonts}
%Vectorgraphics with Latex
\usepackage{tikz}
%Extended tables
\usepackage{tabularx}
%SVG
\usepackage{svg}
%Multilateral tables
\usepackage{array}
\usepackage{longtable}
%Multilateral equations
\usepackage{eqnarray}
%Pages in landscape format
\usepackage{pdflscape}
%Comment-environment
\usepackage{comment}
%Listings
\usepackage{listings}
%Verticales summarizing in tables
\usepackage{multirow}
%Units
\usepackage{units}
%Table extensions
\usepackage{booktabs}
%Pseudocode
\usepackage{varwidth}
\usepackage{algpseudocode}
\usepackage{algorithm}
%Floating
\usepackage{placeins}

\usepackage{url}
%Reference design (mainly blue)
\hypersetup{
	colorlinks=true,
	linkcolor=blue,
	filecolor=magenta,
	urlcolor=blue,
	citecolor=blue,
}
\usepackage{cleveref}
\graphicspath{ {./figures/} }
\def\BibTeX{{\rm B\kern-.05em{\sc i\kern-.025em b}\kern-.08em
		T\kern-.1667em\lower.7ex\hbox{E}\kern-.125emX}}

\makeatletter
\renewcommand{\fnum@figure}{Fig. \thefigure}
\makeatother

\newcommand*{\figref}[2][]{%
	\hyperref[{#2}]{%
		Fig.~\ref*{#2}%
		\ifx\\#1\\%
		\else
		\,#1%
		\fi
	}%
}

\newcommand*{\tabref}[2][]{%
	\hyperref[{#2}]{%
		Table~\ref*{#2}%
		\ifx\\#1\\%
		\else
		\,#1%
		\fi
	}%
}

\newtheorem{thm}{Theorem}
\newtheorem{lem}[thm]{Lemma}
\newdefinition{rmk}{Remark}
\newproof{pf}{Proof}
\newproof{pot}{Proof of Theorem \ref{thm2}}


%%Prohibit indention after new passage
\setlength{\parindent}{0pt}
\raggedbottom


%%Roman numbers
\newcommand{\RomanNumeralCaps}[1]
{\MakeUppercase{\romannumeral #1}}

%% Colored lines
\newcommand{\blueline}{\raisebox{2pt}{\tikz{\draw[-,cyan!35!blue,solid,line width = 0.9pt](0,0) -- (3mm,0);}}}
\newcommand{\orangeline}{\raisebox{2pt}{\tikz{\draw[-,yellow!30!orange,solid,line width = 0.9pt](0,0) -- (3mm,0);}}}
\newcommand{\redlinedashed}{\raisebox{2pt}{\tikz{\draw[-,red!100!orange,dashed,line width = 0.9pt](0,0) -- (3mm,0);}}}
\newcommand{\redlinedashdot}{\raisebox{2pt}{\tikz{\draw[-,red!40!orange,dash dot,line width = 0.7pt](0,0) -- (4mm,0);}}}
\newcommand{\cyanlinedashedthin}{\raisebox{2pt}{\tikz{\draw[-,cyan,dashed,line width = 0.7pt](0,0) -- (3mm,0);}}}
\newcommand{\greenlinedashedthin}{\raisebox{2pt}{\tikz{\draw[-,yellow!40!green,dashed,line width = 0.7pt](0,0) -- (3mm,0);}}}
\newcommand{\greenlinethin}{\raisebox{2pt}{\tikz{\draw[-,black!50!green,solid,line width = 0.7pt](0,0) -- (3mm,0);}}}
\newcommand{\greenlinedotted}{\raisebox{2pt}{\tikz{\draw[-,black!50!green,dotted,line width = 0.7pt](0,0) -- (3mm,0);}}}
\newcommand{\magentalinedashedthin}{\raisebox{2pt}{\tikz{\draw[-,violet,dashed,line width = 0.7pt](0,0) -- (3mm,0);}}}
\newcommand{\yellowlinedashedthin}{\raisebox{2pt}{\tikz{\draw[-,yellow!40!orange,dashed,line width = 0.7pt](0,0) -- (3mm,0);}}}
\newcommand{\bluelinethingamma}{\raisebox{2pt}{\tikz{\draw[-,cyan!70!blue,solid,line width = 0.7pt](0,0) -- (3mm,0);}}}
\newcommand{\redline}{\raisebox{2pt}{\tikz{\draw[-,red!100!orange,solid,line width = 1pt](0,0) -- (3mm,0);}}}
\newcommand{\redlinethin}{\raisebox{2pt}{\tikz{\draw[-,red!100!orange,solid,line width = 0.8pt](0,0) -- (3mm,0);}}}
\newcommand{\bluelinethin}{\raisebox{2pt}{\tikz{\draw[-,cyan!35!blue,solid,line width = 0.7pt](0,0) -- (3mm,0);}}}
\newcommand{\cyanlinethin}{\raisebox{2pt}{\tikz{\draw[-,cyan,solid,line width = 0.7pt](0,0) -- (3mm,0);}}}
\newcommand{\yellowlinethin}{\raisebox{2pt}{\tikz{\draw[-,yellow!40!orange,solid,line width = 0.7pt](0,0) -- (3mm,0);}}}
\newcommand{\magentalinethin}{\raisebox{2pt}{\tikz{\draw[-,violet!40!violet,solid,line width = 0.7pt](0,0) -- (3mm,0);}}}
\newcommand{\orangelinethin}{\raisebox{2pt}{\tikz{\draw[-,yellow!30!orange,solid,line width = 0.6pt](0,0) -- (3mm,0);}}}
\newcommand{\orangelinedashed}{\raisebox{2pt}{\tikz{\draw[-,yellow!20!orange,dashed,line width = 0.8pt](0,0) -- (3mm,0);}}}
\newcommand{\orangelinedashedthin}{\raisebox{2pt}{\tikz{\draw[-,yellow!20!orange,dashed,line width = 0.6pt](0,0) -- (3mm,0);}}}
\newcommand{\yellowline}{\raisebox{2pt}{\tikz{\draw[-,yellow!40!orange,dash dot,line width = 1pt](0,0) -- (4mm,0);}}}
\newcommand{\bluearrow}{\raisebox{2pt}{\tikz{\draw[->,blue,solid,line width = 1.5pt](0,0) -- (5mm,0);}}}
\newcommand{\rectangle}{\raisebox{0pt}{\tikz{\draw[black,solid,line width = 1.0pt](2.mm,0) rectangle (3.5mm,1.5mm);\draw[-,black,solid,line width = 1.0pt](0.,0.8mm) -- (5.5mm,0.8mm)}}}
\newcommand{\greenlinedashed}{\raisebox{2pt}{\tikz{\draw[-,black!35!green,dashed,line width = 0.8pt](0,0) -- (3mm,0);}}}
\newcommand{\brownlinedashed}{\raisebox{2pt}{\tikz{\draw[-,black!0!brown,dashed,line width = 0.8pt](0,0) -- (3mm,0);}}}
\newcommand{\purplelinedashed}{\raisebox{2pt}{\tikz{\draw[-,violet!40!violet,dashed,line width = 0.7pt](0,0) -- (3mm,0);}}}

% Deletes "Preprint submitted to Elsevier"
\makeatletter
\def\ps@pprintTitle{%
  \let\@oddhead\@empty
  \let\@evenhead\@empty
  \let\@oddfoot\@empty
  \let\@evenfoot\@oddfoot
}
\makeatother


\journal{Elsevier}
\title{An environmental disturbance observer framework for autonomous ships} %in the Context of Digital Twins}



\begin{document} 
	
\begin{frontmatter}
	
\author{Daniel~Menges\corref{cor1}\fnref{label1}}
\ead{daniel.menges@ntnu.no}
\cortext[cor1]{Corresponding author}
\author[label1]{Adil Rasheed}
\ead{adil.rasheed@ntnu.no}

\address[label1]{Norwegian University of Science and Technology, Department of Engineering Cybernetics, Trondheim, Norway}
	
	
	\begin{abstract}
		This paper proposes a robust disturbance observer framework for maritime autonomous surface ships considering model and measurement uncertainties. The core contribution lies in a nonlinear disturbance observer, reconstructing the forces on a ship impacted by the environment, such as wind, waves, and sea currents. For this purpose, mappings are found that describe global exponentially stable error dynamics by assuming slow changes of disturbances. With the stability theory of Lyapunov, it is proven that the error converges exponentially into a ball, even if the disturbances are highly dynamic. Since measurements are affected by noise and physical models can be erroneous, the measurements are filtered through an unscented Kalman filter and propagated through the proposed observer to deal with noisy measurements and inaccurate models. To investigate the capability of this observer framework, the environmental disturbances are simulated at different severity levels. The results depict the simulation of a severe, worst-case scenario consisting of highly dynamic disturbances, intense measurement noise, and an unreliable ship model. It can be seen that the observer framework accurately reconstructs the forces on a ship impacted by the environment despite using a low measurement sampling rate, an erroneous model, and uncertain measurements. 
	\end{abstract}
	
	\begin{keyword}
		Disturbance Observer \sep Autonomous Ships \sep Global Exponential Convergence \sep Measurement Uncertainties \sep Model Uncertainties
	\end{keyword}
\end{frontmatter}
\pagenumbering{arabic}
\section{Introduction}
In the existing literature, several control concepts have been proposed for path following and collision avoidance for safe navigation. In this context, a precise perception of the environment is one of the essential elements of the ship's situational awareness for safe sea operations. For example, sea currents might drift the ship away from the desired path, while the wind can affect the ship in its heading by creating a torque on the ship's hull. If control algorithms are not considering these influences \cite{Do2005}, safe and comfortable sea operations are not guaranteed. To accommodate these factors, some previous works consider the environmental impact. For instance, a disturbance observer-based control for dynamic positioning of ships is proposed in \cite{Wei2022}. The proposal assumes a constant damping matrix and considers weak disturbances, such as in \cite{Huang2015}. One of the few disturbance observers presented in \cite{Bouteraa2022} for tracking control considers model uncertainties. However, measurement uncertainties are neglected, and similar to the previously listed work, the damping matrix is oversimplified, making its use in real applications questionable. A backstepping control approach based on a disturbance observer and a neural network is presented in \cite{Duong2022}, where the ship stability concerning the roll motion is studied. Here, as well as in \cite{Xu2022}, only slowly varying disturbances are considered, while it is assumed that the measurements are entirely reliable. Despite ignoring model and measurement uncertainties, a widely used disturbance observer is presented in \cite{Do2010}. The proposal does not provide insight into the error dynamics of why it is difficult to guarantee sufficient adaptation speed regarding all observed disturbances. For this reason, synchronizing the error dynamics is a convenient way to supply controllers with consistent estimations. A detailed survey about the most popular disturbance observers is given in \cite{Gu2022}. More recently, with the advancement of data-driven modeling, machine learning approaches for observing disturbances are coming up. A disturbance observer constructed by fusion of neural networks and minimal learning parameterization is proposed in \cite{Huang2019} for robust dynamic positioning control under consideration of model and servo-system uncertainties. In \cite{Peng2021}, a data-driven adaptive disturbance observer for model-free trajectory tracking control of maritime autonomous surface ships is introduced. Common to all the data-driven approaches is that the models are trained with historical data and have a memory stack for online learning. Once again, most of such works are limited to scenarios with very weak disturbances. Since data-driven models are prone to overfitting and suffer from poor generalization outside the training scenarios, they are unfit to handling previously unseen severe and dynamic disturbances \cite{Trivedi2021}.

To summarise, none of the models demonstrate robust behavior under severe environmental conditions. Furthermore, none of the approaches consider measurement uncertainties, and the proposals disregard that measurements must be treated discretely. However, the sampling frequency of measurements is limited. Hence, this proposal tries to handle the previously described weaknesses in a novel observer framework by avoiding model simplifications but considering model and measurement uncertainties. To this end, the current work attempts to answer the following questions:

\begin{itemize}
	\item Is it possible to observe the real disturbances accurately in situations where the sampling rate of the measurements is very low? 
	\item Can we reconstruct the unknown disturbances despite measurement uncertainties? 
	\item Is it possible to reconstruct the disturbances despite an unreliable model?
	\item Can a disturbance observer be designed where we can synchronize the adaptation speed of all observed disturbances?
\end{itemize}
To the best of our knowledge, none of the previous works have addressed all the research questions mentioned in a single study. 

For a better comprehension of the work presented, the relevant theory, including the original contribution, is presented in Section \ref{sec:theory}. Section \ref{sec:methodandsetup} presents all the details required to reproduce the results presented in the article. Results and their discussions are presented in Section \ref{section: Results} and finally, Section \ref{sec:conclusionandfuturework} concludes the current work.  

\section{Theory}
\label{sec:theory}
In this section, we present a brief overview of the theory that is required for a better comprehension of the work presented. We begin by explaining the model of the ship used in Section \ref{section: Model} followed by a description of the unscented Kalman filter in Section \ref{section: UKF}. The original theoretical contribution of the work is presented in Sections \ref{section: Observerdesign} and \ref{section: Framework}.

\subsection{Model}\label{section: Model}
Considering the ship's coordinates $\boldsymbol{\eta} = [x_s,  y_s,  \psi]^\top$, where $x_s$ and $y_s$ describes the ship's position with regard to the global coordinates $[x, y]^\top$, and $\psi$ is the ship's heading. Furthermore, the velocities are denoted as $\boldsymbol{\nu} = [u,  v,  r]^\top$, where $u$ is the surge, $v$ describes the sway, and $r$ characterizes the rotational speed regarding yaw. With these relations, the kinematics of a ship can be expressed by
\begin{linenomath*}
	\begin{equation}
		\boldsymbol{\dot{\eta}}=\boldsymbol{R}_{\mathrm{rot}}(\psi)\boldsymbol{\nu},
	\end{equation}
\end{linenomath*}
where $\boldsymbol{R}_{\mathrm{rot}}(\psi)$ denotes the rotational matrix, given by
\begin{linenomath*}
	\begin{equation}
		\boldsymbol{R}_{\mathrm{rot}}(\psi)=\begin{bmatrix}
			\mathrm{cos}(\psi) && -\mathrm{sin}(\psi) && 0\\
			\mathrm{sin}(\psi) && \mathrm{cos}(\psi) && 0 \\
			0 && 0 && 1
		\end{bmatrix}.
	\end{equation}
\end{linenomath*}
\figref{fig:Ship_kinematics} depicts the relations between the different ship states.
\begin{figure}[ht]
	\centering
	\includegraphics[width=\linewidth]{ship_kinematics.pdf}
	\caption{Kinematics of a ship}
	\label{fig:Ship_kinematics}
\end{figure}

The dynamics of a ship can be expressed as
\begin{linenomath*}
	\begin{equation}
		\boldsymbol{M}\boldsymbol{\dot{\nu}}+\boldsymbol{D}(\boldsymbol{\nu})\boldsymbol{\nu}+\boldsymbol{C}(\boldsymbol{\nu})\boldsymbol{\nu}=\boldsymbol{\tau}+\boldsymbol{\tau_d}, \label{eq: dynamics}
	\end{equation}
\end{linenomath*}
where $\boldsymbol{M}$ denotes the mass matrix, $\boldsymbol{D}(\boldsymbol{\nu})$ characterizes the nonlinear damping matrix, $\boldsymbol{C}(\boldsymbol{\nu})$ describes the Coriolis matrix, $\boldsymbol{\tau}$ is the control input, and $\boldsymbol{\tau}_d$ are all the environmental disturbances. Therefore,
\begin{linenomath*}
	\begin{equation}
		\boldsymbol{\tau_d}=\boldsymbol{\tau}_{\mathrm{wind}}+\boldsymbol{\tau}_{\mathrm{wave}}+\boldsymbol{\tau}_{\mathrm{current}},
	\end{equation}
\end{linenomath*}
which implies that the disturbances are specified as the sum of forces induced by wind, waves, and sea currents.
Rewriting the dynamical expression in state space representation leads to
\begin{linenomath*}
	\begin{equation}
		\boldsymbol{\dot{\nu}} = \boldsymbol{M}^{-1}\left(-\boldsymbol{D}(\boldsymbol{\nu})\boldsymbol{\nu}-\boldsymbol{C}(\boldsymbol{\nu})\boldsymbol{\nu}+\boldsymbol{\tau}+\boldsymbol{\tau_d}\right). \label{model_equation}
	\end{equation}
\end{linenomath*}

It is assumed that the mass matrix is symmetric and positive definite.
Furthermore, the mass matrix has constant entries, defined as
\begin{linenomath*}
	\begin{equation}
		\boldsymbol{M} = \begin{bmatrix}
			m_{11} && 0 && 0\\
			0 && m_{22} && m_{23}\\
			0 && m_{32} && m_{33}
		\end{bmatrix},
	\end{equation}
\end{linenomath*}
since the mass is not dependent on the system states $\boldsymbol{\nu}$.
Based on later derivations, the entries of the inverted mass matrix are denoted as
\begin{linenomath*}
	\begin{equation}
		\boldsymbol{M}^{-1} = \begin{bmatrix}
			\kappa_{11} && 0 && 0\\
			0 && \kappa_{22} && \kappa_{23}\\
			0 && \kappa_{32} && \kappa_{33}
		\end{bmatrix}.
	\end{equation}
\end{linenomath*}



\begin{lem}
	If the matrix $\boldsymbol{M}$ is symmetric and invertible, its inverse $\boldsymbol{M}^{-1}$ is likewise symmetric, since $(\boldsymbol{M}^{-1})^\top =~(\boldsymbol{M}^\top)^{-1}$. Since the entries of the mass matrix are positive, $\boldsymbol{M}$ is positive definite, and thus invertible.
\end{lem}


Moreover, it is assumed that the damping matrix is symmetric, and the Coriolis matrix is skew-symmetric such as in \cite{Fossen2011}, given by
\begin{linenomath*}
	\begin{align}
		\boldsymbol{D}(\boldsymbol{\nu}) &= \begin{bmatrix}
			d_{11}(\boldsymbol{\nu}) && 0 && 0\\
			0 && d_{22}(\boldsymbol{\nu}) && d_{23}(\boldsymbol{\nu})\\
			0 && d_{32}(\boldsymbol{\nu}) && d_{33}(\boldsymbol{\nu})
		\end{bmatrix},\\ 
		\boldsymbol{C}(\boldsymbol{\nu}) &= \begin{bmatrix}
			0 && 0 && c_{13}(\boldsymbol{\nu})\\
			0 && 0 && c_{23}(\boldsymbol{\nu})\\
			c_{31}(\boldsymbol{\nu}) && c_{32}(\boldsymbol{\nu}) && 0
		\end{bmatrix}.
	\end{align}
\end{linenomath*}
The entries of the matrices are defined as
\begin{linenomath*}
	\begin{subequations}
		\begin{align}
			d_{11}(\boldsymbol{\nu}) &= -X_u-X_{|u|u}-X_{uuu}u^2,\\
			d_{22}(\boldsymbol{\nu}) &= -Y_v-Y_{|v|v}-Y_{|r|v}|r|-Y_{vvv}v^2,\\
			d_{23}(\boldsymbol{\nu}) &= -Y_r-Y_{|v|r}|v|-Y_{|r|r}|r|,\\
			d_{32}(\boldsymbol{\nu}) &= -N_v-N_{|v|v}|v|-N_{|r|v}|r|,\\
			d_{33}(\boldsymbol{\nu}) &= -N_r-N_{|v|r}|v|-N_{|r|r}|r|-N_{rrr}r^2,
		\end{align}
	\end{subequations}
\end{linenomath*}
and
\begin{linenomath*}
	\begin{subequations}
		\begin{align}
			c_{13}(\boldsymbol{\nu}) &= -m_{22}v-m_{23}r,\\
			c_{23}(\boldsymbol{\nu}) &= m_{11}u,\\
			c_{31}(\boldsymbol{\nu}) &= -c_{13}(\boldsymbol{\nu}),\\
			c_{32}(\boldsymbol{\nu}) &= -c_{23}(\boldsymbol{\nu}),
		\end{align}
	\end{subequations}
\end{linenomath*}
causing highly nonlinear model dynamics, where $X_u$, $X_{|u|u}$, $X_{uuu}$, $Y_v$, $Y_{|v|v}$, $Y_{|r|v}$, $Y_{vvv}$, $Y_r$, $Y_{|v|r}$, $Y_{|r|r}$, $N_v$, $N_{|v|v}$, $N_{|r|v}$, $N_r$, $N_{|v|r}$, $N_{|r|r}$, and $N_{rrr}$ are hydrodynamic parameters.

\subsection{Unscented Kalman Filter}\label{section: UKF}
The unscented Kalman filter (UKF), proposed in \cite{Julier1997}, is proved to be a very powerful tool for state estimation of nonlinear systems with measurement noise and model uncertainty. Considering the time-discrete nonlinear dynamical system
\begin{linenomath*}
	\begin{align}
		\boldsymbol{\mathrm{x}}_{k+1} &= \boldsymbol{f}(\boldsymbol{\mathrm{x}}_{k},\boldsymbol{\mathrm{w}}_{k}) \label{UKF_model},\\
		\boldsymbol{\mathrm{y}}_{k} &= \boldsymbol{g}(\boldsymbol{\mathrm{x}}_{k},\boldsymbol{\mathrm{n}}_{k}) \label{UKF_measurement},
	\end{align}
\end{linenomath*}
where $\boldsymbol{f}$ and $\boldsymbol{g}$ are non-linear functions, $\boldsymbol{\mathrm{x}}_{k}$ describes the model states, and $\boldsymbol{\mathrm{y}}_{k}$ characterizes the measurement model at timestep $k$.
The model and measurement uncertainties are modeled as Gaussian noise with zero mean. Hence, they are described by
\begin{linenomath*}
	\begin{align}
		\boldsymbol{\mathrm{w}}_{k}\sim\mathcal{N}(\boldsymbol{0},\boldsymbol{Q}_k), \label{model_noise}\\
		\boldsymbol{\mathrm{n}}_{k}\sim\mathcal{N}(\boldsymbol{0},\boldsymbol{R}_k), \label{meas_noise}
	\end{align}
\end{linenomath*}
where $\boldsymbol{Q}_k$ and $\boldsymbol{R}_k$ specify the covariance matrix of the model and measurement uncertainties, respectively. 
\\
The main idea of the UKF is to use sigma points distributed symmetrically in the area of the mean and gate them through the nonlinear functions. Assume the states $\boldsymbol{\mathrm{x}}\in \mathbb{R}^L$ have the estimated mean $\boldsymbol{\mathrm{\hat{x}}}$ and covariance $\boldsymbol{P}$, the sigma points of the entire sigma point matrix $\boldsymbol{\mathcal{X}}\in \mathbb{R}^{L\times (2L+1)}$ are generated by
\begin{linenomath*}
	\begin{subequations} 
		\begin{align}
			\boldsymbol{\mathcal{X}}_0 &= \boldsymbol{\mathrm{\hat{x}}}, \label{sigma_points1}\\
			\boldsymbol{\mathcal{X}}_i &= \boldsymbol{\mathrm{\hat{x}}} + \left(\sqrt{(L+\lambda)}\boldsymbol{P}\right)_i,\ \ \ \ \ \ i=1,...,L,\label{sigma_points2}\\
			\boldsymbol{\mathcal{X}}_i &= \boldsymbol{\mathrm{\hat{x}}} - \left(\sqrt{(L+\lambda)}\boldsymbol{P}\right)_{i-L},\ \ \ i=L+1,...,2L,\label{sigma_points3}
		\end{align}
	\end{subequations}
\end{linenomath*}
where $\lambda=\alpha^2(L+\kappa)-L$. The tuning parameter $\alpha$ describes the spread of the sigma points, usually set to $\alpha=10^{-3}$, and $\kappa$ is a secondary tuning parameter, usually set to $\kappa = 0$. The weights of each sigma point for calculating the means and covariances are defined as
\begin{linenomath*}
	\begin{align}
		&W^{m}_0 = \frac{\lambda}{L+\lambda},\\
		&W^{c}_0 = \frac{\lambda}{L+\lambda} + (1-\alpha^2+\beta),\\
		&W^{m}_i = W^{c}_i = \frac{1}{2(L+\lambda)}, \ \ \ i=1,...,2L,
	\end{align}
\end{linenomath*}
where $\beta$ is a tuning parameter, which is usually set to $\beta = 2$ for Gaussian distributions.

\textbf{Prediction step}
\\
Calculate $\boldsymbol{\mathcal{X}}$ according to \eqref{sigma_points1}-\eqref{sigma_points3}. 
Afterwards compute the following relations:
\begin{linenomath*}
	\begin{align}
		&\boldsymbol{\check{\mathrm{x}}} = \sum_{i=0}^{2L} W^{m}_i \boldsymbol{f}(\boldsymbol{\mathcal{X}}_i)\\
		&\boldsymbol{\check{\mathrm{y}}} = \sum_{i=0}^{2L} W^{m}_i \boldsymbol{g}(\boldsymbol{\mathcal{X}}_i)\\
		&\boldsymbol{P}_x = \sum_{i=0}^{2L} W^{c}_i \left(\boldsymbol{f}(\boldsymbol{\mathcal{X}}_i)-\boldsymbol{\check{\mathrm{x}}} \right)\left(\boldsymbol{f}(\boldsymbol{\mathcal{X}}_i)-\boldsymbol{\check{\mathrm{x}}} \right)^\top\\
		&\boldsymbol{P}_y = \sum_{i=0}^{2L} W^{c}_i \left(\boldsymbol{g}(\boldsymbol{\mathcal{X}}_i)-\boldsymbol{\check{\mathrm{y}}} \right)\left(\boldsymbol{g}(\boldsymbol{\mathcal{X}}_i)-\boldsymbol{\check{\mathrm{y}}} \right)^\top\\
		&\boldsymbol{P}_{xy} = \sum_{i=0}^{2L} W^{c}_i \left(\boldsymbol{f}(\boldsymbol{\mathcal{X}}_i)-\boldsymbol{\check{\mathrm{x}}} \right)\left(\boldsymbol{g}(\boldsymbol{\mathcal{X}}_i)-\boldsymbol{\check{\mathrm{y}}} \right)^\top
	\end{align}
\end{linenomath*}

\textbf{Correction step}
\begin{linenomath*}
	\begin{align}
		&\boldsymbol{K} = \boldsymbol{P}_{xy}\boldsymbol{P}_y^{-1}\\ 
		&\boldsymbol{\mathrm{\hat{x}}} = \boldsymbol{\check{\mathrm{x}}}+\boldsymbol{K}(\boldsymbol{\mathrm{y}}-\boldsymbol{\check{\mathrm{y}}})\\
		&\boldsymbol{P} = \boldsymbol{P}_x-\boldsymbol{K}\boldsymbol{P}_y\boldsymbol{P}_x
	\end{align}
\end{linenomath*}

Here, $\boldsymbol{\check{\mathrm{x}}}$ and $\boldsymbol{\check{\mathrm{y}}}$ are the predictions of the states and measurements, respectively, calculated by gating the sigma points $\boldsymbol{\mathcal{X}}$ through the nonlinear functions. The covariance matrices $\boldsymbol{P}_x$, $\boldsymbol{P}_y$, and the cross-covariance matrix $\boldsymbol{P}_{xy}$ are used for computing the updated covariance matrix $\boldsymbol{P}$ and the Kalman gain matrix $\boldsymbol{K}$. Hence, the Kalman gain matrix characterizes the trustworthiness of the predicted states $\boldsymbol{\check{\mathrm{x}}}$. If $\boldsymbol{K}$ has small values, the predictions are well-performing. Otherwise, the measurements $\boldsymbol{\mathrm{y}}$ are weighted stronger to correct the prediction inaccuracy.
As a result, the estimations $\boldsymbol{\mathrm{\hat{x}}}$ result in a smoothed version of the measurements $\boldsymbol{\mathrm{x}}_{m}$.  

\subsection{Disturbance Observer Design}\label{section: Observerdesign}
In the following, the original theoretical contribution of this article is explained. Two assumptions are made to formulate the disturbance observer.

\textbf{Assumptions:}
\begin{itemize}
	\item[1.] It is assumed that the ship's velocities $\boldsymbol{\nu}$ are measured. However, the measurements are expected to have uncertainties, described in more detail in section \ref*{section: Framework}. 
	\item[2.] It is assumed that the disturbances change slowly such that $\boldsymbol{\dot{\tau}_d} \approx \boldsymbol{0}$ holds for short time intervals.
\end{itemize}

To design the dynamical observer, we define the following relations
\begin{linenomath*}
	\begin{align}
		\boldsymbol{\hat{\tau}_d}&=\boldsymbol{\zeta} + \boldsymbol{\mu}(\boldsymbol{\nu}),\\
		\boldsymbol{\dot{\zeta}}&=\boldsymbol{h}(\boldsymbol{\nu},\boldsymbol{\hat{\tau}_d}),
	\end{align}
\end{linenomath*}
where the estimation of the disturbances $\boldsymbol{\hat{\tau}_d}$ is defined as the sum of an observer variable $\boldsymbol{\zeta}$ and an unknown mapping $\boldsymbol{\mu}(\boldsymbol{\nu})$. 
Hence, the error of the observer is defined as
\begin{linenomath*}
	\begin{equation}
		\boldsymbol{z} = \boldsymbol{\tau_d}-\boldsymbol{\zeta}-\boldsymbol{\mu}(\boldsymbol{\nu}). \label{error}
	\end{equation}
\end{linenomath*}
The dynamics of the observer variable are defined as an unknown mapping $\boldsymbol{h}(\boldsymbol{\nu},\boldsymbol{\hat{\tau}_d})$.
Therefore, the goal is to find the mappings $\boldsymbol{\mu}(\boldsymbol{\nu})$ and $\boldsymbol{h}(\boldsymbol{\nu},\boldsymbol{\hat{\tau}_d})$, such that the estimation $\boldsymbol{\hat{\tau}_d}$ has a globally, asymptotically stable equilibrium at $\boldsymbol{z}=\boldsymbol{0}$, and converges to the manifold
\begin{linenomath*}
	\begin{equation}
		\boldsymbol{\mathcal{M}}=\left\{(\boldsymbol{\nu},\boldsymbol{\zeta})\in \mathbb{R}^3\times\mathbb{R}^3: \boldsymbol{\tau_d}-\boldsymbol{\zeta} - \boldsymbol{\mu}(\boldsymbol{\nu}) = \boldsymbol{0}\right\}.
	\end{equation}
\end{linenomath*}

The error dynamics are obtained by the time derivative of \eqref{error}, yielding
\begin{linenomath*}
	\begin{equation}
		\boldsymbol{\dot{z}} = \underbrace{\boldsymbol{\dot{\tau}_d}}_{\approx\boldsymbol{0}}-\boldsymbol{\dot{\zeta}}-\frac{\partial \boldsymbol{\mu}}{\partial \boldsymbol{\nu}}\dot{\boldsymbol{\nu}},
	\end{equation}
\end{linenomath*}
which leads to  
\begin{linenomath*}
	\begin{equation}
		\boldsymbol{\dot{z}}= -\boldsymbol{h}(\boldsymbol{\nu},\boldsymbol{\hat{\tau}_d})-\frac{\partial \boldsymbol{\mu}}{\partial \boldsymbol{\nu}}\boldsymbol{M}^{-1}\left(\left(-\boldsymbol{D}(\boldsymbol{\nu})-\boldsymbol{C}(\boldsymbol{\nu})\right) + \boldsymbol{\tau} + \boldsymbol{\tau_d} \right).\label{error_dynamics}
	\end{equation}
\end{linenomath*}

\begin{rmk}
	Since the error dynamics are described by \eqref{error_dynamics}, $\boldsymbol{\mu}(\boldsymbol{\nu})$ must be differentiable with respect to $\boldsymbol{\nu}$.
\end{rmk}


To find suitable error dynamics, we define $\boldsymbol{h}(\boldsymbol{\nu},\boldsymbol{\hat{\tau}_d})$ as
\begin{linenomath*}
	\begin{equation}
		\boldsymbol{h}(\boldsymbol{\nu},\boldsymbol{\hat{\tau}_d}) =-\frac{\partial \boldsymbol{\mu}}{\partial \boldsymbol{\nu}}\boldsymbol{M}^{-1}\left(\left(-\boldsymbol{D}(\boldsymbol{\nu})-\boldsymbol{C}(\boldsymbol{\nu})\right) + \boldsymbol{\tau} + \boldsymbol{\hat{\tau}_d} \right),
	\end{equation}
\end{linenomath*}
such that the error dynamics are given by
\begin{linenomath*}
	\begin{equation}
		\boldsymbol{\dot{z}} = -\frac{\partial \boldsymbol{\mu}}{\partial \boldsymbol{\nu}}\boldsymbol{M}^{-1}(\boldsymbol{\tau_d}-\boldsymbol{\hat{\tau}_d}) = -\frac{\partial \boldsymbol{\mu}}{\partial \boldsymbol{\nu}}\boldsymbol{M}^{-1}\boldsymbol{z}.  
	\end{equation}
\end{linenomath*}
Generally, the observer dynamics $\boldsymbol{\dot{\zeta}}=\boldsymbol{h}(\boldsymbol{\nu},\boldsymbol{\hat{\tau}_d})$ are formulated as
\begin{linenomath*}
	\begin{equation}
		\boldsymbol{\dot{\zeta}} = -\frac{\partial \boldsymbol{\mu}(\boldsymbol{\nu})}{\partial \boldsymbol{\nu}}\boldsymbol{\dot{\nu}}(\boldsymbol{\tau_d}=\boldsymbol{\zeta}+\boldsymbol{\mu}(\boldsymbol{\nu})),
	\end{equation}
\end{linenomath*}
where the partial derivative $\frac{\partial \boldsymbol{\mu}(\boldsymbol{\nu})}{\partial \boldsymbol{\nu}}$ is given by
\begin{linenomath*}
	\begin{equation}
		\frac{\partial \boldsymbol{\mu}(\boldsymbol{\nu})}{\partial \boldsymbol{\nu}} = \begin{bmatrix}
			\frac{\partial \mu_1}{\partial u} && \frac{\partial \mu_1}{\partial v} && \frac{\partial \mu_1}{\partial r}\\[6pt]
			\frac{\partial \mu_2}{\partial u} && \frac{\partial \mu_2}{\partial v} && \frac{\partial \mu_2}{\partial r}\\[6pt]
			\frac{\partial \mu_3}{\partial u} && \frac{\partial \mu_3}{\partial v} && \frac{\partial \mu_3}{\partial r}
		\end{bmatrix}.
	\end{equation}
\end{linenomath*}
Considering the error dynamics, and the system dynamics, it is reasonable to define
\begin{linenomath*}
	\begin{equation}
		\boldsymbol{\mu}(\boldsymbol{\nu})=\begin{bmatrix}
			\mu_1(u)\\[6pt]
			\mu_2(v,r)\\[6pt]
			\mu_3(v,r)
		\end{bmatrix},
	\end{equation}
\end{linenomath*}
such that
\begin{linenomath*}
	\begin{equation}
		\frac{\partial \boldsymbol{\mu}(\boldsymbol{\nu})}{\partial \boldsymbol{\nu}} = \begin{bmatrix}
			\frac{\partial \mu_1}{\partial u} && 0 && 0\\[6pt]
			0 && \frac{\partial \mu_2}{\partial v} && \frac{\partial \mu_2}{\partial r}\\[6pt]
			0 && \frac{\partial \mu_3}{\partial v} && \frac{\partial \mu_3}{\partial r}
		\end{bmatrix}.
	\end{equation} 
\end{linenomath*}
With these definitions, the error dynamics yield
\begin{linenomath*}
	\begin{equation}
		\hspace{-0.7em}\resizebox{.9\hsize}{0.04\vsize}{$\boldsymbol{\dot{z}} = -\begin{bmatrix}
			\frac{\partial \mu_1}{\partial u}\kappa_{11} && 0 && 0\\[6pt]
			0 && \frac{\partial \mu_2}{\partial v}\kappa_{22}+\frac{\partial \mu_2}{\partial r}\kappa_{32} && \frac{\partial \mu_2}{\partial v}\kappa_{23}+\frac{\partial \mu_2}{\partial r}\kappa_{33} \\[6pt]
			0 &&  \frac{\partial \mu_3}{\partial v}\kappa_{22}+\frac{\partial \mu_3}{\partial r}\kappa_{32} && \frac{\partial \mu_3}{\partial v}\kappa_{23}+\frac{\partial \mu_3}{\partial r}\kappa_{33}
		\end{bmatrix}\begin{bmatrix}
			z_1\\
			z_2\\
			z_3
		\end{bmatrix}$}.
	\end{equation}
\end{linenomath*}
Regarding $z_1$, it is evident that the error dynamics are exponentially stable for every $\mu_1(u)$, which satisfies
\begin{linenomath*}
	\begin{equation}
		\frac{\partial \mu_1}{\partial u}\kappa_{11} > 0. \label{eq: inequality_gamma1}
	\end{equation}
\end{linenomath*}
To guarantee stable error dynamics concerning $z_2$ and $z_3$, we define the following conditions\footnote{An exclamation mark (!) above an equality (=) or inequality (>) sign means that the expression has to be valid to fulfill a hypothesis.}.
\begin{linenomath*}
	\begin{equation}
		\textbf{C1:}	\ \ \ \ \ \ \ \ \ \ \ \	\frac{\partial \mu_2}{\partial v}\kappa_{23}+\frac{\partial \mu_2}{\partial r}\kappa_{33} \stackrel{!}{=} 0 \label{eq: C1}
	\end{equation} 
	\begin{equation}
		\textbf{C2:}	\ \ \ \ \ \ \ \ \ \ \ \		\frac{\partial \mu_2}{\partial v}\kappa_{22}+\frac{\partial \mu_2}{\partial r}\kappa_{32} \stackrel{!}{>} 0 \label{eq: C2}
	\end{equation} 
	\begin{equation}
		\textbf{C3:}	\ \ \ \ \ \ \ \ \ \ \ \		\frac{\partial \mu_3}{\partial v}\kappa_{22}+\frac{\partial \mu_3}{\partial r}\kappa_{32} \stackrel{!}{=} 0 \label{eq: C3}
	\end{equation} 
	\begin{equation}
		\textbf{C4:}	\ \ \ \ \ \ \ \ \ \ \ \		\frac{\partial \mu_3}{\partial v}\kappa_{23}+\frac{\partial \mu_3}{\partial r}\kappa_{33} \stackrel{!}{>} 0 \label{eq: C4}
	\end{equation} 
\end{linenomath*}
Here, \textbf{C1} and \textbf{C2} guarantee stable error dynamics with regard to $z_2$, while \textbf{C3} and \textbf{C4} ensure stable error dynamics concerning $z_3$. Since \textbf{C1} and \textbf{C3} are stronger conditions, we initially define 
\begin{linenomath*}
	\begin{align}
		\mu_2(v,r) = \Gamma_2\left(\frac{1}{\kappa_{22}}v - \frac{\kappa_{23}}{\kappa_{22}\kappa_{33}}r \right),\\
		\mu_3(v,r) = \Gamma_3\left(\frac{1}{\kappa_{33}}r - \frac{\kappa_{32}}{\kappa_{22}\kappa_{33}}v \right),
	\end{align} 
\end{linenomath*}
where $\Gamma_2$ and $\Gamma_3$ are adaptive gains. With these relations, \textbf{C1} and \textbf{C3} hold. Consequential, \textbf{C2} and \textbf{C4} lead to
\begin{linenomath*}
	\begin{align}
		\Gamma_2\left(1 - \frac{\kappa_{23}\kappa_{32}}{\kappa_{22}\kappa_{33}} \right)\stackrel{!}{>} 0,\\
		\Gamma_3\left(1 - \frac{\kappa_{23}\kappa_{32}}{\kappa_{22}\kappa_{33}} \right)\stackrel{!}{>} 0.
	\end{align}
\end{linenomath*}
Hence, we must consider three cases. 
\\
\\
\textbf{Case 1:} $\kappa_{23}\kappa_{32}<\kappa_{22}\kappa_{33}$
\\
In practice, the entries of the secondary diagonal of the mass matrix are usually much smaller than the diagonal. Hence, the absolute values of $\kappa_{23}$ and $\kappa_{32}$ are also much smaller than $\kappa_{22}$ and $\kappa_{33}$. In this case \textbf{C2} and \textbf{C4} are satisfied if $\Gamma_2>0$ and $\Gamma_3>0$.
\\
\\
\textbf{Case 2:} $\kappa_{23}\kappa_{32}>\kappa_{22}\kappa_{33}$
\\
This case is usually not true. However, if this unrealistic scenario holds, \textbf{C2} and \textbf{C4} are satisfied if $\Gamma_2<0$ and $\Gamma_3<0$.
\\
\\
\textbf{Case 3:} $\kappa_{23}\kappa_{32}=\kappa_{22}\kappa_{33}$
\\
In this case, the observer will not adapt. However, this case is usually neglectable since this case is also unrealistic. 

\begin{rmk}
	Since all entries of the mass matrix are positive, $\frac{\kappa_{23}\kappa_{32}}{\kappa_{22}\kappa_{33}}$ is always positive.
\end{rmk}

For future considerations, we regard the first case. To satisfy \eqref{eq: inequality_gamma1} and to synchronize the error dynamics, we define
\begin{linenomath*}
	\begin{equation}
		\mu_1(u) = \Gamma_1\frac{1}{\kappa_{11}}u\left(1 - \frac{\kappa_{23}\kappa_{32}}{\kappa_{22}\kappa_{33}} \right). \label{eq: mu_1}
	\end{equation}
\end{linenomath*}
The previous case study also holds for \eqref{eq: mu_1} and the corresponding error dynamics of $z_1$. Therefore, $\Gamma_1>0$ must hold for practical applications.
The adaptive gains $\Gamma_1$, $\Gamma_2$, and $\Gamma_3$ define the adaptation speed. These are design parameters and have to be chosen wisely. If $\Gamma_1=\Gamma_2=\Gamma_3$, the estimations of the observed disturbances adapt with the same speed due to the defined error dynamics. Hence, this observer formulation provides a comfortable approach for synchronizing the adaptation speed. With these relations, the error dynamics of the observer are given by
\begin{linenomath*}
	\begin{align}
		\boldsymbol{\dot{z}} = -\begin{bmatrix}
			\Gamma_1\sigma && 0 && 0\\[6pt]
			0 && \Gamma_2\sigma && 0 \\[6pt]
			0 &&  0 && \Gamma_3\sigma
		\end{bmatrix}\begin{bmatrix}
			z_1\\
			z_2\\
			z_3
		\end{bmatrix},
	\end{align}
\end{linenomath*}
where $\sigma=1 - \frac{\kappa_{23}\kappa_{32}}{\kappa_{22}\kappa_{33}}$.
Denoting $\boldsymbol{T}= \frac{\partial \boldsymbol{\mu}(\boldsymbol{\nu})}{\partial \boldsymbol{\nu}}$, yields
\begin{linenomath*}
	\begin{equation}
		\boldsymbol{T}=\begin{bmatrix}
			\Gamma_1\frac{1}{\kappa_{11}}\sigma && 0 && 0\\[6pt]
			0 && \Gamma_2\frac{1}{\kappa_{22}} && -\Gamma_2 \frac{\kappa_{23}}{\kappa_{22}\kappa_{33}}\\[6pt]
			0 && -\Gamma_3 \frac{\kappa_{32}}{\kappa_{22}\kappa_{33}} &&\Gamma_3\frac{1}{\kappa_{33}}
		\end{bmatrix}.
	\end{equation}
\end{linenomath*}
Thus, the final expression of the disturbance observer is obtained by
\begin{linenomath*}
	\begin{equation}
		\boldsymbol{\hat{\tau}_d} = \boldsymbol{\zeta}+\boldsymbol{T}\boldsymbol{\nu},
	\end{equation}
\end{linenomath*}
where the observer update is given by
\begin{linenomath*}
	\begin{equation}
		\boldsymbol{\dot{\zeta}} = -\boldsymbol{T}\boldsymbol{\dot{\nu}}(\boldsymbol{\tau_d}=\boldsymbol{\zeta}+\boldsymbol{T}\boldsymbol{\nu}).
	\end{equation}
\end{linenomath*}

Considering the Lyapunov function candidate 
\begin{linenomath*}
	\begin{equation}
		V = \frac{1}{2} \boldsymbol{z}^\top \boldsymbol{z},
	\end{equation}
\end{linenomath*}
it can be shown that even if $\boldsymbol{\dot{\tau}_d} \neq 0$, the error of the disturbance observer converge exponentially into a ball with radius $r_{b} = \frac{\theta}{\sqrt{2\lambda_\mathrm{min}(\boldsymbol{\Gamma})\sigma-1}}$.
\\
\\
\\
\textbf{Proof.}~Defining the adaptive gain matrix $\boldsymbol{\Gamma}=\mathrm{diag}(\Gamma_1, \Gamma_2, \Gamma_3)$, the derivative of the Lyapunov function yields
\begin{linenomath*}
	\begin{equation}
		\dot{V} 
		= - \boldsymbol{z}^\top \boldsymbol{\Gamma}\sigma \boldsymbol{z} + \boldsymbol{z}^\top \boldsymbol{\dot{\tau}_d}. \label{Lyapunov_derivation}
	\end{equation}
\end{linenomath*}
Since
\begin{linenomath*}
	\begin{align}
		0 &\leq (\boldsymbol{z} - \boldsymbol{\dot{\tau}_d})^\top(\boldsymbol{z} - \boldsymbol{\dot{\tau}_d})\notag \\
		&= \boldsymbol{z}^\top\boldsymbol{z} - \boldsymbol{z}^\top\boldsymbol{\dot{\tau}_d} - \boldsymbol{\dot{\tau}_d}^\top\boldsymbol{z} + \boldsymbol{\dot{\tau}_d}^\top \boldsymbol{\dot{\tau}_d}\\
		&=\boldsymbol{z}^\top\boldsymbol{z} - 2\boldsymbol{z}^\top\boldsymbol{\dot{\tau}_d} + \boldsymbol{\dot{\tau}_d}^\top \boldsymbol{\dot{\tau}_d}, \notag
	\end{align}
\end{linenomath*}
\eqref{Lyapunov_derivation} leads to inequality
\begin{linenomath*}
	\begin{align}
		\dot{V} &\leq -\lambda_\mathrm{min}(\boldsymbol{\Gamma})\sigma \boldsymbol{z}^\top \boldsymbol{z} + \frac{1}{2} \boldsymbol{z}^\top \boldsymbol{z} + \frac{1}{2}\boldsymbol{\dot{\tau}_d}^\top \boldsymbol{\dot{\tau}_d}
		\\[0.5pt]
		&\leq -(2\lambda_\mathrm{min}(\boldsymbol{\Gamma})\sigma-1)V + \frac{1}{2}\theta^2, \label{ball_inequation}
	\end{align} 
\end{linenomath*}
where $\lambda_\mathrm{min}(\boldsymbol{\Gamma})$ characterizes the smallest eigenvalue of $\boldsymbol{\Gamma}$ which is likewise the smallest adaptive gain $\mathrm{min}(\Gamma_1,\Gamma_2,\Gamma_3)$, and $\theta$ denotes the maximum possible norm $||\boldsymbol{\dot{\tau}_{d,max}}||$. 
To guarantee stable behavior of \eqref{ball_inequation}, the expression
\begin{linenomath*}
	\begin{equation}
		\lambda_\mathrm{min}(\boldsymbol{\Gamma})\sigma > \frac{1}{2}
	\end{equation}
\end{linenomath*}
has to be satisfied.
The solution of \eqref{ball_inequation} is given by 
\begin{linenomath*}
	\begin{equation}
		0 \leq V(t) \leq \frac{\theta^2}{(4\lambda_\mathrm{min}(\boldsymbol{\Gamma})\sigma-2)}\left(1-e^{-(2\lambda_\mathrm{min}(\boldsymbol{\Gamma})\sigma-1)t} \right).
	\end{equation}
\end{linenomath*}
Hence, $V$ is bounded by $\frac{\theta^2}{(4\lambda_\mathrm{min}(\boldsymbol{\Gamma})\sigma-2)}$ and thus the estimation
error of the disturbance observer converges into a ball 
with radius $r_{b} = \frac{\theta}{\sqrt{2\lambda_\mathrm{min}(\boldsymbol{\Gamma})\sigma-1}}$.

\begin{rmk}
	The error analysis by using the Lyapunov approach show likewise to the previous formulations that the error converges exponentially to zero if $\theta=0$, which implies that the disturbances are constant.
\end{rmk}


\subsection{Observer Framework}\label{section: Framework}
Measurements arrive as a temporal sequence and thus have to be treated as discrete values.
Hence, the discrete measurements of the system states are defined as
\begin{linenomath*}
	\begin{equation}
		\boldsymbol{\nu}_{m,k}=\boldsymbol{\nu}_k+\boldsymbol{\mathrm{n}}_{k},
	\end{equation}
\end{linenomath*}
which expresses the measurement function \eqref{UKF_measurement} with Gaussian noise \eqref{meas_noise}.
The discretized model of \eqref{model_equation} yields
\begin{linenomath*}
	\begin{equation}
		\hspace{-0.7em}\resizebox{.9\hsize}{0.0145\vsize}{$\boldsymbol{\nu}_{k+1} = \boldsymbol{\nu}_{k} + \Delta t\left( \boldsymbol{M}^{-1}\left(\boldsymbol{\tau}_{k}+\boldsymbol{\tau_{d,k}}-\boldsymbol{D}(\boldsymbol{\nu}_{k})\boldsymbol{\nu}_{k}-\boldsymbol{C}(\boldsymbol{\nu}_{k})\boldsymbol{\nu}_{k}\right)\right)+\boldsymbol{\mathrm{w}}_{k}$},
	\end{equation}
\end{linenomath*}
where $\Delta t$ is the timestep between each measurement, and $\boldsymbol{\mathrm{w}}_{k}$ describes the model uncertainty defined in expression \eqref{model_noise}.
The discrete measurements are filtered through the UKF. Subsequently, the filtered measurements $\boldsymbol{\hat{\nu}}_k$ are used to estimate the disturbances with the discretized observer
\begin{linenomath*}
	\begin{equation}
		\boldsymbol{\hat{\tau}_{d,k}} = \boldsymbol{\zeta}_k+\boldsymbol{T}\boldsymbol{\hat{\nu}}_k,
	\end{equation}
\end{linenomath*}
where the observer update is given by
\begin{linenomath*}
	\begin{equation}
		\boldsymbol{\zeta}_{k+1} = \boldsymbol{\zeta}_k + \Delta t\left( -\boldsymbol{T}\boldsymbol{\nu}_{k+1}(\boldsymbol{\tau_{d,k}}=\boldsymbol{\zeta}_k+\boldsymbol{T}\boldsymbol{\hat{\nu}}_k)\right).
	\end{equation}
\end{linenomath*}
The entire framework is depicted in \figref{fig:Observer_Framework}. Here, $\boldsymbol{\eta}_{d,k}$ describes the desired path at timestep $k$.

\begin{figure}[H]
	\centering
	\includegraphics[width=\linewidth]{observer_framework.pdf}
	\caption{Observer framework}
	\label{fig:Observer_Framework}
\end{figure}

For traceability, in the following, pseudocode is presented. The code should give clear instructions to reconstruct the entire framework. Initialization parameters are depicted in \tabref{tab:Initialization}. Tuning parameters such as $\Gamma_1$, $\Gamma_2$, $\Gamma_3$, $\alpha$, $\beta$, and $\kappa$, used for this study, are just a recommendation. 
However, the adaptive gains should be adjusted if the sensor measurements have a lower sampling frequency. This will be discussed in more detail in section \ref*{sec: Scenario_description}.

\begin{algorithm}
	\caption{Pseudocode}
	\begin{algorithmic}[1]
		\While{$\mathrm{observation} = \mathrm{True}$}
		\State	\hspace{-0.5em}$\boldsymbol{\hat{\tau}_{d,k}} = \boldsymbol{\zeta}_k+\boldsymbol{T}\boldsymbol{\hat{\nu}}_k$
		\smallskip
		\State \hspace{-0.5em}$\boldsymbol{\zeta}_{k+1} = \boldsymbol{\zeta}_k + \Delta t\left( -\boldsymbol{T}\boldsymbol{\nu}_{k+1}(\boldsymbol{\tau_{d,k}}=\boldsymbol{\zeta}_k+\boldsymbol{T}\boldsymbol{\hat{\nu}}_k)\right)$
		\smallskip
		\State	\hspace{-0.5em}$\boldsymbol{\mathcal{X}}_{0,k} = \boldsymbol{\mathrm{\hat{\nu}}}_k$
		\State \hspace{-0.5em}$\boldsymbol{\mathcal{X}}_{i,k} = \boldsymbol{\hat{\nu}}_k + \left(\sqrt{(L+\lambda)}\boldsymbol{P}_{k}\right)_i,\ i=1,...,L$
		\State \hspace{-0.5em}$\boldsymbol{\mathcal{X}}_{i,k} = \boldsymbol{\hat{\nu}}_k - \left(\sqrt{(L+\lambda)}\boldsymbol{P}_{k}\right)_{i-L},\ i=L+1,...,2L$
		\State \hspace{-0.5em}$\boldsymbol{\check{\nu}}_k = \sum_{i=0}^{2L} W^{m}_i \boldsymbol{\nu}_{k+1}(\boldsymbol{\mathcal{X}}_{i,k})$
		\smallskip
		\State \hspace{-0.5em}$\boldsymbol{\check{\nu}}_{m,k} = \sum_{i=0}^{2L} W^{m}_i \boldsymbol{\nu}_{m,k}(\boldsymbol{\mathcal{X}}_{i,k})$
		\smallskip
		\State \hspace{-0.5em}$\boldsymbol{P}_{x,k} = \sum_{i=0}^{2L} W^{c}_i \left(\boldsymbol{\nu}_{k+1}(\boldsymbol{\mathcal{X}}_{i,k})-\boldsymbol{\check{\nu}}_k \right)\left(\boldsymbol{\nu}_{k+1}(\boldsymbol{\mathcal{X}}_{i,k})-\boldsymbol{\check{\nu}}_k \right)^\top$
		\smallskip
		\State \hspace{-0.5em}$\boldsymbol{P}_{y,k} = \sum_{i=0}^{2L} W^{c}_i \left(\boldsymbol{\nu}_{m,k}(\boldsymbol{\mathcal{X}}_{i,k})-\boldsymbol{\check{\nu}}_{m,k} \right)\left(\boldsymbol{\nu}_{m,k}(\boldsymbol{\mathcal{X}}_{i,k})-\boldsymbol{\check{\nu}}_{m,k} \right)^\top$
		\smallskip
		\State \hspace{-0.5em}$\boldsymbol{P}_{xy,k} = \sum_{i=0}^{2L} W^{c}_i \left(\boldsymbol{\nu}_{k+1}(\boldsymbol{\mathcal{X}}_{i,k})-\boldsymbol{\check{\nu}}_k \right)\left(\boldsymbol{\nu}_{m,k}(\boldsymbol{\mathcal{X}}_{i,k})-\boldsymbol{\check{\nu}}_{m,k} \right)^\top$
		\smallskip
		\State \hspace{-0.5em}$\boldsymbol{K}_k = \boldsymbol{P}_{xy,k}\boldsymbol{P}_{y,k}^{-1}$
		\smallskip
		\State \hspace{-0.5em}$\boldsymbol{\hat{\nu}}_{k+1} = \boldsymbol{\check{\nu}}_k+\boldsymbol{K}_k(\nu_{m,k}-\boldsymbol{\check{\nu}}_{m,k})$
		\smallskip
		\State \hspace{-0.5em}$\boldsymbol{P}_{k+1} = \boldsymbol{P}_{x,k}-\boldsymbol{K}_k\boldsymbol{P}_{y,k}\boldsymbol{P}_{x,k}$
		\EndWhile
	\end{algorithmic}
\end{algorithm}
\section{Method and setup} \label{sec:methodandsetup}
This study is conducted with the specifications of the milliAmpere ferry.
MilliAmpere is Norway's first driverless ferry and part of the Autoferry project of the Norwegian University of Science and Technology \cite{Brekke2022}. 

\subsection{Ferry specification} 
The hydrodynamic parameters and the entries of the mass matrix are identified in \cite{Pedersen2019} by using datasets consisting of velocity measurements $\boldsymbol{\nu}_m$ of the ship, rotational velocity measurements of the propellers, and azimuth angle measurements of the thrusters. For this purpose, techniques such as optimal control, regularization, and cross-validation are used. The identified parameters are shown in \tabref{tab: Parameters}. 

\subsection{Scenario description}\label{sec: Scenario_description}
The observer framework was tested in several scenarios corresponding to different severity levels of the environmental disturbances. However, in the current work, only the most severe scenario with model and measurement uncertainties is discussed to showcase the capability of the framework. For this purpose, the control input $\tau$ is set to zero in order to visualize the environmental impact.

\tabref{tab: Simulation parameters} provides an overview of the parametrization of the scenario, including parameters such as environmental forces and their impact angles, the covariance matrix $\boldsymbol{Q}$ of model uncertainties, the covariance matrix $\boldsymbol{R}$ of measurement uncertainties, the covariance matrix $\boldsymbol{H}$ to simulate the disturbances as a stochastic process, the observation gains $\Gamma_i$ for $i=1,2,3$, and the time step $\Delta t$ between each measurement. Note that $\boldsymbol{I}_{3\times3}$ expresses the identity matrix. 

Since the environmental forces depend on the impact surface, real data regarding wind, waves, and sea currents differs from ship to ship and is thus difficult to find. Hence, rough calculations of possible environmental forces $\bar{F}_{\mathrm{wind}}$, $\bar{F}_{\mathrm{wave}}$, and $\bar{F}_{\mathrm{current}}$ were made by the theory of \cite{Fossen2011} under consideration of storm values. Furthermore, sea current velocity values for severe situations are adopted from \cite{Wang2022}. 

Other simulations have shown that the adaptive gains $\Gamma_i$ should be adjusted to the measurement timestep $\Delta t$. A higher sampling frequency, i.e., a lower timestep, offers the possibility to increase the adaptive gains very high. However, reducing the sampling frequency results in a reciprocal effect. If the adaptive gains are improperly adjusted to the sampling frequency, the observer turns unstable. Despite that, a timestep of $\Delta t=\unit[0.1]{s}$ still enables $\Gamma_i=18$, which is absolutely sufficient for a fast adaptation.

The simulated environmental influences are defined as
\begin{linenomath*}
	\begin{subequations}
		\begin{align}
			&\boldsymbol{\tau}_{\mathrm{wind}} = \begin{bmatrix}
				\bar{F}_{\mathrm{wind}}\cos(\gamma_{\mathrm{wind}}-\psi)\left(1+\frac{1}{10}\sin(5t)\right)\\[3pt]
				-\bar{F}_{\mathrm{wind}}\sin(\gamma_{\mathrm{wind}}-\psi)\left(1+\frac{1}{10}\sin(5t)\right)\\[3pt]
				\bar{F}_{\mathrm{wind}}\sin(2(\gamma_{\mathrm{wind}}-\psi))\left(1+\frac{1}{10}\sin(5t)\right)\frac{L}{4}
			\end{bmatrix}, \label{tau_wind}\\
			&\boldsymbol{\tau}_{\mathrm{wave}} = \begin{bmatrix}
				\bar{F}_{\mathrm{wave}}\cos(\gamma_{\mathrm{wave}}-\psi)\left(1+\sin(t)\right)\\[3pt]
				-\bar{F}_{\mathrm{wave}}\sin(\gamma_{\mathrm{wave}}-\psi)\left(1+\sin(t)\right)\\[3pt]
				0
			\end{bmatrix},\\
			&\boldsymbol{\tau}_{\mathrm{current}} = \begin{bmatrix}
				\bar{F}_{\mathrm{current}}\cos(\gamma_{\mathrm{current}}-\psi)\left(1-e^{-\frac{t}{T_s}})\right)\\[3pt]
				-\bar{F}_{\mathrm{current}}\sin(\gamma_{\mathrm{current}}-\psi)\left(1-e^{-\frac{t}{T_s}})\right)\\[3pt]
				0 
			\end{bmatrix}.\label{tau_current}
		\end{align}
	\end{subequations}
\end{linenomath*}

Note that the impact angles $\gamma_i$ of wind, waves, and currents are related to the $x$-axis of the global coordinate system. Since the waves are affected by wind, they have approximately the same direction. Furthermore, it is expected that the torque induced by the environment is mainly influenced by the wind. Hence, it is assumed that the wind force in the sway direction describes the torque dependent on $\cos(\gamma_{\mathrm{wind}}-\psi)$ impacting half of the ship's length. Note that the identity $\cos(\gamma_{\mathrm{wind}}-\psi)\sin(\gamma_{\mathrm{wind}}-\psi)=\frac{1}{2}\sin(2(\gamma_{\mathrm{wind}}-\psi))$ is valid. In addition, an oscillating force is superposed to the wind's mean force in order to simulate a pulsating wind behavior. The waves are simulated as oscillating forces, where smaller waves are superposed with larger waves. It is assumed that the sea currents do not exhibit highly dynamic behavior. Therefore, they are simulated as an exponentially decaying force. 

%The forces $F_{\mathrm{wind}}$, $F_{\mathrm{wave}}$, and $F_{\mathrm{current}}$ are given by the superposed vectorial resultant of the disturbances affecting the ship in surge and sway. Hence,
%\begin{linenomath*}
%\begin{align}
%	&F_{\mathrm{wind}}=\sqrt{\tau_{\mathrm{wind},1}^2+\tau_{\mathrm{wind},2}^2},\\
%	&F_{\mathrm{wave}}=\sqrt{\tau_{\mathrm{wave},1}^2+\tau_{\mathrm{wave},2}^2},\\
%	&F_{\mathrm{current}}=\sqrt{\tau_{\mathrm{current},1}^2+\tau_{\mathrm{current},2}^2}.
%\end{align} 
%\end{linenomath*}
\section{Results and discussions}\label{section: Results}
To evaluate the sensitivity of the predicted trajectory concerning $\boldsymbol{Q}$, we conducted two simulations, one without any model uncertainty (given by \eqref{eq: dynamics}) and another with uncertainty containing covariance $\boldsymbol{Q}$. \figref{fig: Trajectory}  compares the resulting trajectories. The corresponding surge, sway, and rotational speeds are depicted in \figref{fig: States uncertainty comparison}. It can be clearly seen that an erroneous model can lead to a completely different trajectory, a problem that the observer framework has to deal with.
In \figref{fig: States}, the measured states, the real system states considering model uncertainty with covariance $\boldsymbol{Q}$, and the filtered measurements from the UKF are visualized. It is obvious that the measurements are significantly noisy, and the UKF successfully smoothens them. Furthermore, a closer look at \figref{fig: States uncertainty comparison} and \figref{fig: States} reveals that the filtered measurements from the UKF show similar behavior to the system states of the model dynamics without uncertainty. 
Using the filtered measurements of the UKF and propagating them through the proposed disturbance observer leads to accurate estimations of the real disturbances, as shown in \figref{fig: Observer}. Since the estimations are very close to the real values, a zoomed fraction is additionally depicted.
\figref{fig: Observer results stochastic} shows the results of the observer framework where the disturbances are simulated with superposed Gaussian noise containing covariance $\boldsymbol{H}$. The estimations of the observer represent a smoothed version of the noisy environmental disturbances. This characteristic could be beneficial for control concepts since actuators should not frequently peak to their limits.
The relative error of \figref{fig: Observer} concerning the maximum absolute value is showcased in \figref{fig: Error} and is represented by
\begin{linenomath*}
	\begin{equation}
		z_{r,i} = \frac{\tau_{d,i}-\hat{\tau}_{d,i}}{\max(|\tau_{d,i}|)}, \ \ \ \ \ i=1,2,3. 
	\end{equation}
\end{linenomath*}
The relation to the maximum absolute value is chosen since the relative error leads to high peaks if the zero value is crossed.
Furthermore, \figref{fig: Error} contains the comparison of simulations with various model uncertainties $\boldsymbol{Q}_1=10^3\boldsymbol{I}$, $\boldsymbol{Q}_2=10^4\boldsymbol{I}$, $\boldsymbol{Q}_3=3\cdot 10^4\boldsymbol{I}$, and $\boldsymbol{Q}_4=10^5\boldsymbol{I}$.
\figref{fig: Gamma comparison} visualize the equal adaptation speed by adjusting $\Gamma_i$ identically due to the formulation of the error dynamics of the observer. For this purpose, the disturbances $\boldsymbol{\tau_d}$ are simulated with equal behavior as an exponentially decaying process. Hence, the representation depicted in \figref{fig: Gamma comparison} is independent of the chosen simulation scenario. It can be seen that a synchronization of the observed disturbances is guaranteed. This property might be beneficial since controllers can be supplied with consistent estimations.

\begin{figure}[H]
	\centering
	\includegraphics[width=0.8\linewidth]{trajectory.pdf}
	\caption{Trajectories with (\protect\blueline), and without (\protect\orangeline) model uncertainty for the time interval $t_{\mathrm{end}}-t_0=\unit[200]{s}$. This figure shows how unreliable the considered model dynamics are.}
	\label{fig: Trajectory}
\end{figure}
\begin{figure*}
	\centering
	\begin{subfigure}{0.3\linewidth}
		\includegraphics[width=\linewidth]{states_uncertainty_comparison_a.pdf} 
		\caption{surge}
	\end{subfigure}
	\begin{subfigure}{0.3\linewidth}
		\includegraphics[width=\linewidth]{states_uncertainty_comparison_b.pdf} 
		\caption{sway}
	\end{subfigure}
	\begin{subfigure}{0.3\linewidth}
		\includegraphics[width=\linewidth]{states_uncertainty_comparison_c.pdf}
		\caption{rotational speed}
	\end{subfigure}
	\caption{States with $\boldsymbol{Q}$ (\protect\bluelinethin), and without model uncertainty (\protect\orangelinethin).}
	\label{fig: States uncertainty comparison}
	\vspace{-10mm}
\end{figure*}
\begin{figure*}
	\centering
	\begin{subfigure}{0.3\linewidth}
		\includegraphics[width=\linewidth]{states_a.pdf} 
		\caption{surge}
	\end{subfigure}
	\begin{subfigure}{0.3\linewidth}
		\includegraphics[width=\linewidth]{states_b.pdf} 
		\caption{sway}
	\end{subfigure}
	\begin{subfigure}{0.3\linewidth}
		\includegraphics[width=\linewidth]{states_c.pdf} 
		\caption{rotational speed}
	\end{subfigure}
	\caption{Measured states with measurement noise (\protect\orangelinethin), real states (\protect\bluelinethin), and the filtered states from the UKF (\protect\greenlinethin).}
	\label{fig: States}
	\vspace{-10mm}
\end{figure*}
\begin{figure*}
	\centering
	\begin{subfigure}{0.475\linewidth}
		\includegraphics[width=\linewidth]{observer_a.pdf}
		\caption{observed disturbances concerning surge}
	\end{subfigure}
	\begin{subfigure}{0.475\linewidth}
		\includegraphics[width=\linewidth]{observer_b.pdf}
		\caption{observed disturbances concerning sway}
	\end{subfigure}\\
	\begin{subfigure}{0.475\linewidth}
		\includegraphics[width=\linewidth]{observer_c.pdf}
		\caption{observed disturbances concerning rotational speed}
	\end{subfigure}
	\begin{subfigure}{0.475\linewidth}
		\includegraphics[width=\linewidth]{observer_d.pdf}
		\caption{fraction of the observed disturbance $\tau_{d,2}$}
	\end{subfigure}
	\caption{Observed disturbances $\boldsymbol{\hat{\tau}_d}$ (\protect\redlinedashed) compared to the real disturbances $\boldsymbol{\tau_d}$ (\protect\bluelinethin).}
	\label{fig: Observer}
	\vspace{-10mm}
\end{figure*}
\begin{figure*}
	\centering
	\begin{subfigure}{0.3\linewidth}
		\includegraphics[width=\linewidth]{observer_stoch_a.pdf}
		\caption{observed disturbances concerning $u$}
	\end{subfigure}
	\begin{subfigure}{0.3\linewidth}
		\includegraphics[width=\linewidth]{observer_stoch_b.pdf} 
		\caption{observed disturbances concerning $v$}
	\end{subfigure}
	\begin{subfigure}{0.3\linewidth}
		\includegraphics[width=\linewidth]{observer_stoch_c.pdf}
		\caption{observed disturbances concerning $r$}
	\end{subfigure}
	\caption{Observed disturbances $\boldsymbol{\hat{\tau}_d}$ (\protect\redlinethin) compared to the real disturbances $\boldsymbol{\tau_d}$ (\protect\bluelinethin). Here, the real disturbances are additionally simulated with superposed Gaussian noise containing covariance $\boldsymbol{H}$.}
	\label{fig: Observer results stochastic}
	\vspace{-10mm}
\end{figure*}
\begin{figure*}
	\centering
	\begin{subfigure}{0.475\linewidth}
		\includegraphics[width=\linewidth]{error_a.pdf}
		\caption{relative error concerning surge}
	\end{subfigure}
	\begin{subfigure}{0.475\linewidth}
		\includegraphics[width=\linewidth]{error_b.pdf} 
		\caption{relative error concerning sway}
	\end{subfigure}\\
	\begin{subfigure}{0.475\linewidth}
		\includegraphics[width=\linewidth]{error_c.pdf} 
		\caption{relative error concerning rotational speed}
	\end{subfigure}
	\begin{subfigure}{0.475\linewidth}
		\includegraphics[width=\linewidth]{error_d.pdf} 
		\caption{fraction of the relative error $z_{r,3}$}
	\end{subfigure}
	\caption{Relative Error of the observer framework for different model uncertainties with respect to the maximum absolute value. The uncertainties are scaled as $\boldsymbol{Q}_1$~(\protect\bluelinethin), $\boldsymbol{Q}_2$~(\protect\redlinedashdot), $\boldsymbol{Q}_3$~(\protect\orangelinedashedthin), and $\boldsymbol{Q}_4$~(\protect\greenlinedotted).}
	\label{fig: Error}
	\vspace{-10mm}
\end{figure*}
\begin{figure*}
	\centering
	\begin{subfigure}{0.475\linewidth}
		\includegraphics[width=\linewidth]{gamma_comparison_a.pdf} 
		\caption{observed disturbances concerning surge}
	\end{subfigure}
	\begin{subfigure}{0.475\linewidth}
		\includegraphics[width=\linewidth]{gamma_comparison_b.pdf}
		\caption{observed disturbances concerning sway}
	\end{subfigure}\\
	\begin{subfigure}{0.475\linewidth}
		\includegraphics[width=\linewidth]{gamma_comparison_c.pdf} 
		\caption{observed disturbances concerning rotational speed}
	\end{subfigure}
	\begin{subfigure}{0.475\linewidth}
		\includegraphics[width=\linewidth]{gamma_comparison_d.pdf} 
		\caption{fraction of the observed disturbance $\tau_{d,2}$}
	\end{subfigure}
	\caption{Comparison of different $\Gamma_i$, for $i=1,2,3$ with $\Gamma_i = 0.01$ (\protect\greenlinedashed), $\Gamma_i = 0.1$ (\protect\orangelinedashed), $\Gamma_i = 1$ (\protect\brownlinedashed), $\Gamma_i = 10$ (\protect\purplelinedashed), $\Gamma_i = 30$ (\protect\redlinedashed), and the real disturbances (\protect\bluelinethin). This simulation is designed such that all disturbances represent equal behavior for the purpose of better comparability. Here, it is shown that the designed observer allows a convenient adjustment of the adaptive gains.}
	\label{fig: Gamma comparison}
\end{figure*}
\newpage
\section{Conclusion}
\label{sec:conclusionandfuturework}
The proposed disturbance observer framework proved its capability for precisely reconstructing the environmental impact of wind, waves, and sea currents despite an unreliable model and highly noisy measurements. The main takeaway from the current work can be itemized as follows:

\begin{itemize}
	
	\item Under consideration of a discrete, temporal sequence of measurements, the framework can accurately observe the real disturbances despite very low sampling rates. 
	\item The Unscented Kalman Filter (UKF) smoothens the noisy measurements. Subsequently, the smoothed measurements are propagated through the disturbance observer. As a result, the observed disturbances have no noisy characteristics. This property might be beneficial for controllers since triggering actuators frequently to their limits has a corrosive character.
	\item Since the UKF also smoothes model uncertainties, the observer framework correctly reconstructs the disturbances despite using an erroneous model.
	\item The formulation of the observer's error dynamics allows the user a convenient approach for synchronizing the adaptation speed concerning the observed disturbances. 
\end{itemize}


\section*{Acknowledgments}
This work is part of SFI AutoShip, an 8-year research-based innovation center. 
In addition, this research project is integrated into the PERSEUS doctoral program. 
We want to thank our partners, including the Research Council of Norway, under project number 309230, and the European Unions Horizon 2020 research and innovation program under the Marie Skodowska-Curie grant agreement number 101034240.
\bibliographystyle{elsarticle-num} 
\bibliography{manuscript}
\section*{Appendix}
\begin{table}[H]
	\centering
	\caption{Initialization}
	\label{tab:Initialization}
	\begin{tabular}{ll}
		\toprule[1.5pt]
		\bf Parameter & \bf Value \\
		\midrule
		$\boldsymbol{\hat{\nu}}_0$ & $E[\boldsymbol{\nu}_0]$ \\
		$P_{\mathrm{init}}$ & $0.1$ \\
		$\boldsymbol{P}_0$ & $P_{\mathrm{init}}\cdot\mathrm{eye}(L,L)$ \\
		$\Gamma_1$ & $50$ \\
		$\Gamma_2$ & $50$ \\
		$\Gamma_3$ & $50$ \\
		$\boldsymbol{\zeta}_0$ & $\mathrm{zeros}(L,1)$ \\
		$\alpha$ & $10^{-3}$ \\
		$\beta$ & $2$ \\
		$\kappa$ & $0$ \\
		\bottomrule
	\end{tabular}
\end{table}

\begin{table}[H]
	\centering
	\caption{Values and units of the parameters of the milliAmpere ferry}
	\label{tab: Parameters}
	\begin{tabular}{lll | lll}
		\toprule[1.5pt]
		{\bf Par} & {\bf Value} & {\bf Unit} & {\bf Par} & {\bf Value} & {\bf Unit}\\
		\midrule
		$m_{11}$ & 2389.657 &\unit{kg}  & $m_{22}$ & 2533.911 &\unit{kg} \\
		$m_{23}$ & 62.386 &\unit{kg}    & $m_{32}$ & 28.141 &\unit{kg} \\
		$m_{33}$ & 5068.910 &\unit{$\mathrm{kg \cdot m^2}$} & $X_u$ & -27.632 &\unit{$\frac{kg}{s}$}\\
		$X_{|u|u}$& -110.064 &\unit{$\frac{kg}{s}$} & $X_{uuu}$& -13.965 &\unit{$\frac{kg}{s}$} \\
		$Y_v$& -52.947 &\unit{$\frac{kg}{s}$} &	$Y_{|v|v}$ & -116.486 &\unit{$\frac{kg}{s}$}\\
		$Y_{vvv}$& -24.313 &\unit{$\frac{kg}{s}$} &	$Y_{|r|v}$& -1540.383 &\unit{$\frac{kg}{s}$} \\
		$Y_r$& 24.732 &\unit{$\frac{kg}{s}$} &	$Y_{|v|r}$& 572.141 &\unit{$\frac{kg}{s}$}\\
		$Y_{|r|r}$& -115.457 &\unit{$\frac{kg}{s}$} & $N_{v}$& 3.5241 &\unit{$\frac{kg}{s}$}\\
		$N_{|v|v}$& -0.832 &\unit{$\frac{kg}{s}$} & $N_{|r|v}$& 336.827 &\unit{$\frac{kg}{s}$}\\
		$N_{r}$& -122.860 &\unit{$\frac{kg}{s}$}& $N_{|r|r}$& -874.428 &\unit{$\frac{kg}{s}$}\\
		$N_{rrr}$& 0.000 &\unit{$\frac{kg}{s}$}& $N_{|v|r}$& -121.957 &\unit{$\frac{kg}{s}$}\\
		\bottomrule
	\end{tabular}
\end{table}

\begin{table}[H]
	\centering
	\caption{Value and units of the Simulation parameters}
	\label{tab: Simulation parameters}
	\begin{tabular}{lllll}
		\toprule[1.5pt]
		{\bf Par} & {\bf Value} & {\bf Unit} & {\bf Description}\\
		\midrule
		$\boldsymbol{Q}$ & 30000$\cdot\boldsymbol{I}_{3\times3}$ & - & Covariance matrix\\
		$\boldsymbol{R}$ & $\boldsymbol{I}_{3\times3}$ & - & Covariance matrix\\
		$\boldsymbol{H}$ & 1000$\cdot\boldsymbol{I}_{3\times3}$ & - & Covariance matrix\\
		$\Gamma_1$ & 50 & - & Adaptive gain\\
		$\Gamma_2$ & 50 & - & Adaptive gain\\
		$\Gamma_3$ & 50 & - & Adaptive gain\\
		$\Delta t$ & 0.01 & \unit{s} & Timestep\\
		$\bar{F}_{\mathrm{wind}}$ & 10000 & \unit{N} & Wind force\\
		$\bar{F}_{\mathrm{wave}}$ & 8000 & \unit{N} & Wave force \\
		$\bar{F}_{\mathrm{current}}$ & 18000 & \unit{N} & Current force\\
		$\gamma_{\mathrm{wind}}$ & 135 & \unit{deg} & Wind angle\\
		$\gamma_{\mathrm{wave}}$ & 155 & \unit{deg} & Wave angle\\
		$\gamma_{\mathrm{current}}$ & 300 & \unit{deg} & Current angle\\
		$L$ & 5 & \unit{m} & Ship length\\
		$T_s$ & 15 & \unit{s} & Time constant\\
		$\boldsymbol{\eta}$ & $[0,0,30]^\top$ & \unit{[m,m,deg]} & Initial position \\
		&  &  & and heading\\
		$\boldsymbol{\nu}$ & $[0,0,0]^\top$ & [$\frac{\unit{m}}{\unit{s}}$,$\frac{\unit{m}}{\unit{s}}$,$\frac{\unit{deg}}{\unit{s}}$] & Initial velocity\\
		\bottomrule
	\end{tabular}
\end{table}

\end{document}
