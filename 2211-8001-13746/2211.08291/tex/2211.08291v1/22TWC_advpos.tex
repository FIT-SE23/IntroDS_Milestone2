%\documentclass[conference,10pt,twocolumn]{IEEEtran}
\documentclass[12pt, draftclsnofoot, onecolumn]{IEEEtran}
\IEEEoverridecommandlockouts
% The preceding line is only needed to identify funding in the first footnote. If that is unneeded, please comment it out.
\usepackage{cite}
\usepackage{amsmath,amssymb,amsfonts}
\usepackage{algorithmic}
\usepackage{graphicx}
\usepackage{textcomp}
\usepackage{xcolor}
\def\BibTeX{{\rm B\kern-.05em{\sc i\kern-.025em b}\kern-.08em
    T\kern-.1667em\lower.7ex\hbox{E}\kern-.125emX}}
    
    
%Packages and command by us ***
\usepackage{tikz}
\usepackage[utf8]{inputenc}
\usepackage{pgfplots}
\pgfplotsset{compat=newest}
\usepgfplotslibrary{groupplots}
\usepgfplotslibrary{dateplot}
\usepackage[caption=false,font=footnotesize]{subfig}
\usepackage{adjustbox}
\usepackage{amsmath}
% \usepackage{cleverref}
\usepackage{cite}
\usepackage{microtype} % best command ever

\usepackage{times}

\newcommand{\cs}[1]{\textcolor{red}{\bf [cs: #1]}}
\newcommand{\eg}[1]{\textcolor{blue}{\bf [eg: #1]}}
\newcommand{\ph}[1]{\textcolor{green}{\bf [ph: #1]}}
\newcommand{\ma}[1]{\textcolor{magenta}{\bf [ma: #1]}}
\newcommand{\kps}[1]{\textcolor{orange}{\bf [kps: #1]}}
\newcommand{\TODO}[1]{\textcolor{brown}{\large \bf [TODO: #1]}}

\tikzset{every picture/.append style={line join=round,line cap=round,}}
\tikzstyle{solid}=[dash pattern=]
\tikzstyle{dotted}=[dash pattern=on 0.0\pgflinewidth off 2.5\pgflinewidth]
\tikzstyle{dashed}=[dash pattern=on 4.0\pgflinewidth off 3.0\pgflinewidth]
\tikzstyle{dashdotted}=[dash pattern=on 0.0\pgflinewidth off 2.0\pgflinewidth on 3.0\pgflinewidth off 2.0\pgflinewidth]
\pgfplotsset{every tick label/.append style={font=\large}}
\pgfplotsset{every axis legend/.append style={font=\Large}}
\pgfplotsset{every axis label/.append style={font=\Large}}


\usepackage{tikz}
\usetikzlibrary{shapes.geometric, arrows}
\usetikzlibrary{ arrows.meta, calc, positioning, quotes,}
\usepackage{circuitikz}
\usetikzlibrary{arrows.meta,positioning}
\usepackage{adjustbox}
\usepackage{todonotes}
\usepackage{soul}

\definecolor{bl1}{HTML}{F7FCF0}
\definecolor{bl2}{HTML}{E0F3DB}
\definecolor{bl3}{HTML}{CCEBC5}
\definecolor{bl4}{HTML}{A8DDB5}
\definecolor{bl5}{HTML}{7BCCC4}

\IEEEoverridecommandlockouts

%\linespread{0.9775}

\tikzstyle{startstop} = [rectangle, rounded corners, minimum width=0.5cm, minimum height=1cm,text centered, draw=black, fill=red!30]
\tikzstyle{io} = [trapezium, trapezium left angle=70, trapezium right angle=110, minimum width=0.5cm, minimum height=1cm, text centered, draw=black, fill=blue!30]
\tikzstyle{process} = [rectangle, minimum width=0.5cm, minimum height=1cm, text centered, text width=3cm, draw=black, fill=orange!30]
\tikzstyle{decision} = [diamond, minimum width=0.5cm, minimum height=1cm, text centered, draw=black, fill=green!30]
\tikzstyle{arrow} = [very thick,->,>=latex]
\tikzstyle{invisible} =[rectangle, node distance=3cm, text=white]

%do not recompile if nothing is changed
\usetikzlibrary{external}
%\tikzexternalize[prefix=tikz/,optimize command away=\includepdf]
\tikzexternalize[optimize=false,prefix=figs/]

\def\MR{{M_\text{R}}}
\newcommand\y{\mathbf{y}}
\newcommand\h{\mathbf{h}}

\newcommand\bs{\mathbf{s}}
\newcommand\bss{\mathbf{\tilde s}}
\newcommand\n{\mathbf{n}}
\newcommand\F{\mathbf{F}}
\newcommand\yy{\mathbf{\tilde y}}
\newcommand\hh{\mathbf{\tilde h}}
\newcommand\nn{\mathbf{\tilde n}}
\newcommand\ba{\mathbf{a}}
\newcommand\baa{\mathbf{\tilde a}}

\input{vmr-symbols-vecbold}
\input{standard-macros}    
%Packages and command by us ***

\begin{document}


\title{Attacking and Defending Deep-Learning-Based Off-Device Wireless Positioning Systems\\

}

\author{\IEEEauthorblockN{Pengzhi Huang, Emre G\"{o}n\"{u}lta\c{s}, Maximilian Arnold,\\K. Pavan Srinath, Jakob Hoydis, and Christoph Studer}%
\thanks{P.~Huang is with the School of Electrical and Computer Engineering, Cornell University (ph448@cornell.edu). E.~G\"{o}n\"{u}lta\c{s} was with the School of Electrical and Computer Engineering,
Cornell University, Ithaca, NY. He is now with Ericsson, Austin,
TX (emre.gonultas@ericsson.com). M.~Arnold is with Nokia Bell Labs, Stuttgart, Germany (maximilian.arnold@nokia-bell-labs.com). K.~P.~Srinath is with Nokia Bell Labs, France (pavan.koteshwar\_srinath@nokia-bell-labs.com). J.~Hoydis is with NVIDIA Corp.\ (jhoydis@nvidia.com). C.~Studer is with ETH Zurich, Zurich, Switzerland (studer@ethz.ch).}%
\thanks{The work of CS was supported in part by ComSenTer, one of six centers in JUMP, a SRC program sponsored by DARPA, and by the U.S.\ National Science Foundation (NSF) under grants CNS-1717559 and ECCS-1824379, and by an ETH Research~Grant.}
}

\maketitle

\begin{abstract}
%
Localization services for wireless devices play an increasingly important role and a plethora of emerging services and applications already rely on precise position information. Widely used on-device positioning methods, such as the global positioning system, enable accurate outdoor positioning and provide the users with full control over what services are allowed to access location information. To provide accurate positioning indoors or in cluttered urban scenarios without line-of-sight satellite connectivity, powerful off-device  positioning systems, which process channel state information (CSI) with deep neural networks, have emerged recently. Such off-device positioning systems inherently link a user's data transmission with its localization, since accurate CSI measurements are necessary for reliable wireless communication---this not only prevents the users from controlling who can access this information but also enables virtually everyone in the device's range to estimate its location, resulting in serious privacy and security concerns. We propose on-device attacks against off-device wireless positioning systems in multi-antenna orthogonal frequency-division multiplexing systems while minimizing the impact on quality-of-service, and we demonstrate their efficacy using measured datasets for outdoor and indoor scenarios. We also investigate defenses to counter such attack mechanisms, and we  discuss the limitations and implications on protecting location privacy in future wireless communication systems. 
%
%
\end{abstract}

\newpage 

\begin{IEEEkeywords}
Adversarial attacks, adversarial training, channel state information (CSI), deep learning, neural networks, positioning, location privacy, multple-input multiple-output (MIMO), orthogonal frequency-division multiplexing (OFDM).
\end{IEEEkeywords}


%%%
\section{Introduction}
%
Device localization services play an important role in society as they are widely used in applications ranging from car navigation, augmented reality, targeted advertisement, asset tracking, health and lifestyle apps, industry automation, and many more~\cite{han2016survey,wicker2012locationprivacy}.
% 
Existing positioning systems can be categorized as follows: (i) on-device systems that enable the users to locate themselves and (ii) off-device systems that enable the receiver to locate the users. 
%
On-device positioning based on global navigation satellite systems (GNSSs), such as the global positioning system~\cite{hofmann2012global}, provides accurate location estimates, and privacy mechanisms on modern mobile devices typically provide full control over what services are allowed to gain access to the acquired GNSS coordinates (e.g., a car navigation app)~\cite{orman2013privacy}.
%
Such GNSS-based systems are the de-facto standard for outdoor localization but require line-of-sight connectivity to multiple satellites for proper functioning, rendering them ineffective for indoor applications.
%
As a remedy, off-device alternatives that process communication signals have been proposed for indoor localization~\cite{WEN201921survey,gustaffson2005wirelesspos,sahinoglu2008ultra,studer20205g}.
%
Emerging from the network provider, indoor positioning techniques that rely on wave-propagation or geometric models to process time-of-flight (ToF) or angle-of-arrival (AoA) measurements at base-stations (BSs) or access points (APs) with multiple antennas have been proposed for regulatory (e.g., E911) and commercial services~\cite{SurveyLocalizationTechniques}.  
%
The recent trend towards more antennas and increased bandwidth led to the definition of performance requirements for fifth generation (5G) wireless standards~\cite{3gpp5grel16position}, allowing the design of localization systems that exploit the existing communication link.
%
Moreover, future standard releases are expected to specify even more stringent specifications in positioning accuracy~\cite{larsson2015fingerprinting,keating20195gpositioning}.

Besides such off-device localization methods that rely on wave-propagation models, powerful approaches that process wireless signals using deep neural networks (DNNs) have emerged recently~\cite{wang2015deepfi,chen2017confi,wang2017csi,lundpaper,arnold2019novel,zappone2019surverwireless,wang2020bimodalcsi,huawei2020paper,gonultacs2021csi,foliadis2021csibased,li2021indoor}.
%
Such positioning systems not only provide accurate indoor and outdoor position estimates where ToF and AoA measurements are unreliable (e.g., in non-line-of-sight or high-mobility scenarios), but also enable infrastructure BSs or APs to localize wireless transmitters without the users' consent. Thus, network operators are able locate any device that connects to their infrastructure. 
%
Furthermore, as wireless signals can be measured unnoticed by virtually everyone in the transmitter's range, it is possible to design malicious systems that passively sniff wireless signals to perform off-device localization, without even being part of the network~\cite{rpicsi2019}.  
%
Consequently, DNN-based wireless positioning causes a number of serious privacy and security concerns~\cite{han2016survey,wicker2012locationprivacy}, which calls for effective attack mechanisms that prevent accurate device localization while remaining compliant to the communication standard and maintaining high quality-of-service in terms of data rates, coverage, and range. We address exactly these aspects in this paper.



%%%
\subsection{The Basics of CSI-Based Wireless Positioning}
%
In order to enable reliable data transmission, wireless systems typically estimate the channel's transfer function (e.g., in the form of impulse responses) using a training sequence that is known to both the transmitter and receiver. This acquired channel state information (CSI) is then used to inverse the channel's effect with the goals of detecting the transmitted data.
%
Clearly, the measured CSI contains information about the propagation environment, which can be utilized for wireless positioning~\cite{zappone2019surverwireless,lundpaper,huawei2020paper,gonultacs2021csi}; this is an immediate consequence of the fact that wireless signals are affected by the physical environment between the transmitter and receiver, including attenuation and ToF over distance, reflections through scattering, and/or refraction through certain materials. 
%
While CSI must be acquired continuously for reliable communication, it perpetually provides location information of the transmitting device.

Traditional wireless positioning techniques utilize geometrical models for wave propagation in order to perform triangulation or trilateration~\cite{rosado2018mobilepositioningsurvey}. Such methods rely on either AoA (e.g., using an array of antennas) and/or ToF information (e.g., using precise BS/AP synchronization) to localize the transmitting device. 
%
Unfortunately, such approaches require  antenna calibration and accurate time synchronization between the receivers, and require mostly idealistic line-of-sight propagation conditions between transmitter and receiver, which often prevents accurate positioning indoors or in dense urban scenarios that contain multiple scatterers. 


More recently, model-free wireless positioning systems that process the measured CSI with the aid of DNNs have emerged~\cite{wang2015deepfi,wang2017csi,chen2017confi,lundpaper,ericpaper,arnold2019novel,huawei2020paper,gonultacs2021csi,li2021wireless,foliadis2021csibased,li2021indoor}. 
%
Their principle is simple yet effective: Train a DNN with a dataset consisting of CSI measurements and ground-truth locations obtained via a reference positioning system in the area of interest. Then, use the trained DNN to process new CSI measurements to generate location estimates.
%
Such positioning systems enable accurate localization even under challenging propagation conditions that prevent approaches relying on geometrical models. Experiments with real-world data have demonstrated meter-level and centimeter-level accuracy for outdoor~\cite{huawei2020paper} and indoor~\cite{gonultacs2021csi,foliadis2021csibased} scenarios, respectively. 
 

%%%
\subsection{Privacy and Security Threats}
%
Off-device wireless positioning is a blessing and a curse.
%
Since the extraction of location estimates can be carried out on server farms, off-device positioning methods can utilize computationally complex algorithms and save energy on battery-powered wireless devices. However, modern communication standards~\cite{ieee80211ac,3gpp5grel15}   enable virtually everyone in the transmitters' vicinity to acquire CSI and, hence, extract location estimates. 
%
Furthermore, off-device positioning systems inherently link a userâ€™s data transmission with the acquisition of CSI, which is necessary for estimating the transmitted data; this implies that preventing the acquisition of CSI at the receiver side is typically equivalent to preventing communication. 

By extracting location estimates from CSI, privacy is at stake. For example, one can learn the users' behavior (e.g., what stores or bars they frequently visit), their socioeconomic status (e.g., based on where they live and work), 
or even gain sensitive information about their health (e.g., if the user frequently visits a specialized health clinic)~\cite{wicker2012locationprivacy}.
%
One can even envision concrete security threats, as location information enables one to determine when a user is leaving their home, parking their car, or withdrawing money. 
%
It is therefore crucial to develop effective countermeasures that prevent accurate CSI-based off-device localization without sacrificing quality-of-service. 


%%% 
\subsection{Contributions}
% 
We investigate on-device attacks to avoid accurate CSI-based localization with DNNs, while remaining standard compliant and enabling reliable communication. 
%
Our main contributions are as follows. 
%
We develop a simple, yet effective user-side attack to off-device CSI-based positioning systems that convolves the transmit signals with short perturbation sequences to prevent accurate wireless localization in systems using orthogonal frequency division multiplexing (OFDM).
%
We propose a range of adversarial as well as randomized attacks with varying knowledge of the positioning system and the wireless channel to generate suitable perturbation sequences that maximize the positioning error.  
%
We also investigate defense mechanisms that render off-device CSI-based positioning systems more resilient to the proposed attacks.
%
We demonstrate the efficacy of our methods using two measured datasets in a 3GPP-5G release~15~\cite{3gpp5grel15} outdoor scenario and an IEEE 802.11ac WLAN~\cite{ieee80211ac} indoor scenario, and we explore the trade-offs between robustness, localization privacy, and communication capacity.
%
We conclude by discussing the limits and implications of our results on existing and emerging wireless communication systems.


%%%
\subsection{Relevant Prior Work}\label{sec:Prior}

Ever since adversarial attacks were discovered as potential vulnerabilities of DNN-based image classifiers~\cite{szegedy2014intriguing,biggio2013evasion}, a range of defensive mechanisms have been proposed, e.g.,~\cite{papernot2016distillation,raghunathan2018certified,samangouei2018defense}.
%
While powerful counterattacks keep on emerging, e.g.,~\cite{narodytska2016simple,chen2020hopskipjumpattack,madry2017towards},  %resulting in a never ending arms race, 
theory indicates that adversarial attacks are inevitable for general, high-dimensional classifiers~\cite{shafahi2018adversarial,ilyas2019adversarial} and, hence,  difficult to avoid.
%
In contrast to the challenges adversarial attacks pose to many classification tasks, our results for CSI-based wireless positioning indicate that their existence is an opportunity, as they can be exploited to improve location privacy. 


Location privacy is not a novel topic; see, e.g.,~\cite{wicker2012locationprivacy,di2010privacywireless,WiFiProtect ,WifiResponse}. Existing work largely focuses on the trade-offs between location accuracy provided by the users (obtained from on-device positioning systems) versus the fidelity of the services provided to the user~\cite{danezis2005much,krumm2009survey}. 
%
In contrast, we focus on off-device positioning systems that process measured CSI to extract location estimates using neural networks. Such systems circumvent most of these trade-offs as localization is possible without the users' consent~\cite{WEN201921survey,gustaffson2005wirelesspos,sahinoglu2008ultra,studer20205g}. 

Privacy issues also arise with widely-available wireless sniffers that passively collect unencrypted physical layer information, including medium access control (MAC) addresses~\cite{rpicsi2019}.
%
In order to attack user identification, potential countermeasures, such as continuously changing the MAC address, have been proposed in \cite{Zhu_2020wifisensing}.
%
In contrast to such MAC-layer approaches, we focus on simple yet effective physical (PHY) layer techniques at the UE-side that indirectly manipulate the CSI estimated at the BS or AP in order to prevent accurate localization. 


WiFi-based positioning systems that rely on geometrical models with ToF and AoA measurements where among the first ones for which countermeasures were developed \cite{WiFiProtect,qiao2016phycloak}. 
%
Shortly after, methods that mitigate such attacks have emerged \cite{WiFiProtect}, causing a race between measures and countermeasures~\cite{WifiResponse}. 
%
However, algorithmic methods that attack geometry-based ToF and AoA-based positioning systems are generally ineffective against DNN-based approaches as the learned function that performs positioning is described by a black box. 
%
Hence, we propose countermeasures that are specifically designed to attack DNN-based systems. 


For DNN-based positioning systems, methods that manipulate the frequency-domain training symbols of orthogonal frequency-division multiplexing (OFDM) systems have been proposed in~\cite{abanto2020wifi,COMINELLI2021107970,cominelli2022properties}.
%
However, directly manipulating the frequency-domain information at the transmitter (before the inverse discrete Fourier transform) is likely to violate the mutual orthogonality of the OFDM subchannels as the effective channel impulse response may exceed the cyclic prefix length---this will negatively affect the quality-of-service. 
%
In contrast, we propose a variety of time-domain attacks that preconvolve the transmit signals by a specific perturbation sequence of pre-defined (and short) length, which has a well-defined impact on the received CSI while maintaining subchannel orthogonality as long as the effective channel's delay spread does not exceed the cyclic prefix length. 
%
Besides those differences, we also investigate defensive mechanisms that can be deployed at the infrastructure BSs/APs.

Reference  \cite{zhou2019adversarial} proposes adversarial attacks on the frequency-domain CSI against WiFi-based human activity detection. 
%
In contrast, we propose a range of adversarial attacks with varying knowledge on the positioning system, which specifically target CSI-based localization.
%
We conclude by noting that our adversarial attacks resemble that of functional attacks~\cite{laidlaw2019functional}, where the adversary applies a carefully-designed function to each pixel of a picture, perturbing the same color by the same amount. Analogously, we convolve the transmit-side time-domain signals with well-designed perturbation sequences, which affects the CSI estimated at the receiver by an entry-wise multiplication with the channel's transfer function. 














%%%
\subsection{Notation}

Lowercase boldface, uppercase boldface, and uppercase calligraphic letters denote column vectors, matrices, and sets, respectively. 
%
The $i$th element of a vector $\bma$ is denoted by $a_i$, the $i$th column of a matrix $\bA$ by $\bma_i$, and the element on the $i$th row and $j$th column by $A_{i,j}$. 
%
The $\ell^2$-norm of a vector $\bma$ is $\|\mathbf{a}\|$.
%
The transpose, Hermitian transpose, and Frobenius norm of a matrix $\bA$ is $\mathbf{A}^T$, $\mathbf{A}^H$, and $\|\mathbf{A}\|_F$, respectively. 
%
The Hadamard product between the matrices $\mathbf{A}$ and $\mathbf{B}$ is denoted by $\mathbf{A}\odot\mathbf{B}$. 
%
The convolution and circular convolution between the vectors $\bma$ and $\bmb$ is denoted by $\bma\ast\bmb$ and $\bma\circledast\bmb$, respectively.  
 

\section{Communication System and CSI-Based Wireless Positioning}
\label{section:System Model}
%
In what follows, we focus on communication systems that rely on OFDM~\cite{ofdm,li2006orthogonal}, as they are widely used in modern wireless communication standards, such as 3GPP-LTE \cite{lte}, 3GPP-5G~\cite{3gpp5grel15}, and wireless LAN (WLAN)~\cite{ieee80211ac}. 
%
We first detail the system model and then, introduce the principles of off-device CSI-based positioning. 




\begin{figure}
    \centering
\adjustbox{max width=\columnwidth,valign=t}{%    
    \begin{circuitikz}
    \def\lines{
    \draw \ls ([yshift=3.mm]\from.east) -- ([yshift=3.mm]\to.west); 
    \draw \ls ([yshift=1.mm]\from.east) -- ([yshift=1.mm]\to.west); 
    \draw \ls ([yshift=-1.mm]\from.east) -- ([yshift=-1.mm]\to.west); 
    \draw \ls ([yshift=-3.mm]\from.east) -- ([yshift=-3.mm]\to.west);   
    }
    
        %%tikz -l positioning,arrows --size 800,300
    \tikzset{block/.style={draw,thick,minimum width=1cm,minimum height=1cm,align=center},Circle/.style={circle,draw=black,fill=white,thick,inner sep=0pt,minimum size=6mm}}
    
    \tikzset{node distance=0.4cm}
    \tikzset{double distance=1pt}
    \tikzset{>=latex}
    
    \begin{scope}
    %\draw [->] (-0.5,0) node[xshift=0.2cm,yshift=0.1cm] (s) [left] {$\bms$} -- (0,0) node[yshift=-0.3cm] (IDFT) [right,block] {IDFT}; 
    
    \node[draw] (s) at (0,0) [draw=white] {};
    
    \node[draw] (ss) at (0.35,0.62) [draw=white] {\large $\bms$};
    
    \node (IDFT) [block,right=of s] {IDFT};
    
    \draw [->] ([yshift=3.mm]s.east) -- node[anchor=south,yshift=0.2cm] {} ([yshift=3.mm]IDFT.west); 
    \draw [->] ([yshift=1.mm]s.east) -- ([yshift=1.mm]IDFT.west); 
    \draw [->] ([yshift=-1.mm]s.east) -- ([yshift=-1.mm]IDFT.west); 
    \draw [->] ([yshift=-3.mm]s.east) -- ([yshift=-3.mm]IDFT.west);
     
    
    %\node (M) [block,right=of SP1] {Mapping};
    %\node (IDFT) [block,right=of SP1] {IDFT};
    \node (PS1) [block,right=of IDFT] {P/S};
    \node (CP) [block,right=of PS1] {$+$CP};
    
    \node[block,node distance=.5cm] (convolve) [right=of CP] {\Large$*$};
    
    \draw [->,thick] ([yshift=-1.5cm]convolve.north) -- node[anchor=north,yshift=-0.3cm] {\large
			Perturbation $\bar \bmp$}
    (convolve.south);
    
    \node (RF) [block,right=of convolve] {RF};
    
    \draw [->,thick] (PS1) -- node[anchor=south,yshift=0.4cm,xshift=0cm]{\large$ \bar \bms$}(CP) ;
    
    
    \draw [->] ([yshift=3.mm]IDFT.east) -- node[anchor=south,yshift=0.1cm] {\large $\hat \bms$} ([yshift=3.mm]PS1.west); 
    \draw [->] ([yshift=1.mm]IDFT.east) -- ([yshift=1.mm]PS1.west); 
    \draw [->] ([yshift=-1.mm]IDFT.east) -- ([yshift=-1.mm]PS1.west); 
    \draw [->] ([yshift=-3.mm]IDFT.east) -- ([yshift=-3.mm]PS1.west); 
    
    \node (tx1) [txantenna, scale=0.25] at ( RF.east) {};
    
    
    \node (C) [ right=of RF,xshift=0.5cm] {\parbox{2cm}{\large
			Wireless \\
			channel}}; 

    
    
    \node (RF2) [block,right=of C] {RF};
    
    \node (rx1) [rxantenna, xscale=-1,scale=0.25] at ( RF2.west) {};
    
    
    \node (CP1) [block, right=of RF2] {$-$CP};
    \node (PS2) [block,right=of CP1] {S/P};
    \node (DFT) [block,right=of PS2] {DFT};
    \node (EQ) [block,right=of DFT] {Data\\ detection};
    \node (CE) [block,below =of DFT,yshift=-0.2cm] {Channel\\estimation};
   
    
    
    \node (pos) [block,right=of CE,fill=bl5,xshift=1cm] { Position \\  estimation};
    
    \draw [->,thick] (DFT.south) -- (CE);
    
    \draw [->,thick] (CP) -- (convolve);
    
    
    \draw [->,thick] (convolve) -- (RF);

    \draw [->,thick] (RF2) -- (CP1);
    
    \def\ls{[->]}
    \draw [->,thick] (CP1) -- node[anchor=south,yshift=0.4cm] {\large$ \bar \bmy$}(PS2);
    \def\from{PS2} \def\to{DFT} \lines;
    
    \draw \ls ([yshift=3.mm]DFT.east) -- node[anchor=south,yshift=0.1cm] {\large $\bmy$} ([yshift=3.mm]EQ.west); 
    \draw \ls ([yshift=1.mm]DFT.east) -- ([yshift=1.mm]EQ.west); 
    \draw \ls ([yshift=-1.mm]DFT.east) -- ([yshift=-1.mm]EQ.west); 
    \draw \ls ([yshift=-3.mm]DFT.east) -- ([yshift=-3.mm]EQ.west); 


    \draw [->,thick] ([yshift=0.mm]CE.east) -- node[anchor=south,xshift=-0.4cm] {\large $\hat \bmh$} coordinate[midway] (midway) ([yshift=0.mm]pos.west); 
  
    \draw [{Circle}->,thick] ([xshift=0.15cm,yshift=-0.085cm]midway) -- ([yshift=0.mm]EQ.south);
  
    \node[draw] (shat) [draw=white,right =of EQ.east] {};
    
    
    \node[draw] (sshat) [draw=white,above= of shat,yshift=-0.1cm,xshift=-0.2cm] {\large $\hat \bms$};

    \draw [->] ([yshift=3.mm]EQ.east) -- node[anchor=south,yshift=0.2cm] {} ([yshift=3.mm]shat.west); 
    \draw [->] ([yshift=1.mm]EQ.east) -- ([yshift=1.mm]shat.west); 
    \draw [->] ([yshift=-1.mm]EQ.east) -- ([yshift=-1.mm]shat.west); 
    \draw [->] ([yshift=-3.mm]EQ.east) -- ([yshift=-3.mm]shat.west);
    
    
    \draw [->,thick] (pos.east) -- +(0.5,0) node [right,xshift=-0.4cm,yshift=0.3cm] {\large $\hat \bmx$};
    \end{scope}
    \end{circuitikz}
    }

    \caption{OFDM communication system. A wireless transmitter (left) generates symbols $\bms$ in the frequency domain that are converted to the time domain followed by prepending a cyclic prefix (CP). The signal is then transmitted over the wireless channel. After removing the CP and conversion into the frequency-domain, the receiver (right) generates an estimate $\hat\bmh$ of the wireless channel, which is used for data detection as well as wireless positioning. Our attack pre-convolves the time-domain signal with a perturbation sequence $\bar\bmp$ that is kept constant for the duration of the entire OFDM packet.
    }
    \label{fig:ofdmsystem}
%    \vspace{-0.3cm}
\end{figure}


\subsection{System Model}\label{sec:communication system}
%
We consider an OFDM-based wireless communication system as illustrated in  \fref{fig:ofdmsystem} in which a single-antenna mobile user transmits information to an infrastructure BS or AP. The case with multiple receive antennas is discussed below.\footnote{Extending this model to the multiple-input multiple-output (MIMO) case is straightforward; see, e.g.,~\cite{gonultacs2021csi}.}
%
The model described in the following ignores, besides noise, any system and hardware impairments that are present in real-world transceivers. Nonetheless, our experiments in \fref{sec:results} with real-world CSI measurements include the effect of such impairments. 

We assume that a mobile user transmits $W$ frequency-domain symbols contained in the vector $\bms \in \complexset^W$. 
%
The frequency-domain symbols are first converted into the time domain $\bar{\bms} \in \complexset^W$ using an inverse discrete Fourier transform (IDFT) according to $\bar\bms =\bF^H\bms$, where $\bF\in\complexset^{W\times W}$ is the (unitary) DFT matrix. Then, a so-called cyclic prefix (CP) of length $C$ is prepended; the CP repeats the last $C$ entries of $\bar{\bms}$ to obtain $C+W$ time-domain samples that are then transmitted sequentially over the wireless channel. 

After time synchronization, the receiver first removes the cyclic prefix in the received time-domain samples.
%
The wireless channel can then be modeled with the following baseband input-output relation between the transmitting user and receiver:
\begin{align} \label{eq:inputoutputrelation}
\bar{\bmy}  = \bar{\bmh} \circledast  \bar{\bms} + \bar{\bmn}.
\end{align}  
Here, $\bar{\bmy}\in\complexset^{W}$ is the time-domain receive vector, $\bar{\bmh}\in\complexset^L$ is the channel's impulse response (consisting of $L\leq C+1$ nonzero taps), and $\bar{\bmn}\in\complexset^{W}$ models additive noise. 
%
The receiver then applies a $W$-point DFT to $\bar{\bmy}$ resulting in the frequency-domain receive vector $\bmy\in\complexset^W$, which leads to the following input-output relation of the wireless channel in the frequency domain~\cite{li2006orthogonal}:
%
\begin{align} \label{eq:yhs}
\bmy=\bmh \odot \bms + \bmn.
\end{align}
%
Here, $\bmh$ is the channel's transfer function, given by the DFT of the zero-padded impulse response~$\bar{\bmh}$, and $\bmn\in\complexset^W$ is additive noise. 
%
We see from \fref{eq:yhs} that OFDM converts the wireless channel into $W$ orthogonal subchannels, which significantly reduces the complexity of detecting the transmitted data in the presence of inter-symbol interference. 

Prior to data detection, the receiver needs to estimate the transfer function $\bmh$; this is commonly accomplished by transmitting a pre-defined pilot sequence, e.g., $\bmt\in \{-1,+1\}^W$, that is known to the receiver. By computing  $\hat{\bmh} = \bmy\odot\bmt$, the receiver can estimate the transfer function and use it to detect the transmitted data. 
%
We note that in the presence of $B$ antennas at the BS or AP, one estimates $B$ channel vectors $\hat{\bmh}_b$, $b=1,\ldots,B$, one for every receive antenna. The collection of the $B$ channel vectors results in an estimated $B\times W$ CSI matrix $\hat\bH=[\bmh_1,\dots,\bmh_{B}]^T$, which can be used for wireless positioning. 

%%%
\subsection{CSI-Based Positioning using Neural Networks}
\label{sec:positioningpipeline}

 
%
CSI-based positioning using DNNs first converts the estimated CSI matrix $\bH$ into a CSI feature vector $\bmf\in\reals^{d}$ using a feature-extraction function $\mathsf{F}:\complexset^{B\times W} \to \reals^d$; here, $d$ is the feature dimension.
%
CSI features render the positioning system resilient to system and hardware impairments, such as time-synchronization errors or carrier frequency offset~\cite{huawei2020paper,gonultacs2021csi}.
%
The CSI feature~$\bmf$ is then fed into a positioning DNN $\mathsf{P}:\reals^d\to \reals^D$ that produces a location estimate $\hat{\bmx}\in\reals^D$ of the transmitting device at location $\bmx\in\reals^D$; here, $D$ is the spatial dimension, which is commonly~$2$ or~$3$. 
%
The positioning DNN is typically trained off-line from a large database containing CSI feature and ground-truth location estimate pairs, which can be acquired using a reference positioning system. 

In what follows, we consider two distinct CSI feature-extraction functions to study the trade-off between positioning accuracy and resilience to (adversarial) perturbations. 
%
The first function~$\mathsf{F}_1$ was developed in~\cite{huawei2020paper} and \cite{gonultacs2021csi} to achieve state-of-the-art CSI-based positioning accuracy in indoor and outdoor scenarios, respectively. 
%
The second function $\mathsf{F}_2$ is simpler and typically achieves lower positioning accuracy, but will, as shown in  \fref{sec:results}, improve robustness against (adversarial) attacks in some scenarios. 
%
In the ensuing discussion, we will often use $\mathsf{F}$ to refer to either of the two CSI feature extraction functions $\mathsf{F}_1$ or $\mathsf{F}_2$. 
%
The details of these two CSI feature extraction functions are as follows: 




%%%
\subsubsection*{Feature 1}
%

%
The feature-extraction pipelines from \cite{huawei2020paper,gonultacs2021csi} first take the inverse DFT of the rows of the CSI matrix according to $\bar{\bH}= \bH\bF^H$ in order to convert the $B$ transfer functions into the delay domain. One then computes a 2-dimensional (instantaneous) autocorrelation to obtain $\bR=\bar{\bH} \ast \bar{\bH}^*$ which doubles the number of rows and columns. Finally, the feature-extraction pipeline vectorizes the resulting autocorrelation $\bmr=\mathrm{vec}(\bR)$, extracts the real and imaginary parts $\bmr_R = [  \Re\{\bmr\}^T , \Im\{\bmr\}^T ]^T$, and obtains the unit-length CSI feature vector $\bmf_1 = \bmr_R/\|\bmr_R\|_2$.
%

%%%
\subsubsection*{Feature 2}
%
The second feature-extraction pipeline first takes the inverse DFT of the rows of the CSI matrix $\bar{\bH}= \bH\bF^H$. We then vectorize  the matrix and take the entry-wise absolute values $\bmh_v = |\mathrm{vec}(\bar{\bH})|$. The unit-length CSI feature vector corresponds to $\bmf_2 = \bmh_v/\|\bmh_v\|_2$.


 



In order to map CSI features to position estimates, we use a DNN that generates a so-called probability map $\bmm\in [0,1]^K$, where $K$ is the number of pre-defined grid points $\bmg_k\in\reals^D$, $k=1,\ldots,K$, covering the area of interest~\cite{gonultacs2021csi}. Each entry $m_k$ indicates the likelihood of the user being at the specific grid point $\bmg_k\in\reals^D$ in  space. By computing $\hat\bmx = \sum_{k=1}^K \bmg_k m_k$, we obtain the final location estimate. 
%
We note that the convex hull spanned by the grid points $\{\bmg_k\}_{k=1}^K$ bounds the possible position estimates. Consequently, this approach limits the maximum perturbation of any (adversarial) attack on such positioning systems.
%
For positioning, we use neural networks with five dense layers with batch normalization (BN) in the first two layers. The first four layers use rectified linear units (ReLUs); the last layer uses softmax activations which generate the probability map~$\bmm$ for the $K$ predefined grid points. The number of activations per layer depends on the dataset and are shown in Figs.~\ref{fig:modeloutdoor} and \ref{fig:modelindoor}.
%
We use a binary cross entropy loss in order to train the network $\mathsf{P}$ with reference probability maps generated from ground-truth position estimates.  
%
All positioning networks, adversarial examples, and defensive mechanisms were trained on a 48\,GB RAM Intel Core i7-7700K PC with an NVIDIA Quadro P6000 GPU.


\section{Adversarial Attacks and Defensive Mechanisms}
%
We now detail our attack mechanism and propose adversarial as well as random attacks with varying levels of knowledge on CSI-based positioning systems. We also propose defensive mechanisms that improve robustness of off-device CSI-based positioning systems against the proposed attacks. 

%%%
\subsection{Transmit-Side Perturbation}\label{sec:transsidepert}
%
Since one cannot simply perturb the measured CSI at the BS or AP side, a practical defense must inevitably originate at the transmitter side. 
%
As depicted in \fref{fig:ofdmsystem}, our approach pre-convolves the time-domain transmit signal with a perturbation sequence $\bar\bmp\in\complexset^{L_p}$ of length $L_p$ that is held constant for the entire duration of one OFDM packet transmission (which includes OFDM symbols for time and frequency synchronization, channel estimation, and payload data).
%
This approach causes the receiver to only observe the joint effect of the perturbation sequence and the channel's impulse response, i.e., is only able to estimate the combined impulse response $\bar\bmc = \bar\bmh\ast\bar\bmp$. Hence, the transmitter is able to efficiently alter the measured CSI, which is what we use as our defense against CSI-based positioning systems. 
%
As long as the combined impulse response duration satisfies $L+L_p\leq C+1$, orthogonality among the subcarriers is guaranteed and hence, our approach remains to be standard compliant and reliable transmission is generally possible if we enforce a unit-norm power constraint on the perturbation sequences.
%
What is more, our results in \fref{sec:results} reveal that short perturbation sequences (e.g., $L_p=16$ or much less) are already sufficient in order to significantly degrade the positioning accuracy. 





In order to understand the impact our approach has on the reliability, we study its effect on the frequency-domain input-output relation in \fref{eq:yhs}, which, after perturbation, is given by 
\begin{align} \label{eq:yhs_perturbed}
\bmy=(\bmh \odot \bmp) \odot \bms + \bmn = \bmc \odot \bms +\bmn.
\end{align}
Here, $\bmp\in\complexset^W$ is the transfer function of the perturbation sequence given by the DFT of a zero-padded version of $\bar{\bma}$ according to $\bmp=\sqrt{W}\bF[\bar\bmp^T,\bZero_{(W-L_p)\times1}^T]^T$, and $\bmc=\bmh \odot \bmp$ models the combined effect of the perturbation sequence and the wireless channel.
%
Note that our attack is equivalent to pre-multiplying the frequency-domain symbols $\bms$ with the transfer function $\bmp$.\footnote{A na\"ive perturbation of the transmit signal in the frequency domain, i.e., by directly manipulating $\bmp$ as done in, e.g., \cite{abanto2020wifi,COMINELLI2021107970,zhou2019adversarial}, results, in general, in  perturbation sequences of length $L_p=W$ that violate orthogonality among subcarriers (due to the finite cyclic prefix length $C$) and may result in a serious performance degradation. Our proposed time-domain approach ensures that the combined impulse response length is no longer than $L+L_p$.}
%
We can now measure transmission reliability using the channel capacity, which is given by the following per-subcarrier rate \cite{li2006orthogonal}:
\begin{align} \label{eq:rate}
R \define \frac{1}{|\Omega|} \sum_{w\in\Omega} \log_2\!\left(1+\frac{|h_w p_w|^2 E_s}{\No}\right)\!.
\end{align}
Here, $\Omega\subseteq\{1,\ldots,W\}$ is the set of subcarriers reserved for data transmission, $E_s$ is the symbol power, and $\No$ the thermal noise power at the receiver. 
%
By manipulating the time-domain signals with the perturbation sequence $\bar\bmp$, one alters the combined frequency-domain gain $|h_w p_w|^2$ per subchannel, which will affect the rate $R$. First, we have to ensure that the transmit power remains unaffected by our perturbation attack. As mentioned above, this  can be accomplished by enforcing $\|\bmp\|=1$. Second, we would like that \fref{eq:rate} is as large as possible; this  can be accomplished by including a rate-regularization term when computing adversarial perturbation sequences. 

In the case of $B$ receive antennas, the proposed perturbation approach affects each row of the estimated CSI matrix in the following way $\hat{\bH}[\bmp]=[\bmh_1 \odot \bmp ,\dots,\bmh_{B}\odot \bmp]^T$, as every path between the transmitter and the $b$th receive antenna is perturbed in the same manner. 
%
The per-subcarrier rate $R$ in this scenario is obtained by replacing $|h_w p_w|^2$ in \fref{eq:rate} by $|p_w|^2\sum_{b=1}^B|H_{b,w}|^2$. 




\subsection{On-Device Adversarial Attacks}\label{sec:extraction}
%
The remaining piece in our defense against CSI-based positioning is the generation of effective adversarial perturbation sequences, which we detail next.

\subsubsection*{White-Box Attack}
%
We first consider a \emph{white-box attack} in which the positioning DNN~$\mathsf{P}$ and the feature extraction function~$\mathsf{F}$ are both known to the adversary (the user), and one has access to the estimated CSI matrix~$\hat\bH$. In this case, the location estimate is generated at the receiver by cascading both functions $\hat\bmx[\bmp]=\mathsf{P}(\mathsf{F}(\hat{\bH}[\bmp]))$, which depends on the time-domain perturbation $\bar\bmp$ via $\bmp=\sqrt{W}\bF[\bar\bmp^T,\bZero_{(W-L_p)\times1}^T]^T$. 
%
One can now extract an adversarial perturbation sequence by solving the following optimization problem
%
\begin{align} \label{eq:adversarial}
\bar\bmp_\text{adv} = \argmax_{\tilde\bmp\in\complexset^{L_p}} \big\|\hat\bmx- \underbrace{\textsf{P}(\textsf{F}(\hat{\bH}[\sqrt{W}\bF[\tilde\bmp^T,\bZero_{(W-L_p)\times1}^T]^T]))}_{\hat\bmx_\text{adv}}\big\|^2 \quad \text{subject to} \quad \|\tilde\bmp\|=1
\end{align}
using projected gradient ascent, which pushes the perturbed position estimate $\hat\bmx_\text{adv}$ as far away as possible from the unperturbed estimate $\hat\bmx=\mathsf{P}(\mathsf{F}(\hat{\bH}))$. 
%
Since~\fref{eq:adversarial} only focuses on maximizing the positioning error, the rate $R$ may deteriorate. Hence, we add a term $\lambda R$ from \fref{eq:rate} to the objective in~\fref{eq:adversarial}, where the parameter $\lambda$ provides a trade-off between position perturbation and rate. 

\subsubsection*{Transfer Attack}
%
While the above white-box attack has the strongest impact on the positioning error (cf.~\fref{sec:results}), it also requires knowledge of the positioning function $\mathsf{P}$ as well as the estimated CSI $\hat\bH$, which may be unavailable to the transmitting user. 
%
We therefore propose an alternative approach we call \emph{transfer attack}. This attack type assumes that the transmitter has access to an alternative positioning network~$\mathsf{P}_\text{alt}$ that has been learned with a different BS or AP, or was obtained from a simulated scenario. One then simply replaces the true model $\mathsf{P}$ in the adversarial attack \fref{eq:adversarial} by~$\mathsf{P}_\text{alt}$ in order to extract the perturbation sequence from estimated CSI. 

\subsubsection*{Pool Attack}
%
The transfer attack still requires access to estimated CSI, which can, in certain systems, be extracted through channel reciprocity in a time-division duplexing system. In order to avoid knowledge of the estimated CSI altogether, we propose another approach called \emph{pool attack}.
%
This attack precomputes a pool of $T$ different perturbation sequences $\{\bar\bmp_t\}_{t=1}^T$ for randomly selected locations in the given area and then, randomly selects a perturbation sequence from this pool. 

\subsubsection*{Random Attack}
%
We also consider a simple approach dubbed \emph{random attack}, which does not require any model or CSI knowledge.
%
Here, we randomly generate the entries of the $L_p$-length perturbation sequence $\bar\bmp$ by sampling the amplitudes and phases from i.i.d.\ uniform distributions in $[0,1]$ and  $[0,2\pi)$, respectively. We then normalize the perturbation vector so that $\|\bar\bmp\|=1$. 


\subsection{Improving Positioning Robustness using Adversarial Training} 
\label{sec:adversarialtraining}

Since we are proposing new methods to degrade the accuracy of off-device CSI-based positioning systems, it is natural to ask what will happen if the positioning  system is aware of such attacks and deploys suitable countermeasures.
%
To this end, we also investigate adversarial training techniques, which generally improve  model robustness by training the neural network parameters on particularly ``difficult'' examples~\cite{szegedy2014intriguing,shafahi2019adversarial}.
%
Although adversarial training typically incurs an accuracy loss for the inference of unperturbed data~\cite{engstrom2018evaluating}, it effectively improves the resilience of neural networks against challenging (or adversarially generated) input data.
%
In what follows, we consider a simple yet effective defense mechanism, where we, instead of training the positioning network with adversarial examples, we utilize training samples generated from the random attack as introduced in \fref{sec:extraction}.
%
Concretely, during training of the positioning network $\textsf{P}$, for every pair of ground-truth probability map and output of the positioning network in each batch, we perturb the estimated channel as in the objective function of~\fref{eq:adversarial}, where $\tilde\bmp$ are random perturbation sequences generated from the  distribution used in our random attack. 
%
The advantages of this approach are (i) simplicity and (ii) universality, as the off-device positioning system can be trained from randomly perturbed data only and the method is independent of the attack type deployed at the user side. 
%
An investigation of other, more sophisticated defensive mechanisms that leverage adversarial examples during training is left for future work. 

%%%
\section{Results}
\label{sec:results}

We now demonstrate the efficacy of our attack and defense mechanisms with real-world measurement campaigns in a large outdoor 5G cellular scenario and an indoor IEEE 802.11ac WLAN  scenario. 






\subsection{Outdoor 5G  Cellular Scenario}
%
\subsubsection*{Dataset, Models, and Training}
%
\input{figs/model_out}
%
We start by evaluating the efficacy of our attacks with the measured outdoor dataset from the IEEE Communication Theory Workshop (CTW) 2020 data competition~\cite{arnold2019novel}, consisting of $N = 22\,128$ CSI estimates and GPS locations as ground-truth position estimates. 
%
The dataset was acquired in a large suburban area and a random subset of the test-set locations is shown in~\fref{fig:scen_1}. 
%
A mobile transmitter in the measurement area communicates with a $8\times8$ uniform rectangular array (URA) placed on a high building complex at a carrier frequency of $1.27$\,GHz and a bandwidth of $20$\,MHz.
%
Each estimated CSI matrix consists of $B=64$ antennas and $W =|\Omega|= 924$ active subcarriers; the CSI feature dimension is $d=117\,602$.
%
The first four layers of the positioning DNN have $2048$ activations and the output produces a $K=30\times30$  probability map, which also enforces a bounding box around the measurement area.
%
\fref{fig:modeloutdoor} illustrates the used neural network architecture. The numbers next to the arrows correspond to the number of activations.
%
In order to train the alternative positioning network $\mathsf{P}_\text{alt}$ for the transfer attack, we use the QuaDRiGa channel model~\cite{quadriga} in an urban micro scenario with the same system parameters (bandwidth, carrier frequency, BS location, etc.) as for the CTW dataset.


\begin{figure}[tp]
    \centering
    \subfloat[Test-set GNSS locations \label{fig:scen_1}]
    {
    \adjustbox{max width=0.5\columnwidth,valign=t}{%
         \includegraphics{figs/real.pdf}
         }
    }
    \subfloat[Estimated locations without perturbation\label{fig:scen_2}]
    {
    \adjustbox{max width=0.5\columnwidth,valign=t}{%
         \includegraphics{figs/predicted.pdf}
         }
    }
    \hfill
    \subfloat[White-box attack \label{fig:scen_3}]
    {
    \adjustbox{max width=0.5\columnwidth,valign=t}{%
         \includegraphics{figs/ptbed.pdf}
         }
    }
    \subfloat[Random attack \label{fig:scen_4}]
    {
    \adjustbox{max width=0.5\columnwidth,valign=t}{%
         \includegraphics{figs/rand.pdf}
         }
    }    
    \caption{Real locations, estimated locations without perturbations, as well as white-box and randomly perturbed locations with $L_p=16$  for the test-set of the outdoor 5G cellular dataset. The x and y axes are in meters and show the relative position to the BS which is located at $(x,y)=(0,0)$. The color gradients help to visualize the position perturbation.}
    \label{fig:Nokia_locations}
    \vspace{-0.2cm}
\end{figure}

\begin{figure}[tp]
    \centering
    \subfloat
    {
    \adjustbox{max width=0.5\columnwidth,valign=b}{%
        \input{figs/Nokia_validation}
        }
    }
        \subfloat
    {
    \adjustbox{max width=0.5\columnwidth,valign=b}{%
        \input{figs/Nokia_l2d_val_median}
        }
    }
    \caption{Outdoor 5G  cellular dataset with Feature~1: mean distance error (left) and median distance error (right) on the test-set for different adversarial attacks and with varying perturbation length $L_p$.}
    \label{fig:Nokia_dataset}
    \vspace{-0.4cm}
\end{figure}



\begin{figure}[tp]
    \centering
    \subfloat
    {
    \adjustbox{max width=0.5\columnwidth,valign=b}{%
        \input{Extra_fig/Nokia_l2d_val_mean2_alt}
        }
    }
        \subfloat
    {
    \adjustbox{max width=0.5\columnwidth,valign=b}{%
        \input{Extra_fig/Nokia_l2d_val_median2_alt}
        }
    }
    \caption{Comparison of the test-set mean and median distance errors after performing the white-box attack on a model trained with the 5G cellular dataset on both feature functions $\mathsf{F_1}$ and $\mathsf{F}_2$ with and without adversarial training (AT). }
    \label{fig:Nokia_dataset_alt}
    \vspace{-0.4cm}
\end{figure}

\subsubsection*{Results}
%
\fref{fig:Nokia_dataset} shows the mean and median distance errors in meters, depending on the perturbation length $L_p$ with CSI Feature~1. 
%
For $L_p=1$, the unperturbed and perturbed performance is the same (approximately 23\,m mean and 4\,m median distance errors) as the  feature extraction function~$\mathsf{F}_1$ in \fref{sec:positioningpipeline} ignores global phase and amplitude changes. 
%
By increasing the perturbation length, the mean and median distance errors increase rapidly, but the probability map bounds the maximum distance error to approximately $600$\,m, resulting in a saturation behavior as $L_p$ approaches $16$. 
%
As expected, the white-box attack causes the largest mean and median distance errors, whereas the random attack has the least impact but requires no model and CSI feature knowledge and still induces remarkable errors.
%
\fref{fig:scen_3} and \fref{fig:scen_4} illustrate the effect of these two perturbations on a subset of the location estimates with $L_p=16$. While both methods are effective in improving location privacy, the color gradients indicate that coarse localization remains to be possible; see \fref{sec:limitations} for a detailed discussion on the limitations of our work. 
%
The transfer and pool attacks provide improvements over the random attack, albeit only marginally. This indicates that having accurate knowledge of the model and CSI available to the white-box attack would be advantageous, but the other attacks can cause distance errors in excess of  $90$\,m, which enable substantial location privacy improvements. 
%
Note that for this dataset, we do not have accurate SNR estimates, which makes it difficult to study the per-user rates $R$. We shed light on this aspect for the indoor dataset discussed in \fref{sec:indoorwlanscenario}. 

\fref{fig:Nokia_dataset_alt} demonstrates the effect of adversarial training as proposed in \fref{sec:adversarialtraining} to improve resilience of the positioning network to the proposed white-box attack. 
%
We compare Feature~1 with Feature 2 while learning the parameters of the positioning network with and without adversarial training (AT).
%
As expected, adversarial training renders the positioning network more resilient to adversarial attacks for increasing perturbation lengths $L_p$. 
%
However, improved resilience comes a the cost of sacrificing positioning accuracy in absence of any attack as it can be seen for $L_p=1$.
%
We furthermore see that Feature~1, which was also used in \fref{fig:Nokia_dataset}, is more robust to adversarial perturbations whereas Feature~2, which performs (slightly) better for unperturbed data ($L_p=1$), suffers significantly in the presence of the white-box attack. 
%
Evidently, the feature extraction function has a significant impact on the trade-off between attack robustness and positioning accuracy, and we will show next how the impact can differ in an indoor scenario.
%

%%%

\subsection{Indoor WLAN Scenario}
\label{sec:indoorwlanscenario}
%
\subsubsection*{Dataset, Models, and Training}
%
\input{figs/model_in}
%
We now evaluate our attacks on the measured indoor WLAN dataset from~\cite{gonultacs2021csi} consisting of $N = 50\,000$ CSI estimates and ground-truth locations obtained using a VICON precision positioning system \cite{vicon}.
%
The dataset was acquired using a robot moving in an area of $4.2\times 2.9$ m$^2$ of a lab; due to the small area, only small perturbations are to be expected.
%
A mobile transmitter communicates with two $4$-antenna IEEE 802.11ac WLAN APs (AP1 and AP2) both operating at a carrier frequency of $5$\,GHz and a bandwidth of $80$\,MHz under line-of-sight conditions. 
%
The positioning network~$\mathsf{P}$ was trained for AP1 and the alternative network $\mathsf{P}_\text{alt}$ for the transfer attack was trained for AP2, which is at an opposite location of the laboratory environment.
%
The training and test sets were recorded separately. 
%
Each estimated CSI matrix consists of $B=4$ antennas and $W =|\Omega|= 234$ active subcarriers; the CSI feature dimension is $d=3\,570$. The SNR exceeded 10\,dB for all measurements.  
%
\fref{fig:modelindoor} illustrates the used neural network architecture. 


\begin{figure}[tp]
    \centering
    \subfloat 
    {
    \adjustbox{max width=0.5\columnwidth,valign=b}{%
        \input{figs/Emre_l2d_val}
        }
    }
        \subfloat 
    {
    \adjustbox{max width=0.5\columnwidth,valign=b}{%
        \input{figs/Emre_l2d_val_median}
        }
    }
    \caption{Indoor WLAN dataset: mean distance error (left) and median distance error (right) on the test-set for different adversarial attacks and with varying perturbation length $L_p$.}
    \label{fig:Indoor_l2d}
    \vspace{-0.2cm}
%
    \centering
    \subfloat
    {
    \adjustbox{max width=0.5\columnwidth,valign=b}{%
        \input{figs/Emre_c2d_val_2}
        }
    }
    \subfloat
    {
    \adjustbox{max width=0.5\columnwidth,valign=b}{%
        \input{figs/Emre_c2d_val_median_2}
        }
    }
    \caption{Indoor WLAN dataset: mean distance error (left) and median distance error (right) on the test-set for different adversarial attacks dependent on the per-subcarrier rate $R$.}
    \label{fig:Indoor_2rate}
    \vspace{-0.4cm}
\end{figure}


\begin{figure}[tp]
    \centering
    \subfloat 
    {
    \adjustbox{max width=0.5\columnwidth,valign=b}{%
        \input{Extra_fig/Indoor_alttrained_B2D}
        }
    }
        \subfloat 
    {
    \adjustbox{max width=0.5\columnwidth,valign=b}{%
        \input{Extra_fig/Indoor_alttrained_B2M}
        }
    }
    \caption{Comparison of the test-set mean and median distance errors after performing the white-box attack on a model trained with the indoor dataset on both feature functions $\mathsf{F_1}$ and $\mathsf{F}_2$ with and without adversarial training (AT). }    
    \label{fig:exIndoor_l2d_alt}
    \vspace{-0.2cm}
\end{figure}

%

\subsubsection*{Results}
%
\fref{fig:Indoor_l2d} shows the mean and median distance errors in centimeters, for varying perturbation lengths~$L_p$ with Feature~1. For $L_p=1$, the unperturbed and perturbed performance is the same (approximately 8\,cm mean and 4\,cm median distance error). 
%
As for the indoor dataset, increasing the perturbation length causes the mean and median distance errors to increase rapidly but saturate already for $L_P\geq8$. The saturation effect comes from the probability maps which bound the possible position estimates in the relatively small area. 
%
As for the outdoor dataset, the white-box attack causes the strongest perturbation, whereas the random attack has the lowest impact. The random attack can still achieve distance errors of more than 63\,cm on average and 54\,cm on median. The white-box attack has a 5\,cm to 6\,cm advantage over the random attack; the other two attacks yield 2\,cm to 3\,cm.
 
\fref{fig:Indoor_2rate} shows the impact of our attacks to the per-subcarrier rate $R$. We see that the unperturbed model for $L_p=1$ achieves a rate of approximately $R=3.27$\,b/subcarrier at 10\,dB SNR. By increasing the distance errors with a perturbation length of $L_p=8$, the rate drops only marginally, i.e., to about $R=3$\,b/subcarrier, but causes positioning errors of over $50$\,cm.
%
From this result we infer that the impact of adversarial attacks on quality-of-service is negligible and unlikely to be noticed, especially since automatic retransmission often hides such marginal performance losses. 


\fref{fig:exIndoor_l2d_alt} demonstrates the effect of adversarial training as proposed in \fref{sec:adversarialtraining} to improve resilience against perturbation attacks. 
%
Again, we compare Feature 1 with Feature 2 while training the positioning network with and without adversarial attacks in mind.
%
As for the outdoor dataset, we see that adversarial training renders the positioning network more resilient to attacks for growing perturbation lengths $L_p$, but improved resilience comes a the cost of sacrificing positioning accuracy in absence of any attack.
%
Here, we also see that Feature 1 yields improved positioning accuracy compared to Feature 2 in absence of any attack, but Feature 2 turns out to be more robust than Feature 1 with adversarial training, which is in contrast to what we observed in the outdoor scenario. These observations again imply the presence of a trade-off between positioning accuracy and robustness, and highlight the importance of the chosen CSI features. 



\section{Limitations and Implications}
\label{sec:limitations}

We now discuss the limitations and implications of our attacks and defenses. 

\subsection{Limitations of Our Work}

While our work proposes novel means to attack CSI-based off-device positioning systems and suitable countermeasures, the proposed methods  suffer from several limitations. 
%
One key drawback is that the proposed white-box attack requires knowledge of the positioning DNN and the CSI, which is difficult to acquire in practice---our other attacks require less or no knowledge, but also are less effective. 
%
Hence, there is room for more effective attacks that require less knowledge but achieve similar location privacy as the proposed reference white-box attack. 

Our results also indicate that one cannot prevent localization completely while enabling communication. 
%
In particular, \fref{fig:Nokia_locations} demonstrates that our attacks indeed prevent precise localization, but the perturbed locations with our most powerful white-box attack still capture positions on a larger-scale quite accurately. 
%
What is more: As soon as a device connects with a BS or AP, one will always know that the transmitter will be in its vicinity---our attacks cannot prevent that. 
%
The recent trend towards network densification (i.e., placing more BSs and APs in space) and communication at millimeter-wave (mmWave) frequencies further aggravate this issue.
%
Network densification will enable more accurate location estimates simply by processing connectivity information. Furthermore, mmWave communication typically operates under line-of-sight conditions, which further restricts the possible transmitter positions that are in range of a BS or AP. 
%
In addition, jointly processing CSI of one device at multiple BSs and APs to extract location estimates has been shown to significantly improve localization accuracy~\cite{gonultacs2021csi}. We speculate that such multi-point localization methods will be even harder to attack, as the same perturbation will be measured by multiple receivers at different locations in space. 
%
A possible defense might be to equip the transmitter with multiple antennas and to perform adversarial beamforming (e.g., by steering the signal into specific directions). Such  multi-antenna attacks might prove more effective than the ones proposed here and may also be able to fool positioning systems that process AoA and/or ToF, but may degrade the quality-of-service as one has to use sub-optimal beams. 
%
However, if one fuses multi-point CSI estimates with other sensor modalities, e.g., from cameras or radar systems, all such defensive mechanisms are likely to become ineffective, necessitating  fundamentally different attack strategies. 


Furthermore, our randomized training method that renders off-device positioning systems more resilient to adversarial and random attacks indicate that one can (often significantly) improve robustness. While our approach has shown that this comes at the cost of reduced position accuracy,  is is possible that improved adversarial training techniques can be developed which may overcome this drawback. We leave a detailed investigation of this topic for future work. 




 
 

%%%
\subsection{Future Implications}

Evidently, off-device wireless positioning threatens user privacy and security, and future communication systems (e.g., operating at mmWave frequencies) will further facilitate the extraction of accurate location estimates.
%
A pragmatic (albeit na\"ive) approach to prevent CSI-based positioning is to pass legislation that heavily regulates such off-device positioning technologies altogether. However, due to the facts that (i) CSI-based positioning is entirely passive and, hence, difficult (if not impossible) to detect at the transmitter side and (ii) it is notoriously difficult (and costly) to re-engineer a wireless communication receiver (e.g., a BS or AP) in order to determine whether it includes positioning capabilities or not, simply relying on laws or regulations might be insufficient. 
%
We believe that a reasonable path forward is to combine regulations with on-device perturbation attacks that can be turned on when needed.

A more effective approach would be to consider location privacy already in the physical layer specification of future wireless systems. Possible techniques might include encrypted pilot sequences (known to the transmitter and receiver, but not to an eavesdropper), which is not part of most wireless standards. 
%
However, blind channel estimation~\cite{shin2007bilindchest} would still be able to extract accurate CSI if the transmitted packet and the channel's coherence time are sufficiently long.  
%
Hence, we believe that fundamentally new privacy mechanisms must be developed that prevent (or mitigate the efficacy of) off-device localization.


%%%
\section{Conclusions}
%
We have shown that emerging off-device positioning systems that process measured CSI with neural networks cause serious privacy and security concerns. 
%
To address this issue, we have proposed simple yet effective attack mechanisms that perform an on-device convolution of the transmit signal with specifically-designed adversarial or random sequences.
%
Our results demonstrate that the positioning errors for real-world cellular outdoor and WLAN indoor systems can be increased substantially for short perturbation sequences while remaining standard compliant and causing a minimal loss in quality-of-service. 
%
Our results also show that adversarial training can mitigate the impact of our attacks at the cost of reduced accuracy for unperturbed transmissions. 

In summary, our results are encouraging, but reveal that the dichotomy between communication reliability and location privacy is hard to resolve as the acquisition of CSI is inherently linked to wireless transmission. 
%
We therefore expect that emerging communication systems operating at mmWave frequencies and with a denser deployment of BSs or APs that jointly process CSI for positioning, will render the design of effective adversarial attacks even more challenging. 
%
Hence, the design of novel attack and security mechanisms will be required, which ensure location privacy in future wireless systems that enable CSI-based off-device positioning.  
%




\bibliographystyle{IEEEtran}

\bibliography{IEEEabrv,VIPabbrv,jsacbib}


\end{document}
