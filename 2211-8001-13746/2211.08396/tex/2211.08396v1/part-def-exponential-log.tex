%!TEX root = paper-stabilite-exp-log.tex
 
  
  
\subsection{Gonshor's exponentiation}

%\SOURCETXT{Pas \cite{berarducci2018surreal}, attention. Quentin}

The field surreal numbers $\No$ admits an exponential function $\exp$ defined as follows.

\begin{definition}[{Function $\exp$, \cite[page 145]{gonshor1986introduction}}]
	Let $x = \crotq{x'}{x''}$ be the canonical representation of $x$. We define inductively
	$$\exp x = \crotq {\begin{array}{c}
			0, \exp(x')[x-x']_{n},\\
			\exp(x'')[x-x'']_{2n+1}
		\end{array}} {\f{\exp(x')}{[x'-x]_{2n+1}}, \f{\exp(x'')}{[x''-x]_{2n+1}}}$$
	where $n$ ranges in $\Nbb$ and
	$$[x]_{n}  = 1+ \frac{x}{1!} + \dots + \frac{x}{n!},$$
	with the further convention that the expressions containing terms of the form
	$[y]_{2n+1}$ are to be considered only when $[y]_{2n+1} > 0$.
\end{definition}
%\SOURCETXT{copié collée de BM}
It can be shown that the function $\exp$ is a surjective homomorphism from $(\No, +)$ to $(\No^{>0}, ·)$ which extends $\exp$ on $\Rbb$ and makes $(\No, +, ·, \exp)$ into an elementary extension of $(\Rbb,+,·,\exp)$ (see \cite[Corollaries 2.11 and 4.6]{van1994elementary}, \cite{DriesEhrlich01} and \cite{ressayre1993integer}). As $\exp$ is surjective, and from its properties, it can be shown that it has some inverse $\ln : \No^{>0} \to \No$ (called logarithm).
%\SOURCETXT{BM AGAIN}

\begin{definition}[Functions $\log$, $\log_{n}$, $\exp_{n}$]
 Let $\ln : \No^{>0} \to \No$ (called logarithm) be the inverse of $\exp$. We let $\exp_{n}$ and $\ln_{n}$ be the $n$-fold iterated compositions of $\exp$ and $\ln$ with
themselves.
\end{definition}
%\SOURCETXT{Quentin}

We recall some other basic properties of the exponential functions:


\begin{theorem}[{\cite[Theorems 10.2, 10.3 and 10.4]{gonshor1986introduction}}]
	\label{thm:expAppreciables}
	For all $r\in\Rbb$ and $\epsilon$ infinitesimal, we have 
	\centre{$\exp r = \Sum{k=0}\infty{\f{r^k}{k!}} \qandq \exp \epsilon = \Sum{k=0}{\infty}\f{\epsilon^k}{k!}$}
 	\lc{and}{$
		\exp(r+\epsilon) = \exp(r)\exp(\epsilon) = \Sum{k=0}{\infty}\f{(r+\epsilon)^k}{k!}$}
	Moreover for all purely infinite number $x$,
		$$\exp(x+r+\epsilon) = \exp(x)\exp(r+\epsilon)$$
\end{theorem}

\begin{proposition}[{\cite[Theorem 10.7]{gonshor1986introduction}}]
	\label{prop:formeExpXPurelyInfiniteOmegaA}
	If $x$ is purely infinite, then $\exp x=\omega^a$ for some surreal number $a$. 
\end{proposition}
More precisely:
\begin{proposition}[Function $g$, {\cite[Theorem 10.13]{gonshor1986introduction}}]
	\label{prop:formeExpXPurelyInfiniteOmegaAg}
	If $x$ is purely infinite, \textit{i.e.} $x=\Sum{i<\nu}{}r_i\omega^{a_i}$ with $a_i>0$ for all $i$, then 
	$$\exp x=\omega^{\Sum{i<\nu}{}r_i\omega^{g(a_i)}},$$
	for some function $g: \No^{>0 }\to \No$. 	Function $g$ satisfies for all $x$, 
	$$g(x) = \crotq{c(x),g(x')}{g(x'')}$$
	where $c(x)$ is the unique number such that $\omega^{c(x)}$ and $x$ are in the same Archimedean class \cite[Thm. 10.11]{gonshor1986introduction} (i.e. such that 
	$x\asymp\omega^{c(x)}$),  where $x'$ ranges over the lower non-zero prefixes of $x$ and $x''$ over the upper prefixes of $x$.
\end{proposition}


\subsection{About some properties of function $g$}


\begin{proposition}[{\cite[Theorem 10.14]{gonshor1986introduction}}]
	\label{prop:gord}
	If $a$ is an ordinal number then
	$$ g(a)=\begin{accolade}
		a+1 & \text{if } \lambda\leq a <\lambda+\omega \text{ for some }\epsilon\text{-number }\lambda\\
		a& \text{otherwise}
	\end{accolade}$$
\end{proposition}

Note that in the previous proposition, $a\neq 0$ since $g$ is defined only for positive elements.

\begin{proposition}[{\cite[Theorem 10.15]{gonshor1986introduction}}]
	\label{prop:gMonomeInfinitesimal}
	Let $n$ be a natural number and $b$ be an ordinal. We have
	$ g(2^{-n}\omega^{-b})=-b+2^{-n}.$
\end{proposition}

\begin{proposition}[{\cite[Theorems 10.17, 10.19 and 10.20]{gonshor1986introduction}}]
	If $b$ is a surreal number such that for some $\epsilon$-number $\epsilon_i$, some ordinal $\alpha$ and for all natural number $n$,
	$\epsilon_i+n<b<\alpha<\epsilon_{i+1}$, then $g(b)=b$. This is also true if there is some ordinal $\alpha<\epsilon_0$ such that for all natural number $b$, $n\omega^{-1}<b<\alpha <\epsilon_0$.
\end{proposition}

\begin{proposition}[{\cite[Theorem 10.18]{gonshor1986introduction}}]
	If $\epsilon\leq b\leq\epsilon + n$ for some $\epsilon$-number $\epsilon$ and some integer $n$. In particular, the sign expansion of $b$ is the sign expansion of $\epsilon$ followed by some sign expansion $S$. Then, the sign expansion of $g(b)$ is the sign expansion of $\epsilon$ followed by a $+$ and then $S$. In particular, $g(b)=b+1$. 
\end{proposition}

It is possible to bound the length of $g(a)$ depending on the length of $a$. 

\begin{lemma}[{\cite[Lemma 5.1]{DriesEhrlich01}}]
	\label{lem:lengthGA}
	For all $a\in\Nobf$, $\length{g(a)}\leq \length a +1$.
\end{lemma}

The function $g$ has a inverse function, $h$ defined as follows

$$h(b) = \crotq{0,h(b')}{h(b''),\f{\omega^b}{n}}$$
This expression is uniform (see \cite{gonshor1986introduction}) and then does not depend of the expression of $b$ as $\crotq{b'}{b''}$.

\begin{corollary}
	\label{cor:hmord}
	If $a$ is an ordinal number then $h(-a)=\omega^{-a-1}$.
\end{corollary}

\begin{proof}
	It is a direct consequence of Proposition \ref{prop:gMonomeInfinitesimal} and the fact that $h=g^{-1}$.
\end{proof}

As for $g$, we can bound the length of $h(a)$ in function of the length of $a$.

\begin{lemma}[{\cite[Proposition 3.1]{aschenbrenner:hal-02350421}}]
	\label{lem:lengthH}
	For all $a\in\Nobf$ we have, 
	$$\length{h(a)}\leq\omega^{\length a +1} $$
\end{lemma}
We will also prove another lemma, Lemma \ref{lem:lengthOmegaGA}, that looks like the previous lemma but that is better in many cases but not always. To do so we first prove another technical lemma.

\begin{lemma}
	\label{lem:gomegacCasSpec}
	For all $c$, denote $c_+$ the surreal number whose signs sequence is the one of $c$ followed by a plus. Assume $g(a)<c$ for all $a\sqsubset\omega^c$ such that $0<a<\omega^c$. Then $g(\omega^c)$ is $c_+$ if $c$ does not have a longest prefix greater than itself, otherwise, $g(\omega^c)=c''$ where $c''$ is the longest prefix of $c$ such that $c''>c$.
\end{lemma}

\begin{proof}
	By induction on $c$:
	
	\begin{itemize}
		\item For $c=0$, $g(\omega^0)=g(1)=1$ whose signs sequence is indeed the one of $0$ followed by a plus.
		
		\item Assume the property for $b\sqsubset c$. Assume $g(a')<c$ for all $a'\sqsubset\omega^c$ such that $0<a'<\omega^c$. Then,
		$$
			g(\omega^c)=\crotq{c}{g(a'')}
		$$
		where $a''$ ranges over the elements such that $a''\sqsubset \omega^c$ and $a''>\omega^c$.
		
		\begin{itemize}
			\item First case: $c$ has a longest prefix $c_0$ such that $c_0>c$. Then, for all $a''$ such that $a''\sqsubset \omega^c$ and $a''>\omega^c$, $a''\succeq \omega^{c_0}$, hence $g(a'')> c_0$. Since $c<c_0<g(a'')$, the simplicity property ensures $g(\omega^c)\sqsubseteq c_0\sqsubset c$. Then $g(\omega^c)$ is some prefix $c''$ of $c$, greater than $c$. 	We look at $\omega^{c''}$. Notice that for all $b\sqsubset c''$ is such that $0<b<c''$, $b\sqsubset c$ and $b<c$, hence $g(b)<c<c''$. Therefore we can apply the induction hypothesis to $c''$ and $g(\omega^{c''})$ is $c''_+$ if the signs sequence of $c$ does not end with only minuses, otherwise, $g(\omega^{c''})$ is the last (strict) prefix of $c''$ greater than $c''$. 
			
			\begin{itemize}
				\item First subcase: $g(\omega^{c''})=c''_+$. If there is some $b$ such that $c''\sqsubset b\sqsubset c$ and $b>c$, then $g(\omega^b)$ is a prefix of $g(\omega^c)=c''$. But, $c''=g(\omega^c)<g(\omega^b)<g(\omega^{c''})=c''_+$. Then $c''$ must be a strict prefix of $g(\omega^b)$ which is a contradiction. Then $c''$ is indeed the last strict prefix of $c$ greater than $c$.
				
				\item Second subcase:  $g(\omega^{c''})$ is the last (strict) prefix of $c''$ greater than $c''$. If there is some $b$ such that $c''\sqsubset b\sqsubset c$ and $b>c$, then $g(\omega^b)$ is a prefix of $g(\omega^c)=c''$. Since $g(b)<g(c'')$, $g(b)$ is prefix of $c''$ smaller than $c''$. But this contradicts the fact that $g(\omega^b)>g(\omega^c)=c''$. Therefore, $c''$ is the last prefix of $c$ greater than $c$.
			\end{itemize}
			
			
			\item Second case: $c$ does not have a longest prefix greater than $c$. Then,
			$$
				g(\omega^c) = \crotq c{g(\omega^{c''})}
			$$
			where $c''$ ranges over the prefixes of $c$ greater than $c$. Let $d\sqsubset c$ such that $d>c$. Then there is $d_1$ or minimal length such that $d\sqsubset d_1\sqsubset c$ and $d_1>c$. By minimality of $d_1$, $d$ is the longest prefix of $d_1$ greater than $d_1$. As in the first case, we can apply the induction hypothesis on $d_1$ and get $g(\omega^{d_1})=d$. Therefore, again by induction hypothesis,
			$$
				g(\omega^c)=\crotq c{c'',c''_+} = \crotq c{c''}
			$$
			where $c''$ ranges over the prefixes of $c$ greater than $c$. We finally conclude that $g(\omega^c)=c_+$.
		\end{itemize}
	\end{itemize}
\end{proof}

In the following we denote $\oplus$ the usual addition over the ordinal numbers and~$\otimes$ the usual product over ordinal numbers.


\begin{lemma}
	\label{lem:lengthOmegaGA}
	For all $a>0$, $\length a\leq\length{\omega^{g(a)}}\otimes(\omega+1)$.
\end{lemma}

\begin{proof}
	We proceed by induction on $\length a$. 
	\begin{itemize}
		\item For $a=1$, $g(a)=1$ and we indeed have $1\leq \omega^2$.
		
		\item Assume the property for all $b\sqsubset a$. Let $c$ such that $\omega^c\asymp a$. Then 
		$$
			g(a)=\crotq{c,g(a')}{g(a'')}
		$$
		We split into two cases:
		\begin{itemize}
			\item If there is some $a_0\sqsubset a$ such that $a_0<a$ and $g(a_0)\geq c$ then
			$$
			g(a)=\crotq{g(a')}{g(a'')}
			$$
			and if $S$ stand for the signs sequence such that $a$ is the signs sequence of $a_0$ followed by $S$, $g(a)$ is the signs sequence of $g(a_0)$ followed $S$. Let $\alpha$ the length of $S$. Therefore using Theorem \ref{thm:serieToSignExp},
			$$
			\length{\omega^{g(a)}}\geq\length{\omega^{g(a_0)}}\oplus(\omega\otimes\alpha)
			$$
			and then,
			\begin{align*}
				\length{\omega^{g(a)}}\otimes(\omega+1) &\geq \length{\omega^{g(a_0)}}\otimes\omega\oplus \length{\omega^{g(a_0)}}\oplus\alpha \\
				&\geq\length{\omega^{g(a_0)}}\otimes(\omega+1)\oplus\alpha
			\end{align*}
			and by induction hypothesis on $a_0$,
			$$
			\length{\omega^{g(a)}}\otimes(\omega+1)\geq\length{a_0}\oplus\alpha=\length a
			$$
			
			\item Otherwise, for any $a_0\sqsubset a$ such that $a_0<a$, $g(a_0)<c$. Therefore,
			$$ g(a)=\crotq{c}{g(a'')}$$
			Also, since $a>0$, we can write the signs sequence of $a$ as the one of $\omega^c$ followed by some signs sequence $S$. If $S$ contains a plus, then there is a prefix of $a$, $a_0$ such that $a_0<a$ and still $a_0\asymp\omega^c$ and then $g(a_0)>c$ what is not the case by assumption. Then, $S$ is a sequence of minuses. If $S$ is not the empty sequence, let $\alpha$ be the length of $S$. Then the signs sequence of $g(a)$ is the one of $g(\omega^c)$ followed by $S$. Hence,
			$$
				\length{\omega^{g(a)}}\geq \length{\omega^{g(\omega^c)}}\oplus(\omega\otimes\alpha)
			$$ 
			As in the previous case, but using the induction hypothesis on $\omega^c$,
			$$
				\length{\omega^{g(a)}}\otimes(\omega+1)\geq\length{\omega^c}\oplus\alpha=\length a
			$$
			Now if $S$ is the empty sequence, $a=\omega^c$. Applying Lemma \ref{lem:gomegacCasSpec} to $c$ we get that either $g(a)=c_+$ or $g(a)$ is the last prefix of $c$ greater than $c$. If the first case occurs then $a$ is a prefix of $\omega^{g(a)}$ and then $\length{\omega^{g(a)}}\geq\length a$. Now assume that the second case occurs. Then for any $b$ such that $g(a)\sqsubset b\sqsubset c$, $b<c$.
			If for all $b'\sqsubset b$ such that $b'<b$, $g(b')<b$, then Lemma \ref{lem:gomegacCasSpec} applies. Since $b$ has a last prefix greater than itself, $g(a)$, $g(\omega^b)=g(a)$ and we reach a contradiction since $b<c$ and therefore $\omega^b<\omega^c=a$. Then for all  $b$ such that $g(a)\sqsubset b\sqsubset c$, there is some $b'\sqsubset b$, $b'<b$ such that $g(\omega^{b'})>b$. Since the signs sequence of $b$ consists in the one of $g(a)$ a minus and then a bunch of pluses, and since $g(\omega^{b'})$ must also a a prefix of $c$, $g(\omega^{b'})\sqsubseteq g(a)\sqsubset b$. Therefore to ensure $g(b')>b$, we must have $g(\omega^{b'})\geq g(a)$. Since $\omega^{b'}$ is a prefix of $a$ lower than $a$, it is a contradiction. Therefore, there is no $b$ such that $g(a)\sqsubset b\sqsubset c$ and $b<c$, and finally, the signs sequence of $c$ is the one $g(a)$ followed by a minus. In particular, $g(a)$ and $c$ have the same amount of pluses, say $\alpha$. Then, using Theorem \ref{thm:serieToSignExp},
			\begin{align*}
				\length a &= \length{\omega^{g(a)}}\oplus\omega^{\alpha+1}\\
				&\leq \length{\omega^{g(a)}}\oplus \length{\omega^{g(a)}}\otimes\omega = \length{\omega^{g(a)}}\otimes\omega\\
				&\leq \length{\omega^{g(a)}}\otimes(\omega+1)
			\end{align*}
		\end{itemize}
		The induction principle concludes.
	\end{itemize}
\end{proof}

\begin{corollary}
	\label{cor:lengthOmegaGA}
	For all $a>0$ and for all multiplicative ordinal greater than $\omega$, if $\length a\geq\mu$, then $\length{\omega^{g(a)}}\geq\mu$.
\end{corollary}

\begin{proof}
	Assume the that $\length{\omega^{g(a)}}<\mu$. Then using Lemma \ref{lem:lengthOmegaGA}, $\mu\leq \length{\omega^{g(a)}}\otimes(\omega+1)$. Since $\mu$ is a multiplicative ordinal greater than $\omega$, we have $\omega+1<\mu$. $\mu$ is a multiplicative ordinal, hence $\length{\omega^{g(a)}}\otimes(\omega+1)<\mu$ and we reach a contradiction.
\end{proof}

\subsection{Gonshor's logarithm}

We already know that a logarithm exist over positive surreal numbers. Nevertheless we were very elliptical and we now get deeper into it.

\begin{definition}
	For a surreal number $a$ in canonical representation $a=\crotq{a'}{a''}$, we define
	$$
		\ln\omega^a=\crotq{\begin{array}{c}
				\enstq{\ln\omega^{a'}+n}{\begin{array}{c}n\in\Nbb\\ a'\sqsubset a\\ a'<a\end{array}}\\
				\enstq{\ln\omega^{a''}-\omega^{\frac{a''-a}n}}{\begin{array}{c}n\in\Nbb\\ a''\sqsubset a\\ a<a''\end{array}}
			\end{array}\!\!}{\!\!\begin{array}{c}
				\enstq{\ln\omega^{a''}-n}{\begin{array}{c}n\in\Nbb\\ a''\sqsubset a\\ a<a''\end{array}}\\
				\enstq{\ln\omega^{a'}+\omega^{\frac{a-a'}{n}}}{\begin{array}{c}n\in\Nbb\\ a'\sqsubset a\\ a'<a\end{array}}
			\end{array}}
	$$
\end{definition}
As often with this kind of definitions, the uniformity property holds.
\begin{lemma}[{\cite[Lemma 10.1]{gonshor1986introduction}}]
	The definition of $\ln\omega^a$ does not require $a$ in canonical representation.
\end{lemma}


\begin{proposition}[{\cite[Theorem 10.8]{gonshor1986introduction}}]
	\label{prop:lnOmegaA}
	For all surreal number $a$, $\ln\omega^a$ is purely infinite.
\end{proposition}
Purely infinite numbers are a special case in the definition of the exponential function. We can state the previous definition of $\ln$ is consistent with the one of $\exp$.


\begin{theorem}[{\cite[Theorem 10.9]{gonshor1986introduction}}]
	\label{thm:expLnOmegaA}
	For all surreal number $a$, 
	$$\exp\ln\omega^a=\omega^a$$
\end{theorem}

\begin{theorem}[{\cite[Theorem 10.12]{gonshor1986introduction}}]
	\label{thm:lnOmegaOmegaA}
	For all surreal number $a$, 
	$$\ln\omega^{\omega^a}=\omega^{h(a)}$$
\end{theorem}
The above theorem is not actually stated like this in \cite{gonshor1986introduction} but this statement follows from the proof there.

As a consequence of Theorems \ref{thm:expLnOmegaA} and \ref{thm:lnOmegaOmegaA} and Propositions \ref{prop:lnOmegaA} and \ref{prop:formeExpXPurelyInfiniteOmegaAg}, we have 

\begin{corollary}
	For all surreal number $a=\aSurreal$, we have
	$$
		\ln\omega^a = \Sumlt i\nu r_i\omega^{h(a_i)}
	$$ 
\end{corollary}

Finally, since for appreciable numbers $\exp$ is defined by its usual serie, $\ln(1+x)$ is also defined by its usual serie when $x$ in infinitesimal. More precisely,

\begin{definition}
	\label{def:lnAppreciables}
	For $x$ an infinitesimal, 
	$$
		\ln(1+x) = \Sum{i=1}{\infty}\frac{(-1)^{i-1}x^i}{i}
	$$
\end{definition}
And thanks to Theorem \ref{thm:expAppreciables},

\begin{corollary}
	Let $a=\aSurreal$ a positive surreal number. Then
	$$
		\ln a = \ln\omega^{a_0} + \ln r_0 + \ln\pa{1+\Sumlt{1\leq i}\nu \frac{r_i}{r_0}\omega^{a_i-a_0}}
	$$
	where the last term is defined in Definition \ref{def:lnAppreciables}.
\end{corollary}


\subsection{Stability of $\Nolambda$ by exponential and logarithm}

We first recall some result by van den Dries and Ehrlich.

\begin{lemma}[{\cite[Lemmas 5.2, 5.3 and 5.4]{DriesEhrlich01}}]
	\label{lem:lengthExpLog}
	For all surreal number $a\in\Nobf$,
	\begin{itemize}
		
		\item $\length{\exp a}\leq\omega^{\omega^{2\length a\oplus3}}$
		
		\item $\length{\ln\omega^a} \leq \omega^{4\omega\length{a}\length{a}}$
		
		\item $\length{\ln a}\leq\omega^{\omega^{3\length a\oplus3}}$
	\end{itemize}
\end{lemma}


\begin{corollary}[{\cite[Corollary 5.5]{DriesEhrlich01}}]
	\label{cor:NolambdaStableExpLn}
	For $\lambda$ an $\epsilon$-number, $\Nolt\lambda$ is stable under $\exp$ and $\ln$.
\end{corollary}

We have 

\begin{theorem}[{\cite[Theorem 1.3]{bournez2022surreal}}]
	The following are equivalent:
	\label{thm:NoltStableExpLn} 
	\begin{itemize}
		\item $\Nolambda$ is a subfield of $\No$ stable by $\exp$, and $\ln$ 
		\item   $\Nolambda$ is a subfield of $\No$ 
		\item  $\lambda$ is some $\epsilon$-number.
	\end{itemize}
\end{theorem}

