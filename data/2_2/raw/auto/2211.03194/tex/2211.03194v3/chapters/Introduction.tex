% !TeX spellcheck = en_GB
%!TEX root = ../side-constrained.tex

\section{Introduction}
Traffic assignment problems have been
successfully applied in the past decades in order
to model, predict and optimize traffic distributions.
While in most models, the  network infrastructure
is equipped with capacities, it is usually assumed that
the excess of capacity is possible and leads to congestion, that is,
increased travel times, e.g., by increased waiting times in queues. 
In several realistic scenarios, however, 
there are also hard capacity constraints that must not be violated
by any feasible traffic flow. For instance, hard traffic volume restrictions
are imposed by local authorities in order to keep the exhaust gas emissions within urban residential areas below certain threshold values, see \citefulls{Grote2016}.
Following \citefulls{zhong11}, another example includes
tunnels, in which the number of vehicles inside the tunnel is limited to maintain sufficient reserve capacity/space for handling any possible incident (e.g., car accidents or disruptions due to disaster).

From a theoretical and computational perspective, the traffic assignment problem
 with hard side-constraints has been studied extensively for \emph{static flows} using methods
from convex optimization, see~\cite{Hearn98solving, Larsson99,Larsson95,Marcotte04}
and references therein. These works mostly considered edge-capacity constraints and
studied the optimization problem minimizing the Beckmann-McGuire-Winsten potential
subject to these constraints.
 The dual variables associated with the capacity constraints
are used as additional prices or  queueing delays and the optimal solutions
are interpreted as unconstrained Wardrop equilibria \wrt \emph{generalized travel costs} consisting of  the actual
delay plus the dual prices along a path.
This way, using the convexity of both the feasible space and the objective function, such special capacitated equilibria can be completely characterized as solutions
to associated variational inequalities. 
Most works cited above, however,  used the solutions of the convex optimization
problem or, equivalently, solutions to the associated variational inequalities \emph{as the definition} of a capacitated user (or Wardrop) equilibrium. Only a few works noted a conceptual gap between 
introducing a \emph{behavioural equilibrium concept} in the sense of defining an associated noncooperative game versus using solutions to a variational inequality formulation
as its definition -- see the discussions in \citeauthor*{CorreaCapEqInStaticFlows}~\cite[968]{CorreaCapEqInStaticFlows}, Bernstein and Smith~\cite{BernsteinS94} and \citefulls{Marcotte04}.

In this article, we revisit the \emph{dynamic traffic assignment problem with side-constraints}.
Based on the  path-delay operator model in the $L^2$-function space introduced in seminal works by \citeauthor*{FrieszLTW89}~\cite{FrieszLTW89,Han2013} (see also Friesz and Han~\cite{Friesz19}
for a recent overview),
we consider  general side-constraints
ranging from edge-volume constraints and path inflow constraints to abstract constraint sets.
While the dynamic traffic assignment problem with side-constraints is far less explored compared to the
static variant, there are a few works studying fundamental questions related
to the existence, structure and computability of constrained dynamic equilibria.
One of the central works in this area is the paper by Zhong, Sumalee, Friesz and Lam~\cite{zhong11},
who were the first to consider side-constraints within the general  path-delay operator model.
 They assumed a fixed flow volume
and flexible departure time choice and instantiated the network loading
using (linear) volume-delay functions. The side-constraints were given by arc-volume constraints. They defined a side-constrained dynamic user equilibrium
via solutions of an associated infinite-dimensional variational inequality (VI) which needs to be solved over
the space of capacity-feasible dynamic flows. As one of their main results (Proposition~3.1, p.~1040), they claimed the
existence of side-constrained dynamic user equilibria arguing that the respective  VI
always admits a solution. The proof of this claim uses that the capacity-feasible dynamic flow space is bounded, closed and convex. Only these properties would allow the invocation
of general existence results for VI's in appropriate function spaces by~Browder~\cite{BROWDER1968}.
 
 \subsection{Our Contribution}
 We study  dynamic traffic assignment problems using the general path-delay-operator
 form as proposed by \citefull{FrieszLTW89} and augment this model
 with side-constraints. In fact, we will consider a more general general \emph{walk}-delay-operator model, because some interesting side-constraints such as energy-constraints for electric vehicles (see \citefull{GHP22}) require cyclic routes. Our contribution consists of four types of results.

 \begin{enumerate}
\item We first show that the claim of existence of side-constrained dynamic user equilibria 
 defined as solutions to a VI (\citefull[Proposition~3.1, p.~1040]{zhong11}) is wrong -- we give a nontrivial counterexample to this claim.
 The underlying reason lies in the fact
 that the side-constrained dynamic flow space need not be convex in general.  
 The consequences of the counterexample are somewhat severe since not only does the
 assumed existence result break down but, perhaps more seriously, the counterexample
 reveals that the proposed VI is in fact not a suitable definition of a side-constrained dynamic equilibrium.
\item We introduce -- in line with prior works for the static flow model (e.g.,  \citefull[968]{CorreaCapEqInStaticFlows}, \citefull{BernsteinS94} and \citefull{Marcotte04}) -- a \emph{behavioral equilibrium concept} via formally introducing a noncooperative game modeling the
 space of feasible deviations of users given a dynamic flow. Roughly speaking, a dynamic flow is an equilibrium, if there is no arbitrarily small bundle of users that can switch their strategy in space and time and strictly reduce their 
 travel cost.
 The precise way a feasible deviation is defined leads to a whole set of equilibrium concepts and we propose several of them including dynamic extensions of  Larsson-Patriksson (LP), Bernstein-Smith (BS)
 and Marcotte-Nguyen-Schoeb (MNS) equilibria, respectively,  which were originally proposed for static equilibrium flows. 
 \item Given an equilibrium concept for side-constrained dynamic equilibrium flows,
 obvious questions related to their characterization, existence and computability arise. 
 Under natural assumptions on the structure of the side-constraints and the set of feasible deviations, we give necessary and sufficient conditions under which an equilibrium can be described as a solution to an associated quasi-variational inequality. Additionally, we give more restrictive assumptions under which they can even be characterized by a variational inequality.
 We further show that equilibrium solutions exist, 
 if the set of side-constrained dynamic flows is convex and the walk-delay operator 
 is sequentially weak-strong continuous. 
 \item As the counterexample to \citefulls{zhong11} suggests, the model with edge-volume constraints
 can lead to non-convex flow spaces which means that standard existence tools from
the infinite dimensional VI theory cannot be used.
 For modelling volume constraints, we first describe a network loading model and then introduce 
 abstract \emph{edge-load functions} which include flow volumes as a special case.
 We show existence of dynamic LP
 and MNS equilibria
 under mild continuity assumptions on the edge-load functions. Our existence proof is
 in some sense constructive as it uses an augmented Lagrangian function approach
 (see~\cite{Larsson95} for such an approach for static flows) for violated edge-load constraints
 and invokes, in a black-box fashion, solutions to the relaxed equilibrium problem.
 We further show, however, that this  augmented Lagrangian approach fails for other, stricter equilibrium concepts such as the dynamic BS equilibrium: we give 
 an example in which the flows for the unconstrained  model with penalties do not converge to a (strong) dynamic BS equilibrium.
 %  \end{framed} 
 \end{enumerate}
   Finally, it is worth mentioning that our model and the subsequent characterization and existence results
require only mild continuity properties of the walk-delay operator and the edge load functions, respectively,  and
thus  apply for
several  realistic and well-studied network loading models including the Vickrey queueing model with point queues~\cite{CominettiCL15,CominettiCO17,Koch11,OlverSK21,Vickrey94}, with spillback~\cite{Sering2019} with departure-time choice~\cite{FrascariaO20,Han2013}, the  Lighthill-Whitham-Richards (LWR) model~\cite{HanPi16} and the classical link-delay model
 of \citefulls{Friesz93}.


 \subsection{Related Work}

Two of the earliest papers in the field of dynamic traffic assignment 
are papers by \citeauthor*{Friesz93}~\cite{Friesz93,FrieszLTW89} who introduced the formalism
of a path-delay operator and investigated variational inequality and optimal control formulations under
specific network loading models, see also Boyce, Ran and LeBlanc~\cite{BoyceRL95,RanBL93}.
For an overview of further relevant works, we refer to the survey article by Friesz and Han~\cite{Friesz19}. A key development in this field are the identification of certain continuity
conditions of the path-delay operator in order to establish equilibrium existence.
This has been successfully shown for various network loading models ranging
from the link-delay model~\cite{ZhuM00} and the Vickrey model with point queues~\cite{CominettiCL15,GrafHS20,Han2013a,Koch11,MeunierW10} to the  Lighthill-Whitham-Richards (LWR) model~\cite{FrieszHanPedro13,HanPi16}.
 
It is worth noting that dynamic traffic models with spillback (cf.~\cite{HanPi16,Sering2019}), can be interpreted as an alternative way of handling hard capacities limiting the flow volume on particular edges. However, there is an important conceptual difference to side-constrained dynamic traffic assignment models: 
Spillback models allow the injection of flow into arbitrary paths and whenever the capacity restriction on an edge is reached, additional flow is prohibited from entering this edge and has to wait on the previous edge instead (causing additional congestion there). Thus, the spillback effect influences the agents behaviour only indirectly via the increased path-delays. 
In a model with hard side-constraints, on the other hand, the volume constraints directly influence the agents' behaviour by restricting their strategy space: \Ie if entering a certain path at a specific time would lead to a violation of any edge capacity on that path, such a flow is considered to be infeasible.
Our model can be seen as a strict generalization of both ideas as we do allow spillback models for the network loading
but in addition we can model hard side-constraints.


For dynamic traffic assignment with hard side-constraints not much is known.
\citefulls{zhong11} considered the path-operator model with a linear volume-delay formulation
for the network loading. They defined side-constrained dynamic equilibria as solutions to an associated
infinite dimensional variational inequality and claimed existence of such equilibria.
\citefulls{Hoang19} transferred the static BMW equilibrium concept to
a dynamic model by discretizing time and then considering a time-expanded network.
In a similar way \citefulls{Hamdouch2004} extended the static equilibrium concept from~\cite{Marcotte04} to a dynamic setting.

 
 \subsection{Paper Organization}
 We start the paper by recapping in \Cref{sec:static} the theory of side-constrained static equilibrium flows. Already for static models, the issue about properly defining side-constrained equilibria arises and we try to sketch the historic development of the key concepts in the field.
 In \Cref{sec:dynamic}, we introduce the basic dynamic traffic assignment model.
 In \Cref{sec:counter}, we give a counterexample to \citefull[Proposition~3.1, p.~1040]{zhong11} which illustrates the need of rethinking an appropriate
 solution concept for traffic assignment models with side-constraints.
 
 In \Cref{sec:framework}, we introduce our abstract framework of side-constrained
 dynamic traffic equilibria. In \Cref{sec:characterization}, we turn to characterization
 results of  such equilibria  in terms of variational or quasi-variational inequalities.
 Finally, in \Cref{sec:SCviaNL}, we derive  two equilibrium existence results for a class of 
 non-convex volume-constrained traffic models using an augmented Lagrangian penalty function approach.
  