% !TeX spellcheck = en_GB
%!TEX root = ../side-constrained.tex

\section{A General Framework for Side-Constrained Dynamic Equilibria}\label{sec:framework}

The general idea of dynamic equilibria is to find a walk inflow $h$ such that (almost) no particle has a better alternative. In the unconstrained case, ``alternative'' just means any other walk (and departure time) available to that particle's commodity. In particular, the set of all alternatives of any given particle is independent of the specific flow induced by $h$. This need not be the case anymore for flows with side-constraints as, for example, a certain walk may become unavailable depending on the flow volume already on any particular edge of this walk under $h$.

We will now introduce an abstract framework that will allow us to define different types of such side-constrained equilibria. This framework consists of two objects: First, we have a constraint set $S \subseteq \Lambda(Q)$ defining the set of feasible walk inflows. Second, for every commodity $i \in I$ and walk $p \in \Pc_i$, there is a correspondence
	\[A_p: S \to 2^{\Pc_i \times L_+^2(\planningInterval) \times \IR}, h \mapsto A_p(h),\]
mapping every walk inflow $h$ to the set of \emph{\addmEpsDev s} of commodity $i$ from walk $p$. Hereby, $2^X$ denotes the power set of $X$. An element $(q,\shiftN,\Delta) \in A_{p}(h)$ then denotes the following \addmEpsDev: Given the walk inflow $h$, commodity $i$ is allowed to shift flow from walk~$p$ to walk~$q$ by reducing the walk-inflow into~$p$ by~$\shiftN \in L_+^2(\planningInterval)$ and increasing the one into~$q$ using the same function~$\shiftN$ but with an additional time shift of~$\Delta$. 

For any such $(q,\shiftN,\Delta) \in A_{p}(h)$ we will denote the walk inflow obtained after this deviation by
\begin{equation}\label{eq:H-r}
	H_{p\to q}(h,\shiftN,\Delta) \coloneqq (h'_w)_{w \in \Pc} \text{ with } h'_w(t) \coloneqq \begin{cases} 
		h_p(t) - \shiftN(t), &\text{for } w=p\\
		h_q(t) + \shiftN(t-\Delta), &\text{for } w=q\\
		h_{w}(t), &\text{else}
	\end{cases}.
\end{equation}
\Cref{fig:ExampleAddmEpsDev} provides a graphical depiction for how $H_{p\to q}(h,\shiftN,\Delta)$ is obtained from $h$.
In order to ensure that we have $H_{p \to q}(h,\shiftN,\Delta) \in \Lambda(Q)$, we will always require that $A_p$ are defined such that any \addmEpsDev{} $(q,\shiftN,\Delta) \in A_p(h)$ satisfies the following three properties:

\begin{figure}[h]
	\centering
	\begin{adjustbox}{max width=.7\textwidth}
		\input{tikz/ExampleAdmEpsDev}
	\end{adjustbox}
	\caption{An example for how an \addmEpsDev{} $(q,\shiftN,\Delta) \in A_{p}(h)$ changes the path inflow rates on the involved paths $p$ and $q$ from the original flow $h$ (left) to the new flow $h' \coloneqq H_{p\to q}(h,\shiftN,\Delta)$ (right).}\label{fig:ExampleAddmEpsDev}
\end{figure}

\begin{itemize}
	\item $\shiftN \leq h_p$, \ie we do not remove too much flow. This ensures that the walk-inflow rates stay non-negative.
	\item $h_q(t) + \shiftN(t-\Delta) \leq B_q$ for almost all $t \in \planningInterval$, \ie we do not move too much flow onto walk~$q$.
	\item $\supp(\shiftN(\emptyarg-\Delta)) \subseteq \planningInterval$, \ie no flow is moved outside the planning horizon.\footnote{As $\shiftN \in L^2(\planningInterval)$ is formally an equivalence class of functions, its support is only defined up to a null-set. Hence, an inclusion $\supp(\shiftN) \subseteq A$ should be interpreted as $\supp(\shiftN)\setminus A$ having measure zero for any choice of representative of~$\shiftN$.}
\end{itemize}
This, in particular, ensures that $\Psi$ is well defined on any such flow $H_{p \to q}(h,\shiftN,\Delta)$.

The correspondence
\[
\begin{aligned}
	M_i: &S \to L^2_+ ([t_0,t_f])^{\Pc}\\ 
	& h \mapsto \set{h' \in L^2 ([t_0,t_f])^{\Pc} | \exists p \in \Pc_i, (q,\shiftN,\Delta) \in A_p(h): h' = H_{p \to q}(h,\shiftN,\Delta)}\end{aligned}\]
then returns for any given walk inflow $h$ the set of all possible walk inflows obtained by any of commodity $i$'s \addmEpsDev. Note that, in general, $M_i$ and $S$ can be completely independent of each other. In particular, a flow obtained by an \addmEpsDev{} might be infeasible (\ie $M_i(h) \not\subseteq S$) and not all feasible flows might be reachable by an \addmEpsDev{} even if they only differ by a single commodity's deviation (\ie $\Set{H_{p\to q}(h,\shiftN,\Delta) \in S} \not\subseteq M_i(h)$).

Now, any constraint set $S$ together with a family of deviation correspondences $A_p$ gives rise to the following informal equilibrium concept: A walk inflow $h$ is an equilibrium with respect to $S$ and $A_p$, if it is feasible and no particle can improve by an \addmEpsDev. 
To make this mathematically precise, 
we introduce the concept of \emph{\addmDev s} to some fixed walk $p$ of commodity $i$ with respect to some $h \in S$ at any fixed time $t \geq 0$ by defining the set
\begin{align}\label{eq:feasible-deviation} 
	\!U_{p}(h, t) 
	\coloneqq \Set{\!
		(q,\Delta)\in \Pc_i \times \IR |\!\! \begin{array}{l}
			\forall \delta > 0, \varepsilon > 0: \exists \shiftN \in L^2_+(\planningInterval): \int_{\tStart}^{\tEnd}\shiftN(\zeta)\diff\zeta > 0, \\ \shiftN \leq \varepsilon, \supp(\shiftN) \subseteq [t-\delta,t+\delta], \text{ and } (q,\shiftN,\Delta) \in A_p(h)
		\end{array}\!\!\!
	}.
\end{align}
In words: A walk $q$ and a shift $\Delta$ form an admissible alternative to $p$ at time $t$, if we can shift arbitrarily small amounts of flow in space from $p$ to $q$ and in time from small neighbourhoods of $t$  to small neighbourhoods of $t+\Delta$. 
This concept can be interpreted as a dynamic extension of the methodology of Bernstein and Smith~\cite{BernsteinS94}.

Note that, if there is no inflow into a walk $p$ in some neighbourhood of $t$, then $U_{p}(h,t)$ will always be empty (regardless of the state of the alternative walks). If we assume that the trivial deviation  (\ie shifting flow from~$p$ to~$p$ at any rate but without time shift) is always admissible then the converse also holds, \ie we have: $U_{p}(h,t)$ is non-empty if and only if there is inflow into $p$ near $t$. 

From now on, we will often assume that the \effWalkDelay{} for any given walk inflow $h$ is continuous.

\begin{enumerate}[label=(A\arabic*),resume=Assumptions]
	\item For any $h \in S$ and $p \in \Pc$, the function $\Psi_{p}(h,.): [t_0,t_f] \to \IR$ is continuous.\label[asmpt]{ass:EffectivePathDelayContinuous}
\end{enumerate}

We can then formally define the concept of a side-constrained dynamic equilibrium in our model as follows:
\begin{framed}
\begin{definition}\label{def:DCE}
	Given a graph $G$, a set of commodities $I$, a set of feasible walks $\Pc$, an \effWalkDelay{} operator $\Psi$, a constraint set $S$ and for every walk $p \in \Pc$ a correspondence $A_p$. Then, a feasible flow $h^*\in S$ is a \emph{\SCDE[full] (\SCDE)} \wrt $S$ and $A_p$, if for all $p \in \Pc$ and all $t \in [t_0,t_f]$ the following condition holds:
	\begin{equation}\label{eq:CDE} 
		\Psi_p(h^*,t) \leq  \Psi_q(h^*,t+\Delta) \text{ for all } (q,\Delta) \in U_{p}(h^*, t).
	\end{equation}
\end{definition}
\end{framed}

Note that the above model encompasses both (side-constrained) dynamic equilibria with and without departure time choice. In particular, to disable departure time choice we just choose some $S \subseteq \Lambda(r)$ and define $A_p$ such that it only contains deviations of the form~$(q,\shiftN,0)$.

\subsection{Basic Properties of \texorpdfstring{\SCDE}{SCDE}}

We observe that an alternative (negative) definition of side-constrained dynamic equilibria is as follows: A flow is \emph{not} an equilibrium if there exist two walk-time pairs $(p,t)$ and $(q,t')$ such that the cost of walk $q$ at time $t'$ is strictly lower than that of walk $p$ at time $t$ and we can shift flow in arbitrarily small neighbourhoods of $t$ from $p$ to neighbourhoods of $t'$ on $q$. This is formalized in the following \namecref{lemma:NegativeCharacterization}:
\begin{lemma}\label{lemma:NegativeCharacterization}
	A flow $h \in S$ is \emph{not} an \SCDE{} if and only if there exists a commodity $i \in I$, walks $p,q \in \Pc_i$, times $t,t' \in \planningInterval$, a sequence of functions $\shiftN_n \in L^2_+(\planningInterval)$ such that
	\begin{enumerate}[label=\alph*)]
		\item $\lim_n \esssup \shiftN_n = 0$,
		\item $\lim_n \sup\set{\theta \in \planningInterval | \supp(\shiftN_n) \cap [\tStart,\theta] \text{ has measure zero}} \geq t$ and\\ $\lim_n \inf\set{\theta \in \planningInterval | \supp(\shiftN_n) \cap [\theta,\tEnd] \text{ has measure zero}} \leq t$, 
		\item $\Psi_p(h,t) > \Psi_q(h,t')$ and
		\item $\int_{\tStart}^{\tEnd} \shiftN_n(\theta) \diff\theta > 0$ and $(q,\shiftN_n,\Delta) \in A_p(h)$ for all $n \in \IN$.
	\end{enumerate}
\end{lemma}

\begin{proof}
	If the \namecref{lemma:NegativeCharacterization}'s conditions are satisfied then a), b) and d) together show that we have $(q,t'-t) \in U_{p}(h,t)$. Then, c) implies that $h$ is not an \SCDE.
	
	If, on the other hand, we know that $h$ is not a \SCDE[full], then there must be some $t \in [t_0,t_f]$, $i \in I$, $p,q \in \Pc_i$ and $\Delta \in \IR$ such that both $\Psi_p(h,t) > \Psi_q(h,t+\Delta)$ and $(q,\Delta) \in U_{p}(h,t)$ hold. The latter then implies the existence of $\shiftN_n \in L_+^2(\planningInterval)$ satisfying a), b) and d) while the former is exactly c) with $t'\coloneqq t + \Delta$.
\end{proof}

The next \namecref{lemma:ConditiononApForStrongerEquilibria} provides a condition for two sets of \addmEpsDev s under which one of the corresponding \SCDE{} is stronger than the other. Two direct consequences of this \namecref{lemma:ConditiononApForStrongerEquilibria} are:
\begin{enumerate}[label=\alph*)]
	\item Smaller sets of \addmEpsDev s lead to weaker forms of \SCDE{} (we will make extensive use of this in \Cref{prop:RelationshipsOfCDE}).
	\item In many cases, one can restrict the set of \addmEpsDev s to some (simpler) subset without changing the resulting equilibria. For example, by only allowing functions of the form $\shiftN=\varepsilon\CharF[J]$ where $\CharF[J]$ denotes the characteristic function of a measurable subset $J \subseteq \planningInterval$ (as it has been done previously in \cite[Definition~4]{GHP22}). 
\end{enumerate}

\begin{lemma}\label{lemma:ConditiononApForStrongerEquilibria}
	Let $S$ be a \setS{} and $A_p$ and $A'_p$ two correspondences defining \addmEpsDev s. Furthermore, let $h^* \in S$ be a feasible flow such that the sets of \addmEpsDev s satisfy the following condition for every walk $p \in \Pc$:
	\[\forall (q,\shiftN,\Delta) \in A_p(h^*), \shiftN \neq 0: \exists (q,\shiftN',\Delta) \in \A'_p(h^*): \shiftN' \neq 0, \shiftN' \leq \shiftN.\]
	If this $h^*$ is an \SCDE{} \wrt $S$ and $A'_p$, then it is also an \SCDE{} \wrt $S$ and $A_p$.
\end{lemma}

\begin{proof}
	We prove this \namecref{lemma:ConditiononApForStrongerEquilibria} by showing that the given condition implies $U'_p(h^*,t) \supseteq U_p(h^*,t)$ for all $t \in [t_0,t_f]$ (where $U'_p$ denotes the \addmDev s defined by $A'_p$):
	
	Take any \addmDev{} $(q,\Delta) \in U_p(h^*,t)$. Then, for any $\delta, \varepsilon > 0$ there must exist some $(q,\shiftN,\Delta) \in A_p(h^*)$ with $\shiftN \leq \varepsilon$, $\int_{\tStart}^{\tEnd}\shiftN(t')\diff t' > 0$ and $\supp(\shiftN) \subseteq [t-\delta,t+\delta]$. The \namecref{lemma:ConditiononApForStrongerEquilibria}'s assumption now guarantees the existence of some $(q,\shiftN',\Delta) \in A'_p(h^*)$ with $\int_{\tStart}^{\tEnd}\shiftN'(t')\diff t' > 0$, $\shiftN' \leq \gamma \leq \varepsilon$ and $\supp(\shiftN') \subseteq \supp(\shiftN) \subseteq [t-\delta,t+\delta]$. As this holds for any $\delta,\varepsilon > 0$, this shows that we have $(q,\Delta) \in U'_p(h^*,t)$.
	
	Hence, being an \SCDE{} \wrt $A'_p$ is a stronger condition than being an \SCDE{} \wrt $A_p$, which proves the \namecref{lemma:ConditiononApForStrongerEquilibria}.
\end{proof}

Finally, the following two lemmas show that in many cases, we can \wlofg restrict ourselves to smaller sets of feasible walks $\Pc_i$ (\eg in order to make them finite and satisfy \ref{ass:FinitelyManyWalks}) or assume that the effective walk-delay operators $\Psi_p$ are bounded (\ie satisfy \ref{ass:PsiBounded}). For the first lemma we make use of the concept of dominating walks as introduced in \cite{GHP22}.

\begin{definition}
	We call a subset $\Pc' \subseteq \Pc$ a \emph{dominating walk set}, if for every walk $p \in \Pc$, $h \in S$, $t \in [t_0,t_f]$ and $(q,\Delta) \in U_p(h,t)$, there exists some $(q',\Delta') \in U_p(h,t)$ such that $q' \in \Pc'$ and $\Psi_{q'}(h,t+\Delta') \leq \Psi_q(h,t+\Delta)$.
\end{definition}

\begin{lemma}\label{lemma:RestrictToDominatingWalkSet}
	Let $\Pc' \subseteq \Pc$ a dominating walk-set and define 
		\[A'_p(h,t) \coloneqq \set{(q,\shiftN,\Delta) \in A_p(h,t) | q \in \Pc'}.\]
	Then, any $h^* \in S' \coloneqq \Set{h \in S | h_p \equiv 0 \text{ for all } p \in \Pc\setminus\Pc'}$ is an \SCDE{} \wrt $S'$ and $A'_p$ if and only if it is an \SCDE{} \wrt $S$ and $A_p$.
\end{lemma}

\begin{proof}
	The `if'-part follows directly from \Cref{lemma:ConditiononApForStrongerEquilibria}. For the `only if'-part, take any walk $p \in \Pc_i$, time $t \in \planningInterval$ and \addmDev{} $(q,\Delta) \in U_p(h^*,t)$. Since $\Pc'$ is a dominating walk set, there must be some $(q',\Delta') \in U_p(h^*,t)$ with $\Psi_{q'}(h^*,t+\Delta') \leq \Psi_q(h^*,t+\Delta)$ and $q' \in \Pc'$. Since $h^*$ is an \SCDE{} \wrt $A'_p$, this gives us
		\[\Psi_p(h^*,t) \leq \Psi_{q'}(h^*,t+\Delta') \leq \Psi_q(h^*,t+\Delta).\] 
	Thus, $h^*$ is an \SCDE{} \wrt $A_p$ as well.
\end{proof}

\begin{definition}\label{def:truncatedPsi}
	For any $M \in \IR,$ we define the \emph{truncated effective walk delay operator} $\truncated{\Psi}{M}$ of $\Psi$ by setting
		\[\truncated{\Psi}{M}_p(h,t) \coloneqq \min\set{\Psi_p(h,t), M} \text{ for all } p \in \Pc, h \in \Lambda(Q), t \in \planningInterval.\]
\end{definition}

\begin{lemma}\label{lemma:RestrictToTruncatedPsi}
	Given $M \in \IR$ such that for all $h \in S$, $t \in \planningInterval$ and $p \in \Pc$ with $U_p(h,t) \neq \emptyset$ there exists some $(q,\Delta) \in U_p(h,t)$ such that $\Psi_q(h,t+\Delta) < M$,
	then any walk inflow $h^*$ is an \SCDE{} with respect to $\Psi$ if and only if it is an \SCDE{} with respect to $\truncated{\Psi}{M}$.
\end{lemma}

\begin{proof}
	First, let $h^*$ be an \SCDE{} with respect to $\Psi$. Then, for any $p \in \Pc$, $i \in I$ and $(q,\Delta) \in U_p(h^*,t)$, we have
		\[\truncated{\Psi}{M}_p(h^*,t) = \min\set{\Psi_p(h^*,t),M} \leq \min\set{\Psi_q(h^*,t+\Delta),M} = \truncated{\Psi}{M}_p(h^*,t+\Delta).\]
	Therefore, $h^*$ is also an \SCDE{} with respect to $\truncated{\Psi}{M}$.
	
	Now, let $h^*$ be an \SCDE{} with respect to $\truncated{\Psi}{M}$. Again, take any $p \in \Pc$, $i \in I$ and $(q,\Delta) \in U_p(h^*,t)$. Then, by the \namecref{lemma:RestrictToTruncatedPsi}'s assumption, we have some $(q',\Delta') \in U_p(h^*,t)$ such that $\Psi_{q'}(h^*,t+\Delta') < M$ implying
		\[\truncated{\Psi}{M}_p(h^*,t) \leq \truncated{\Psi}{M}_{q'}(h^*,t+\Delta') = \Psi_{q'}(h^*,t+\Delta') < M\]
	and, therefore, $\truncated{\Psi}{M}_p(h^*,t) = \Psi_p(h^*,t)$. This, in turn, implies
		\[\Psi_p(h^*,t) = \truncated{\Psi}{M}_p(h^*,t) \leq \truncated{\Psi}{M}_q(h^*,t+\Delta) \leq \Psi_q(h^*,t+\Delta).\]
	Thus, $h^*$ is an \SCDE{} with respect to $\Psi$.		
\end{proof}

\subsection{Some Special Cases of \texorpdfstring{\SCDE}{SCDE}}\label{sec:SCDESpecialCases}

We first observe that the standard \emph{un}constrained dynamic equilibrium concepts are special cases of our model:

\begin{lemma}
	Assume that \ref{ass:EffectivePathDelayContinuous} holds. We define $S \coloneqq \Lambda(Q)$ and 
		\[A_p(h) \coloneqq \Set{(q,\shiftN,\Delta) | \begin{array}{l}
				q \in \Pc_i, \shiftN \in L_+^2(\planningInterval), \shiftN \leq h_p, \supp(\shiftN(\emptyarg-\Delta)) \subseteq \planningInterval \text{ and }\\
				h_q(t) + \shiftN(t-\Delta) \leq B_q \text{ for almost all } t \in \planningInterval
			\end{array}}\]
	for all $h \in S$, $p \in \Pc_i$ and $i \in I$. Then, any flow $h^* \in S$ is a \SCDE[full] in the sense of \eqref{eq:CDE} if and only if it is a dynamic equilibrium with fixed flow volumes and departure time choice in the sense of \eqref{eq:de-volume}.
\end{lemma}

\begin{proof}
	First, let $h^*$ be an equilibrium in the sense of \eqref{eq:de-volume} with corresponding values $\nu_i$. Now, take any time $t \in [t_0,t_f]$, shift $\Delta$ and walks $p,q \in \Pc_i$ such that $\Psi_p(h^*,t) > \Psi_q(h^*,t+\Delta)$. We then have to show that $(q,\Delta)$ is not an \addmDev, \ie that $(q,\Delta) \notin U_p(h^*,t)$. For this, we distinguish two cases: If we have $\Psi_q(h^*,t+\Delta) < \nu_i$, then \ref{ass:EffectivePathDelayContinuous} guarantees the existence of some neighbourhood $[t-\delta,t+\delta]$ of $t$ such that $\Psi_q(h^*,t'+\Delta) < \nu_i$ holds for all $t' \in [t-\delta,t+\delta]$. From \eqref{eq:de-volume} we then get that $h^*_q(t'+\Delta) \geq B_q$ for almost all these $t' \in [t-\delta,t+\delta]$ which, in turn, implies $(q,\Delta) \notin U_p(h^*,t)$. If, on the other hand, we have $\Psi_q(h^*,t+\Delta) \geq \nu_i$, then we have $\Psi_p(h^*,t) > \nu_i$ by our initial assumption. \Cref{ass:EffectivePathDelayContinuous} then again guarantees the existence of some $\delta > 0$ with $\Psi_p(h^*,t') > \nu_i$ for all $t' \in [t-\delta,t+\delta]$. From this \eqref{eq:de-volume} allows us to deduce $h^*_p(t')=0$ for almost all those $t'$ and, hence, $U_p(h^*,t) = \emptyset$. 
	
	Now, let $h^*$ be an equilibrium in the sense of \eqref{eq:CDE} and assume for contradiction that it is not an equilibrium in the sense of \eqref{eq:de-volume}. Then, there must exist some commodity $i \in I$ such that there exists no $\nu_i \in \IR$ satisfying \eqref{eq:de-volume}. In particular, we must have $Q_i > 0$, and therefore 
		\[\nu_i \coloneqq \esssup\set{\Psi_p(h^*,t) | p \in \Pc_i, t \in [t_0,t_f], h^*_p(t) > 0} > -\infty\]
	where $\esssup$ denotes the essential supremum, \ie 
		\[\esssup\Set{g(x) | x \in X} \coloneqq \inf\Set{b \in \IR | \abs{\set{x \in X | g(x) > b}} = 0}\]
	for any measurable function $g: X \to \IR$ where $\abs{.}$ denotes the measure on $X$. Since this $\nu_i$ cannot satisfy \eqref{eq:de-volume}, there must be a walk $q \in \Pc_i$, some $\varepsilon, \varepsilon' > 0$ and a set $J_q \subseteq [t_0,t_f]$ of positive measure such that we have 
		\[h^*_q(t) \leq B_q - \varepsilon \text{ and } \Psi_q(h^*,t) \leq \nu_i - \varepsilon' \text{ for all } t \in J_q.\]
	At the same time, the definition of $\nu_i$ guarantees the existence of some walk $p \in \Pc_i$ and set $J_p \subseteq [t_0,t_f]$ of positive measure such that
		\[h^*_p(t) > 0 \text{ and } \Psi_p(h^*,t) > \nu_i - \varepsilon' \text{ for all } t \in J_p.\]
	Now, there must exist some $\Delta \in \IR$ such that $(J_p + \Delta) \cap J_q$ has positive measure. Defining $J \coloneqq J_p \cap (J_q-\Delta)$ gives us a set containing at least one $t \in J$ such that for all $n \in \IN$ the set $J_n \coloneqq [t-\frac{1}{n},t+\frac{1}{n}] \cap J$ has positive measure. Defining 
		\[\shiftN_n \coloneqq \min\Set{\tfrac{\varepsilon}{n}\cdot\CharF[J_n],h_p}: \planningInterval \to \IR, t' \mapsto \begin{cases}\min\set{\tfrac{\varepsilon}{n},h_p(t')}, &\text{if } t' \in J_n\\0,&\text{else}\end{cases}\]
	for all $n \in \IN$ then gives us a sequence of $L^2$-functions satisfying
	\begin{itemize}
		\item $\lim_n \esssup \shiftN_n = \lim_n \tfrac{\varepsilon}{n} = 0$,
		\item $\lim_n \sup\set{\theta \in \planningInterval | \supp(\shiftN_n) \cap \planningInterval \text{ has measure zero}}$\\\null$\quad= \lim_n \sup\set{\theta \in \planningInterval | J_n \cap \planningInterval \text{ has measure zero}} \geq \lim_n (t-\tfrac{1}{n}) = t$ and, analogously, $\lim_n \inf\set{\theta \in \planningInterval | \supp(\shiftN_n) \cap [\theta,\tEnd] \text{ has measure zero}} \leq t$,
		\item $\Psi_p(h^*,t) > \nu_i - \varepsilon' \geq \Psi_q(h^*,t+\Delta)$ since $t \in J \subseteq J_p$ and $t + \Delta \in J + \Delta \subseteq J_q$,
		\item $\int_{J_n}\shiftN(t')\diff t' > 0$ for all $n \in \IN$ as $J_n \subseteq J_p$ has positive measure and
		\item $(q,\shiftN_n,\Delta) \in A_{p}(h^*)$ for all $n \in \IN$ since $\shiftN_n \leq h_p$, $\supp(\shiftN_n(\emptyarg-\Delta))= J_n+\Delta \subseteq J_q \subseteq \planningInterval$ and $h^*_q (t') + \shiftN_n(t'-\Delta) \leq h^*_q (t') + \varepsilon \leq B_q$ for all $t' \in J_n + \Delta \subseteq J_q$.
	\end{itemize}
	By \Cref{lemma:NegativeCharacterization} this implies that $h^*$ is not a \SCDE[full] -- a contradiction to our initial assumption.
\end{proof}

\begin{lemma}
	Assume that \ref{ass:EffectivePathDelayContinuous} holds. We choose $S \coloneqq \Lambda(r)$ and 
		\[A_p(h) \coloneqq \set{(q,\shiftN,0) | q \in \Pc_i, \shiftN \in L_+^2(\planningInterval), \shiftN \leq h_p}\]
	for all $h \in S$, $p \in \Pc_i$ and $i \in I$. Then, any flow $h^* \in S$ is a \SCDE[full] in the sense of \eqref{eq:CDE} if and only if it is a dynamic equilibrium with fixed inflow rate in the sense of \eqref{eq:de-rate}.
\end{lemma}

\begin{proof}
	First, let $h^*$ be an equilibrium in the sense of \eqref{eq:de-rate}. Then, for any point $t \in [t_0,t_f]$ and walks $p,q \in \Pc_i$ with $\Psi_p(h^*,t) > \Psi_q(h^*,t)$ \cref{ass:EffectivePathDelayContinuous} guarantees the existence of some neighbourhood $[t-\delta,t+\delta]$ of $t$ with $\Psi_p(h^*,t') > \Psi_q(h^*,t')$ for all $t' \in [t-\delta,t+\delta]$. \Cref{eq:de-rate} then implies that $h^*_p(t') = 0$ for almost all $t'$ from this interval and, thus, $U_{p}(h^*,t) = \emptyset$. In particular, we have $q \notin U_{p}(h^*,t)$ which shows that \eqref{eq:CDE} is satisfied by $h^*$.
	
	Now, let $h^*$ be an equilibrium in the sense of \eqref{eq:CDE}. Then, for every time $t \in [t_0,t_f]$ and each pair of walks $p,q$ with $\Psi_p(h^*,t) > \Psi_q(h^*,t)$, we have $q \notin U_{p}(h^*,t)$. As we are in the unconstrained case, this can only be because there exists some $\delta_t > 0$ such we have $h^*_p(t') = 0$ for almost all $t' \in [t-\delta_t,t+\delta_t]$. Since this is true for all such times $t$, we clearly have
		\[\set{t \in [t_0,t_f] | \Psi_p(h^*,t) > \Psi_q(h^*,t)} \subseteq \bigcup_{t \in [t_0,t_f]:\Psi_p(h^*,t) > \Psi_q(h^*,t)}[t-\delta_t,t+\delta_t].\]
	But then, there also exists a countable such covering, \ie a countable set 
		\[K \subseteq \set{t \in [t_0,t_f] | \Psi_p(h^*,t) > \Psi_q(h^*,t)}\]
	such that 
		\[\set{t \in [t_0,t_f] | \Psi_p(h^*,t) > \Psi_q(h^*,t)} \subseteq \bigcup_{t \in K}[t-\delta_t,t+\delta_t].\]
	Therefore, for almost all $t \in \set{t \in [t_0,t_f] | \Psi_p(h^*,t) > \Psi_q(h^*,t)}$ we have $h^*_p(t') = 0$ which shows that $h^*$ satisfies \eqref{eq:de-rate}.
\end{proof}

We conclude this \namecref{sec:SCDESpecialCases} by introducing a first type of \SCDE{} with actual side-constraints: In general, our framework requires us to specify two objects for such a definition: The \setS~$S$ and the \addmEpsDev s~$A_p$. We will make use of this flexibility later on (in particular in \Cref{sec:SCviaNL}) but we can also just take any \setS{} $S \subseteq \Lambda(Q)$ and then derive \addmEpsDev s from it as follows: We say that a potential \epsDev{} is admissible if and only if it leads to another feasible flow, \ie 
	\begin{align}\label{eq:ApglobalSCDE}
		A_{p}(h) \coloneqq \set{(q,\shiftN,\Delta) | H_{p \to q}(h,\shiftN,\Delta) \in S}
	\end{align}
or, equivalently,
	\[M_i(h) \coloneqq \set{h' \in L^2 (\planningInterval)^{\Pc} | \exists p, q, i, \shiftN,\Delta: h' = H_{p \to q}(h,\shiftN,\Delta) \in S}.\]
This imposes a global feasibility constraint on the possible deviations: That is, particles are only allowed to deviate if the resulting alternative flow is feasible again for \emph{all} particles (not just the ones deviating). This is a generalization of the capacitated dynamic equilibria defined in \cite{GHP22}. Here, we will call these types of side-constrained dynamic equilibria \emph{\globalSCDE[fulls]{}}.

\begin{definition}\label{def:strongCDE}
	A \emph{\globalSCDE[full] (\globalSCDE)} with respect to some set $S \subseteq \Lambda(Q)$ is a side-constrained dynamic equilibrium \wrt $S$ and \addmEpsDev s $A_{p}(h)$ defined by \eqref{eq:ApglobalSCDE}.
\end{definition}