% !TeX spellcheck = en_GB
%!TEX root = ../side-constrained.tex

\subsection{Existence Results}

As shown in \Cref{sec:counter}, feasibility sets defined by capacity constraints need not be convex. Thus, it is not clear whether \eqref{eq:VI-SCDE} has a solution (at least, we cannot apply \Cref{thm:Lions}). Furthermore, in general, it is not guaranteed that small enough \addmEpsDev s from a feasible flow lead to another feasible flow (i.e. \cref{ass:addmDevLeadToFeasFlow}) and, therefore, even if we had a solution to the variational inequality, this would not be guaranteed to also be a \SCDE. See \Cref{ex:DifferenceBetweenLocalAndGlobalFeas} for such an instance.

To still be able to show existence of \sCDEuP{} and \wCDEuP{} (under certain additional assumptions), we will therefore employ a different approach using an augmented Lagrangian relaxation of the hard capacity constraints. Before we come to the existence theorem for \sCDEuP, we introduce the additional assumptions we need there:

\begin{defn}
	We say that $h$ and $f(h)$ satisfy the \emph{principle of causation}, if the following condition is satisfied:
	
	For any edge $e\in E$ and interval $[a,b] \subseteq \IR_{\geq 0}$ with $0 \leq f_e(h,a) < f_e(h,b)$ there exists some walk $p \in  \Pc$ and subset $J^{-1}\subseteq[t_0,t_f]$ of positive measure such that
		\[e = (v_jv_{j+1}) \in p, h_p(t')>0 \text{ f.a. } t'\in J^{-1} \text{ and } \tau_p^j(h,t')\in [a,b] \text{ f.a. } t'\in J^{-1}.\]
\end{defn}

The principle of causation states, that if the edge load increases during some interval, then there must exist earlier times at which strictly positive flow is injected into some walk containing $e$ contributing to this increased edge load.

\begin{enumerate}[label=(A\arabic*),resume=Assumptions]
	\item For any edge $e$ and walk inflow $h$, the function $f_e(h,.)$ is continuous.\label[asmpt]{ass:fContinuous}
	\item For any edge $e$ and any weakly convergent sequence $h^n$, the sequence $f_e(h^n,.)$ converges uniformly. \label[asmpt]{ass:fConvergesUniform}
	\item For any $h \in \Lambda(Q)$, we have that $h$ and $f(h)$ satisfy the principle of causation. \label[asmpt]{ass:StrongPrincipleOfCausation}
	\item For any edge $e$ and walk inflow $h$, we have $f_e(h,0) \leq c_e(0)$.\label[asmpt]{ass:FeasibleAtStart}
	\item For every $h\in \Lambda(Q)$ and $i\in I$, there exists some $p\in \Pc_i$ and $J \subseteq [t_0,t_f]$ of positive measure such that for all $t \in J$, we have $h_p(t) < B_p$ and $f_e(h, \tau^j_p(h,t))\leq c_e(\tau^j_p(h,t))$ for all $e = (v_j,v_{j+1})\in p$.\label[asmpt]{ass:ExistenceOfUnsaturatedPath} 
	\item For any edge $e$, the capacity function $c_e$ non-negative.\label[asmpt]{ass:CapacityNN} 
	%\item For any edge $e$ the capacity function $c_e$ is constant.\label[asmpt]{ass:CapacityConstant}\lukas{I think ``non-decreasing'' should suffice here}
	\item For any edge $e$, the capacity function $c_e$ is non-decreasing.\label[asmpt]{ass:CapacityNonDecreasing}
	\item For any walk $p$ and $j \in \set{1, \dots, \abs{p}+1}$ and any weakly convergent sequence $h^n$, the sequence $\tau_p^j(h^n,.)$ converges uniformly. \label[asmpt]{ass:tauConvergesUniform}
	\item For any two walks $p$ and $q$ that share a common prefix $w$, we have $\tau^j_p(h,t) = \tau^j_q(h,t)$ for all $e=(v_j,v_{j+1}) \in w$, $h \in S$ and $t \in \planningInterval$.\label[asmpt]{ass:tEqualOnCommonPrefix}
	\item The mapping $\Lambda(Q) \to C(\planningInterval)^\Pc, h \mapsto \Psi(h,.)$ is sequentially weak-strong continuous, i.e. for any walk $p \in \Pc$ and any weakly convergent sequence $h^n$, the sequence $\Psi_p(h^n,.)$ converges uniformly.\label[asmpt]{ass:PsiConvergesUniform}
	\item There exists some $M \in \IR$ such that for all $h \in S$, $p \in \Pc$ and almost all $t \in \planningInterval$, we have $\Psi_p(h,t) \leq M$.\label[asmpt]{ass:PsiBoundedFlowIndependent}
\end{enumerate}

Assumption~\ref{ass:ExistenceOfUnsaturatedPath} essentially states that there is always an outside option, i.e. the edge capacities are chosen large enough such that there is always at least one walk which is not oversaturated. Note, that this can be easily accomplished by either having one walk with large enough capacities or by using elastic demands. \Cref{ex:DifferenceBetweenLocalAndGlobalFeas} shows why this assumption is necessary for the existence of \sCDEu. Assumption~\ref{ass:PsiConvergesUniform} is a strengthening of assumption~\ref{ass:PsiWScont} as convergence with respect to the uniform norm implies convergence with respect to the $L^2$-norm. Finally, assumption~\ref{ass:tEqualOnCommonPrefix} requires that intermediate travel times only depend on the part of the walk already traversed and not on future route choices.

\begin{theorem}\label{thm:ExistenceFDAddSpaceExCP}
	Under \cref{ass:PsiBoundedFlowIndependent,ass:FinitelyManyWalks,ass:PathInflowBounds,ass:PsiConvergesUniform,ass:EffectivePathDelayContinuous,ass:StrongPrincipleOfCausation,ass:fContinuous,ass:fConvergesUniform,ass:CapacityNonDecreasing,ass:CapacityNN,ass:ExistenceOfUnsaturatedPath,ass:tauConvergesUniform,ass:tEqualOnCommonPrefix,ass:FeasibleAtStart} there always exist \sCDEu{} and \sCDEuP.
\end{theorem}

\begin{proof}
	As every \sCDEuP{} is also a \sCDEu{} (see \Cref{prop:RelationshipsOfCDE}), it suffices to show the existence of the former. 
	We start by defining penalty functions $\xi_e(h,t):=\max\{0,f_e(h,t)-c_e(t)\},e\in E,t\in \IR_{\geq 0}$ and write $\xi_p(h,t):=\sum_{e = (v_j,v_{j+1})\in p} \xi_e(h,\tau^j_p(h,t))$.
	By \cref{ass:PsiConvergesUniform,ass:fConvergesUniform}, the new $\lambda$-parametrized \effWalkDelay{} operator
		\[ \Psi_p^{\lambda}(h,t) \coloneqq \Psi_p(h,t)+\lambda \xi_p(h,t)\text{ for all }t\in [t_0, t_f], p\in  \Pc,\]
	satisfies \ref{ass:PsiWScont} for any $\lambda>0$ as well.
	
	\begin{claim}\label{claim:BoundOnEssInf}
		There is  some $M\in \R_+$ with    
			\[\min_{w\in \Pc}\essinf\set{\Psi^{\lambda}_w(h,t) | t \in \planningInterval: h_w(t) < B_w} \leq M\]
		for all $\lambda \geq 0$ and $h \in \Lambda(Q)$.
	\end{claim}
	
	\begin{proofClaim}
		By assumption~\ref{ass:ExistenceOfUnsaturatedPath}, for every $h$ there exist $p\in \Pc_i$ and $J \subseteq \planningInterval$ with positive measure such that $h_p(t) < B_p$ and $f_e(h,\tau^j_p(h,t)) \leq c_e(\tau^j_p(h,t))$ 
		and, hence, $\xi_e(h,\tau^j_p(h,t)) = 0$ for all $e = (v_j,v_{j+1}) \in p$ and $t \in J$. Thus, using \ref{ass:PsiBoundedFlowIndependent}, we have $\Psi^{\lambda}_p(h,t) = \Psi_p(h,t) + 0 \leq M$ for all $t \in J$. Since $J$ has positive measure, this implies the claim.
	\end{proofClaim} 
	
	Using this claim we can now apply \Cref{lemma:RestrictToTruncatedPsi} to replace $\Psi^{\lambda}$ by the truncated effective walk delay operator $\truncated{\Psi^\lambda}{M+1}$ which is, in particular, bounded (i.e. satisfies \ref{ass:PsiBounded}) but yields the same dynamic equilibria as $\Psi^\lambda$. As $\truncated{\Psi^\lambda}{M+1}$ clearly still satisfies \ref{ass:PsiWScont} while \ref{ass:FinitelyManyWalks} and \ref{ass:PathInflowBounds} are part of the theorem's assumption, we can apply \Cref{thm:ExistenceUnconstrained} to obtain for any $\lambda \geq 0$ an unconstrained dynamic equilibrium with respect to $\Psi^\lambda$.
	
	Let us now take a sequence of strictly positive numbers $(\lambda_n)_{n\in \IN}$ with $\lambda_n\rightarrow\infty$ and a corresponding sequence $h^n\in \Lambda(Q)$ of unconstrained dynamic equilibria with respect to $\Psi^{\lambda_n}$.
	By taking subsequences, $h^n$ weakly converges to some $h^*\in \Lambda(Q)$ as $\Lambda(Q)$ is bounded and closed (cf. \cite[Satz 6.10]{AltFunkAna}). We will now show that this $h^*$ is a \sCDEuP{} by first showing that it is feasible and then that it also satisfies the \SCDE-condition~\eqref{eq:CDE} for \addmEpsDev s defined by \eqref{eq:FeasibleDeviationsAdditionalSpaceExceptCommonPrefixEnter}.
	
	\begin{claim}\label{claim:hStarInSr}
		$h^*\in S$.
	\end{claim}

	\begin{proofClaim}
		Suppose that $h^* \notin S$, i.e. there exists some $e\in E$ and some time $\theta \in \IR_{\geq 0}$ with $\xi_e(h^*,\theta)>0$. 	Now, by assumption~\ref{ass:fConvergesUniform}, $f(h^n)$ converges uniformly to $f(h^*)$ and, in particular, there exists some $\delta > 0$ such that for large enough $n \in \IN$ we have 
			\[f_e(h^n,\theta) - c_e(t) = \xi_e(h^n,\theta) \geq \delta.\]
		
		Using \cref{ass:FeasibleAtStart,ass:fContinuous,ass:CapacityNN,ass:CapacityNonDecreasing}, there must be some proper interval $[\theta',\theta]$ such that $f_e(h^n,\theta') < f_e(h^n,\theta)$ and $f_e(h^n,\vartheta) - c_e(\vartheta) \geq \frac{\delta}{2}$ for all $\vartheta \in [\theta',\theta]$. By~\ref{ass:StrongPrincipleOfCausation} this gives us some $p_n \in \Pc$ with $e = (v_{j_n},v_{j_n+1}) \in p_n$ and some set $J^{-1}_{n} \subseteq [t_0,t_f]$ of positive measure, such that for all $t' \in J^{-1}_{n}$ we have
			\[h^n_{p_n}(t')>0 \text{ and } \tau^{j_n}_{p_n}(t',h^n) \in [\theta',\theta]\]
		and, thus, 
			\[\Psi^{\lambda_n}_{p_n}(h^n,t') \geq \lambda_n\xi_e(\tau^{j_n}_{p_n}(t',h^n),h^n) \geq \lambda_n\tfrac{\delta}{2}.\]
		Since $\lambda_n \to \infty$, there exists some $n \in \IN$ with $\lambda_n\frac{\delta}{2} > M$ and, therefore, for this $n$ we have a set $J^{-1}_{n}$ of positive measure such that for all $t' \in J^{-1}_{n}$ we have $h^n_{p_n}(t') > 0$ as well as, using \Cref{claim:BoundOnEssInf}, $\Psi^{\lambda_n}_{p_n}(h^n,t) > M \geq \min_{p_n\in \Pc_i}\essinf\set{\Psi^{\lambda^n}_{p_n}(h^n,t) | t \in \planningInterval}  = \nu_i$. But this is now a contradiction to $h^n$ being an unconstrained dynamic equilibrium.
	\end{proofClaim}

	\begin{claim}\label{claim:ExistenceFDAddSpaceExCPisEq}
		$h^*$ is a \SCDE{} wrt. the \addmEpsDev s defined in \eqref{eq:FeasibleDeviationsAdditionalSpaceExceptCommonPrefixEnter}.
	\end{claim}

	\begin{proofClaim}
		Suppose that $h^*\in S$ is not an equilibrium, that is, there
		is some $i\in I,p,q\in \Pc_i$ and $t \in [t_0,t_f]$ with $(q,\Delta)\in U_{p}(h, t)$ and $\Psi_p(h^*,t)>\Psi_q(h^*,t+\Delta)$. We distinguish two cases: If $\Delta = 0$, we define $w$ as the maximal common prefix of $p$ and $q$, i.e. $p = w\tilde{p}$ and $q = w\tilde{q}$ for some subwalks $\tilde{p}$ and $\tilde{q}$. If $\Delta\neq 0$, we define $w$ as the empty walk and $\tilde p \coloneqq p$ and $\tilde q \coloneqq q$.
			
		\begin{itemize}
			\item With \ref{ass:EffectivePathDelayContinuous} and \ref{ass:PsiConvergesUniform}, i.e. continuity of $\Psi_p(h^*,.)$ and uniform convergence  of $\Psi_p(h^n,.)\rightarrow \Psi_p(h^*,.)$, we get 
			the existence of some $\delta > 0$ such that 
				\[ \Psi_p(h^n,\theta)>\Psi_q(h^n,\theta+\Delta) \text{ for all } \theta\in [t-\delta,t+\delta] \text{ for $n$ large enough.}\]
			
			\item From $(q,\Delta)\in U_{p}(h^*, t)$, we get an $\varepsilon > 0$ and some subset $J \subseteq [t-\delta,t+\delta]$ with $\int_J \min\set{h^*_p(\theta),\varepsilon}\diff\theta > 0$ and $(q,J,\varepsilon,\Delta) \in A_{p}(h^*)$. By the definition of \addmEpsDev s (i.e. \eqref{eq:FeasibleDeviationsAdditionalSpaceExceptCommonPrefixEnter}) this implies 	
				\[f_e(h^*,\tau^j_{q}(h^*,\theta)) < c_e(\tau^j_{q}(h^*,\theta)) \text{ f.a. } e = (v_j,v_{j+1}) \in \tilde{q}, \theta \in J+\Delta.\]
			
			\item With \ref{ass:fConvergesUniform} and \ref{ass:tauConvergesUniform}, i.e. the uniform convergence of $f_e(h^n,.)$ to $f_e(h^*,.)$ and $\tau^j_p(h^n,.)$ to $\tau^j_p(h^*,.)$, we have the existence of some $N \in \IN$ and $J' \subseteq J$ such that $\int_{J'} \min\set{h^*_p(\theta),\varepsilon}\diff\theta > 0$ and 
		 \[f_e(h^n,\tau^j_{q}(h^n,\theta)) < c_e(\tau^j_{q}(h^n,\theta)) \text{ for all } n \geq N, e = (v_j,v_{j+1}) \in \tilde{q} \text{ and } \theta \in J'+\Delta.\]
			
			\item With weak convergence of $h^n\rightarrow h^*$ we get the existence of some $J_n\subseteq J'$ of positive measure with $h_p^n(t)>0$ for $n$ large enough.
			
			To see this, let $\CharF[J',p] \in L^2(\planningInterval)^\Pc$ be the characteristic function of the measurable set $J'$ for walk $p$ and the zero function for all other walks. Then the weak convergence of $h^n$ to $h^*$ implies
				\[\lim_n \int_{J'} h^n_{p}(t) \diff t = \lim_n \scalar{h^n}{\CharF[J',p]} = \scalar{h^*}{\CharF[J',p]} = \int_{J'} h^*_{p}(t)\diff t > 0.\]
			This implies $\int_{J'} h^n_{p}(t) \diff t > 0$ for large enough $n$ and, thus, for any such $n$ there exists a subset $J_n \subseteq J'$ of positive measure with $h^n_{p}(t) > 0$ for all $t \in J_n$. 
		\end{itemize}
	
		Taking all this together we can now show a contradiction as follows: Take $n \in \IN$ large enough that all the previous statements hold. Then, in particular, we have $f_e(h^n,\tau^j_{q}(h^n,\theta)) < c_e(\tau^j_{q}(h^n,\theta))$ and, thus, $\xi_e(h^n,\tau^j_{q}(h^n,\theta)) = 0$  for all $e = (v_j,v_{j+1}) \in \tilde{q}$ and $\theta \in J_n + \Delta$.
		
		This then implies
			\begin{align*}
				\Psi_p^{\lambda_n}(h^n,\theta) 
					&= \Psi_p(h^n,\theta) + \lambda_n \xi_p(h^n,\theta) \\
					&= \Psi_p(h^n,\theta) + \lambda_n \sum_{e=(v_j,v_{j+1}) \in w\tilde{p}}\xi_e(h^n,\tau^j_p(h^n,\theta)) \\
					&\geq \Psi_p(h^n,\theta) + \lambda_n \sum_{e=(v_j,v_{j+1}) \in w}\xi_e(h^n,\tau^j_p(h^n,\theta)) \\
					&> \Psi_q(h^n,\theta+\Delta) + \lambda_n \sum_{e=(v_j,v_{j+1}) \in w}\xi_e(h^n,\tau^j_p(h^n,\theta)) \\
					&\overset{\ref{ass:tEqualOnCommonPrefix}}{=} \Psi_q(h^n,\theta) + \lambda_n \sum_{e=(v_j,v_{j+1}) \in w}\xi_e(h^n,\tau^j_q(h^n,\theta+\Delta)) \\
					&= \Psi_q(h^n,\theta+\Delta) + \lambda_n \sum_{e=(v_j,v_{j+1}) \in w\tilde{q}}\xi_e(h^n,\tau^j_q(h^n,\theta+\Delta)) \\
					&= \Psi_q(h^n,\theta+\Delta) + \lambda_n \xi_q(h^n,\theta) = \Psi_q^{\lambda_n}(h^n,\theta+\Delta) 
			\end{align*}
		for all $\theta \in J_n$. For the third to last equality, note that $w$ is the empty walk whenever $\Delta \neq 0$.
		
		Now, at the same time, $\theta \in J_n$ also implies $h_p^n(\theta)>0$. Together with the fact that $J_n$ has positive measure, these two statements are now a contradiction to $h^n$ being an unconstrained dynamic equilibrium.
	\end{proofClaim}
	Finally, \Cref{claim:hStarInSr,claim:ExistenceFDAddSpaceExCPisEq} together imply that $h^*$ is a \sCDEuP.
\end{proof}

%\begin{remark}
%	With some additional assumptions the same proof can also be applied to a slightly stronger equilibrium concept where tightness of the capacity constraint is allowed not only on a common prefix, but on all common edges between the current walk $p$ and the alternative walk $q$ as long as they are reached at the same time via $p$ and $q$. See \Cref{app:Further EquilibriumConcepts} for more details.
%\end{remark}

Note, that the same type of proof can not be applied to show existence of \sCDEdf{}. While everything up to and including \Cref{claim:hStarInSr} still holds (since the constraint set $S$ remains unchanged), \Cref{claim:ExistenceFDAddSpaceExCPisEq} is not guaranteed to hold any more for \addmEpsDev s defined by \eqref{eq:UnsaturatedPathsFeasibleAfterDeviationEnter}. In fact there exists an instance wherein the sequence $h^n$ from the proof of \Cref{thm:ExistenceFDAddSpaceExCP} converges to some $h^*$ which is not a \sCDEdf:

\begin{figure}[h]
	\centering
	\input{tikz/CounterExampleBSDEviaPrices}
	%\includegraphics[width=.8\textwidth]{Images/CounterExamplePrices.pdf}
	\caption{An instance with volume constraints, fixed network inflow rates and the Vickrey queueing model for the edge dynamics. All values of $\tau$ not explicitly given are $1$ and all missing values of $\nu$ are infinite. In this network there exists a sequence of equilibrium flows for the instance with increasing prices (instead of strict volume constraints) which converges to a feasible flow which is a \sCDEuP{} but not a \sCDEdf.}\label{fig:CounterExamplePrices}
\end{figure}

\begin{example}\label{ex:CounterExamplePrices}
	The two-commodity network with fixed network inflow rates in \Cref{fig:CounterExamplePrices} shows why existence of \sCDEdf{} can not be shown by relaxing the constraints and replacing them with fees for violation (as done in the proof of \Cref{thm:ExistenceFDAddSpaceExCP} for \sCDEu{} and \sCDEuP). The given network uses the Vickrey point queue model for the edge dynamics and has a constant volume constraint of $4$ on the central edge. For any price $\lambda$ the following is an equilibrium: Commodity~$1$ uses the central path at a rate of $1$ during the interval $[0,5]$ and (additionally) the direct edge towards $t_1$ at a rate of $1$ during the interval $[4,5]$. Commodity~$2$ uses the central path at a rate of $1/\lambda$ during the interval $[4,5]$ and sends everything else over the direct edge towards $t_2$.
	
	Letting $\lambda$ go to $\infty$ these equilibria converge to a flow where commodity~$2$ sends everything along the direct edge while commodity~$1$ uses the same split as for every $\lambda$. This is clearly a feasible flow and also a \sCDEuP{} since the capacity constraint on edge $e$ is tight during $[5,7]$ and, thus, the central path is not an \addmDev{} during $[4,5]$. However, it is not a \sCDEdf{} as due to the edge dynamics on edge $s_1v$ sending more flow into the central path during $[4,5]$ would not actually increase the flow volume on edge $e$ and, therefore, not violate the volume constraint on this edge. Thus, the central path is an \addmDev{} for \addmEpsDev s defined by \eqref{eq:UnsaturatedPathsFeasibleAfterDeviationEnter}.
\end{example}

The following example shows why it is important for the above existence proofs that the capacity functions $c_e$ are non-decreasing (i.e. why we need \cref{ass:CapacityNonDecreasing}). 

\begin{figure}[h]
	\centering
	\input{tikz/CounterExampleDecreasingCapacity}
	%\includegraphics[width=.5\textwidth]{Images/CounterExamplePrincipleOfCausation.pdf}
	\caption{A single-commodity instance without a \sCDEu. The two edges have a fixed (flow independent) travel time of $\tau_e$. The edge $e_1$ has an edge capacity limiting the total flow volume on the edge.}\label{fig:NonExistenceForNonConstantCapacity}
\end{figure}

\begin{example}\label{ex:NonExistenceForNonConstantCapacity}
	In this network with a decreasing capacity function depicted in \Cref{fig:NonExistenceForNonConstantCapacity} the only feasible flow is sending all flow over the edge $e_2$ as sending any flow into edge $e_1$ will lead to a positive flow volume on this edge during the interval $[2,3]$ (which the edge capacity does not allow for). However, switching from edge $e_2$ to edge $e_1$ is an \addmDev{} according to both \eqref{eq:FeasibleDeviationsAlwaysAdditionalSpaceEnter} and \eqref{eq:UnsaturatedPathsFeasibleAfterDeviationEnter} during $[0,1]$ as there is still capacity left on edge $e_1$ at the time these particles would enter edge $e_1$. Thus, this network has no \sCDEdf{} or \sCDEu. At the same time, deviating from edge $e_2$ to edge $e_1$ is not an \addmDev{} according to \eqref{eq:FeasibleDeviationsAdditionalSpaceExceptCommonPrefixTravelling} or \eqref{eq:UnsaturatedPathsFeasibleAfterDeviationTravelling} and, thus, sending all flow via edge $e_2$ is both a \wCDEdf{} and a \wCDEuP.
\end{example}

Indeed, for \wCDEuP{}, we can remove the assumption that $c_e$ is non-decreasing and allow more general capacity functions if we impose some stronger assumptions on the network loading. 

\begin{enumerate}[label=(A\arabic*),resume=Assumptions]
	\item The walk travel times are induced by edge delay functions $D_e(h,t)$, i.e. for any walk $p$ and edge $e = (v_j,v_{j+1}) \in p$, we have $\tau^{j+1}_p(h,t) = \tau^j_p(h,t) + D_e(h, \tau^j_p(h,t))$.\label[asmpt]{ass:tauInducedByEdgeDelays}
	\item The edge load function satisfies the FIFO-compatible principle of causation, i.e. for any two time $a < b$ with $f_e(h,b) > 0$ and $b > a + D_e(h,a)$, there exists some walk $p \in \Pc$ with $e=(v_j,v_{j+1}) \in p$ and some set $J^{-1} \subseteq \planningInterval$ of positive measure such that $h_p(t) > 0$ and $\tau^j_p(h,t) \in [a,b]$ for all $t \in J^{-1}$.\label[asmpt]{ass:FIFOcompatiblePrincipleOfCausation}
	\item For any edge $e$ and walk inflow $h$, the function $f_e(h,.)$ is uniformly continuous.\label[asmpt]{ass:fUniformlyContinuous}
	\item For any edge $e$ the capacity function $c_e$ is continuous on $\IR_{\geq 0}$.\label[asmpt]{ass:CapacityContinuous} 
	\item For any edge $e$ and walk inflow $h$, we have $f_e(h,\theta) \leq c_e(\theta)$ for all $\theta \in [0,D_e(h,0)]$.\label[asmpt]{ass:FeasibleAtStartInterval}
	\item The edge delays are non-negative, i.e. $D_e(h,t) \geq 0$ for all $h,t$ and $e$.\label[asmpt]{ass:EdgeDelaysNonNegative}
	\item For any edge $e$ and any weakly convergent sequence $h^n$, the sequence $D_e(h^n,.)$ converges uniformly.\label[asmpt]{ass:EdgeDelaysConvergeUniform}
	\item For every $h\in \Lambda(Q)$ and $i\in I$, there exists some $p\in \Pc_i$ and $J \subseteq [t_0,t_f]$ of positive measure such that for all $t \in J$, we have $h_p(t) < B_p$ and $f_e(h, \theta)\leq c_e(\theta)$ for all $e = (v_j,v_{j+1})\in p$ and $\theta \in [\tau^j_p(h,t),\tau^{j+1}_p(h,t)]$.\label[asmpt]{ass:ExistenceOfUnsaturatedPathInterval}
\end{enumerate}

The FIFO-compatible principle of causation~\ref{ass:FIFOcompatiblePrincipleOfCausation} states that whenever the edge-load function is positive, there must be particles that have entered but not left the edge before that times assuming that the edge dynamics satisfy the FIFO principle.

\begin{theorem}\label{thm:ExistenceFDAddSpaceExCPInterval}
	Under \cref{ass:PsiBoundedFlowIndependent,ass:FinitelyManyWalks,ass:PathInflowBounds,ass:PsiConvergesUniform,ass:EffectivePathDelayContinuous,ass:tauInducedByEdgeDelays,ass:EdgeDelaysConvergeUniform,ass:FIFOcompatiblePrincipleOfCausation,ass:fUniformlyContinuous,ass:fConvergesUniform,ass:CapacityNN,ass:CapacityContinuous,ass:FeasibleAtStartInterval,ass:EdgeDelaysNonNegative,ass:ExistenceOfUnsaturatedPathInterval}, there always exist \wCDEu{} and \wCDEuP.
\end{theorem}

\begin{proof}
	By \Cref{prop:RelationshipsOfCDE} we only need to show the existence of a \wCDEuP. To do that we define a new edge-load function 
		\[\tilde{f}_e(h,t) \coloneqq \max\Set{f_e(h,\theta)-c_e(\theta) | \theta \in [t,t+D_e(h,t)]}\]
	and new constant edge-capacity functions $\tilde{c}_e(t) \coloneqq 0$ for all $t \in \IR_{\geq 0}$.
	
	\begin{claim}\label{claim:EquivaleneOfAddmEpsSetsWithAndWithoutInterval}
		An \addmEpsDev{} with respect to $\tilde{f}_e$ and \eqref{eq:FeasibleDeviationsAdditionalSpaceExceptCommonPrefixEnter} is an \addmEpsDev{} with respect to $f_e$ and \eqref{eq:FeasibleDeviationsAdditionalSpaceExceptCommonPrefixTravelling} and vice versa.
	\end{claim}
	
	\begin{proofClaim}
		First, let $(q,J,\varepsilon,\Delta)$ be an \addmEpsDev{} from $p$ with respect to $\tilde{f}_e$ and \eqref{eq:FeasibleDeviationsAdditionalSpaceExceptCommonPrefixEnter}. Then, for any $t \in J$ and $e = (v_j,v_{j+1}) \in \tilde{q}$, we have 
		\begin{align*}
			0 &= \tilde{c}_e(\tau^j_q(h,t)) > \tilde{f}_e(h,\tau^j_q(h,t)) \\
			&= \max\Set{f_e(h,\theta)-c_e(\theta) | \theta \in [\tau^j_q(h,t),\tau^j_q(h,t)+D_e(h,\tau^j_q(h,t))]} \\
			&\overset{\text{\ref{ass:tauInducedByEdgeDelays}}}{=} \max\Set{f_e(h,\theta)-c_e(\theta) | \theta \in [\tau^j_q(h,t),\tau^{j+1}_q(h,t)]} 
		\end{align*}
		and, therefore $f_e(h,\theta) < c_e(\theta)$ for all $\theta \in [\tau^j_q(h,t),\tau^{j+1}_q(h,t)]$ which implies that $(q,J,\varepsilon,\Delta)$ is an \addmEpsDev{} from $p$ with respect to $f_e$ and \eqref{eq:FeasibleDeviationsAdditionalSpaceExceptCommonPrefixTravelling}.
		
		Now, if $(q,J,\varepsilon,\Delta)$ is an \addmEpsDev{} from $p$ with respect to $f_e$ and \eqref{eq:FeasibleDeviationsAdditionalSpaceExceptCommonPrefixTravelling}, then, we have $f_e(h,\theta) > c_e(\theta)$ for all $t \in J$, $\theta \in [\tau^j_q(h,t),\tau^{j+1}_q(h,t)]$ and $e = (v_j,v_{j+q}) \in \tilde{q}$ implying -- by the same calculation as before -- that $\tilde{c}_e(\tau^j_q(h,t)) > \tilde{f}_e(h,\tau^j_q(h,t))$ for all such $t$ and $e$. Thus, $(q,J,\varepsilon,\Delta)$ is an \addmEpsDev{} from $p$ with respect to $\tilde{f}_e$ and~\eqref{eq:FeasibleDeviationsAdditionalSpaceExceptCommonPrefixEnter}.
	\end{proofClaim}
	
	Now, using assumption~\ref{ass:EdgeDelaysNonNegative} and the same calculations as in the proof of the previous claim, we observe that the constraint set defined using $\tilde{f}$ and $\tilde{c}$ is the same as the one defined by $f$ and $c$. Thus, \Cref{claim:EquivaleneOfAddmEpsSetsWithAndWithoutInterval} implies that any \sCDEuP{} for $\tilde{f}$ and $\tilde{c}$ is also a \wCDEuP{} for $f$ and $c$. Consequently, to show existence of such an equilibrium, it suffices to show that we can apply \Cref{thm:ExistenceFDAddSpaceExCP} to the instance with $\tilde{f}$ and $\tilde{c}$. 

	\begin{claim}
		The new edge-load functions $\tilde{f}$ satisfy \cref{ass:StrongPrincipleOfCausation,ass:fContinuous,ass:fConvergesUniform,ass:ExistenceOfUnsaturatedPath}.
	\end{claim}

	\begin{proofClaim}
		\Cref{ass:CapacityContinuous,ass:fUniformlyContinuous} together with the definition of $\tilde{f}$ directly imply that the new edge-load function is again continuous, i.e. satisfies \ref{ass:fContinuous}.
		
		To see that \ref{ass:fConvergesUniform} holds for $\tilde{f}$ take any sequence of walk inflows $h^n$ converging weakly to some walk inflow $h^*$. Then for any edge $e$ we have
			\begin{align*}
				&\norm{\tilde{f}_e(h^n,.)-\tilde{f}_e(h^*,.)}_\infty = \max_{t \in \IR_{\geq 0}}\abs{\tilde{f}_e(h^n,.)-\tilde{f}_e(h^*,.)} \\
				&\quad= \max_{t \in \IR_{\geq 0}}\abs{\max_{\theta \in [t,t+D_e(h^n,t)]}\left(f_e(h^n,\theta)-c_e(\theta)\right)-\max_{\theta \in [t,t+D_e(h^*,t)]}\left(f_e(h^*,\theta)-c_e(\theta)\right)} \\
				&\quad\leq \max_{t \in \IR_{\geq 0}}\abs{\max_{\theta \in [t,t+D_e(h^n,t)]}\left(f_e(h^n,\theta)-c_e(\theta)\right)-\max_{\theta \in [t,t+D_e(h^n,t)]}\left(f_e(h^*,\theta)-c_e(\theta)\right)} \\
					&\quad\quad\quad+ \max_{t \in \IR_{\geq 0}}\abs{\max_{\theta \in [t,t+D_e(h^n,t)]}\left(f_e(h^*,\theta)-c_e(\theta)\right)-\max_{\theta \in [t,t+D_e(h^*,t)]}\left(f_e(h^*,\theta)-c_e(\theta)\right)}\\
				&\quad\leq \max_{t \in \IR_{\geq 0}}\max_{\theta \in [t,t+D_e(h^n,t)]}\abs{f_e(h^n,\theta) - f_e(h^*,\theta)} \\
					&\quad\quad\quad+ \max\Set{\abs{f_e(h^*,\theta)-f_e(h^*,\theta')} \,\Big|\, \theta,\theta' \in \IR_{\geq 0}, \abs{\theta-\theta'} \leq \norm{D_e(h^n,.)-D_e(h^*,.)}_\infty}\\	
				&\quad\leq \norm{f_e(h^n,.)-f_e(h^*,.)}_\infty \\
					&\quad\quad\quad+ \max\Set{\abs{f_e(h^*,\theta)-f_e(h^*,\theta')} \,\Big|\, \theta,\theta' \in \IR_{\geq 0}, \abs{\theta-\theta'} \leq \norm{D_e(h^n,.)-D_e(h^*,.)}_\infty}.
			\end{align*}
		Now the two terms at the end go to zero as $n$ goes to infinity by \cref{ass:fUniformlyContinuous,ass:fConvergesUniform,ass:EdgeDelaysConvergeUniform} for $f_e$. Thus, \ref{ass:fConvergesUniform} holds for $\tilde{f}_e$ as well.
		
		Assumption~\ref{ass:ExistenceOfUnsaturatedPathInterval} for $f$ implies that \ref{ass:ExistenceOfUnsaturatedPath} holds for $\tilde{f}$.
		
		To show that $\tilde{f}$ satisfies the principle of causation (i.e. \ref{ass:StrongPrincipleOfCausation}) take any walk inflow $h$, edge $e$ and two times $a < b$ with $0 \leq \tilde{f}_e(h,a) < \tilde{f}_e(h,b)$. Then the definition of $\tilde{f}$ implies that there exists some time $\theta \in [b,b+D_e(h,b)]$ with
			\[ f_e(h,\theta) \overset{\text{\ref{ass:CapacityNN}}}{\geq} f_e(h,\theta) - c_e(\theta) > \tilde{f}_e(h,a) \geq 0.\] 
		The definition of $\tilde{f}_e(h,a)$ then implies $\theta \notin [a,a + D_e(h,a)]$ and, thus, $\theta > a+D_e(h,a)$. By~\ref{ass:FIFOcompatiblePrincipleOfCausation} this gives us some walk $p \in \Pc$ with $e=(v_j,v_{j+1}) \in p$ and some set $J^{-1} \subseteq \planningInterval$ of positive measure such that $h_p(t) > 0$ and $\tau^j_p(h,t) \in [a,b]$ for all $t \in J^{-1}$. But this is exactly what we need for \ref{ass:StrongPrincipleOfCausation} to hold for $\tilde{f}$.
	\end{proofClaim}
	Since the walk travel times $\tau^j_p$ are induced by the edge delays (cf. \labelcref{ass:tauInducedByEdgeDelays}), \cref{ass:EdgeDelaysConvergeUniform} implies that \cref{ass:tEqualOnCommonPrefix,ass:tauConvergesUniform} hold. Furthermore, the new edge-capacities $\tilde{c}_e$ are constant and non negative (i.e. satisfy \labelcref{ass:CapacityNonDecreasing,ass:CapacityNN})) and assumption~\ref{ass:FeasibleAtStartInterval} on $c$ and $f$ implies that $\tilde{c}$ and $\tilde{f}$ satisfy \ref{ass:FeasibleAtStart}. Thus, we can now apply \Cref{thm:ExistenceFDAddSpaceExCP} to get the existence of a \sCDEuP{} $h^*$ for the edge-load functions $\tilde{f}$ and capacities $\tilde{c}$ which, as already shown, is also a \wCDEuP{} for the original edge-load functions $f$ and capacities $c$.
\end{proof}

Two important models for which we can now apply the above existence results are the Vickrey point queue model and the liner edge delay model described in \Cref{sec:counter}. More precisely, let the edge delays be defined as $D_e(h,\theta) \coloneqq \tau_e + \frac{q_e(h,\theta)}{\nu_e}$ or $D_e(h,\theta) \coloneqq \tau_e + \frac{x_e(h,\theta)}{\nu_e}$ and assume that all free flow travel times and service rates are strictly positive and finite:
\begin{enumerate}[label=(A\arabic*),resume=Assumptions]
	\item For all edges $e \in E$ we have $\tau_e, \nu_e \in \IR_{>0}$.\label[asmpt]{ass:TauNuPosFinite}
\end{enumerate}
Furthermore, we define the \effWalkDelay s by 
	\[\Psi_p(h,t) \coloneqq C_p(\tau^{\abs{p}+1}_p(h,t), t + \tau^{\abs{p}+1}_p(h,t)) \text{ for all } p \in \Pc_i,\]
where $C_p$ is a continuous function mapping travel and arrival time to total travel cost and $\tau^j_p$ is derived from the edge delays (i.e. defined as in \cref{ass:tauInducedByEdgeDelays}). Finally, we use the flow volume on an edge as its edge load, i.e. $f_e(h,t) \coloneqq x_e(h,t)$.

Both these models then automatically satisfy all the previous assumptions posed on the flow dynamics -- thus, we only have to check whether a given network also satisfies the additional assumptions on the network itself to be able to apply the two existence theorems of this section.

\begin{lemma}\label{lemma:VickreyModelSatisfiesAssumptions}
	Under \cref{ass:FinitelyManyWalks,ass:TauNuPosFinite} the two models described above both satisfy \cref{ass:EffectivePathDelayContinuous,ass:fContinuous,ass:fUniformlyContinuous,ass:fConvergesUniform,ass:StrongPrincipleOfCausation,ass:PsiConvergesUniform,ass:PsiBoundedFlowIndependent,ass:EdgeDelaysNonNegative,ass:EdgeDelaysConvergeUniform,ass:FIFOcompatiblePrincipleOfCausation,ass:tEqualOnCommonPrefix,ass:tauConvergesUniform,ass:tauInducedByEdgeDelays}.
\end{lemma}

\begin{proof}
	We first note, that both in the Vickrey point queue model and the linear edge delay model any fixed network with finite walk set $\Pc$ and fixed flow volume $Q$ has some constant $K > 0$ such that for any walk inflow $h \in \Lambda(Q)$ and edge $e \in E$ the support of $x_e(h,.)$ is in $[0,K]$. This can be shown by the same proof as the one for \cite[Lemma 4.4 (full version)]{GHP22}. Together with the continuity of the functions $C_p$ this already implies that $\Psi_p$ is bounded, i.e. \cref{ass:PsiBoundedFlowIndependent} holds.
	
	Then, for the Vickrey point queue model, one can show in the same way as in the proofs of \cite[Claims 3, 4, 5 (full version)]{GHP22} that the mappings $h \mapsto \int_0f^+_e(\theta)\diff\theta$ and $h \mapsto \int_0f^-_e(\theta)\diff\theta$ are sequentially weak-strong continuous from $\Lambda(Q) \subseteq L^2(\planningInterval)^\Pc$ to $C([0,K])^E$. It then immediately follows that the same is true for the mappings $h \mapsto x_e(h,.)$, $h \mapsto q_e(h,.)$, $h \mapsto D_e(h,.)$, $h \mapsto D_p(h,.)$ and $h \mapsto \Psi_p(h,.)$. This shows that \cref{ass:EffectivePathDelayContinuous,ass:fContinuous,ass:fUniformlyContinuous,ass:fConvergesUniform,ass:PsiConvergesUniform,ass:EdgeDelaysConvergeUniform} are satisfied.
	
	For the linear edge delay model the required continuity properties have been shown by Zhu and Marcotte in~\cite{ZhuM00}. Namely, \cite[Corollary 5.1]{ZhuM00} shows that linear edge delays satisfy the strong FIFO condition and, thus, \cite[Theorem 3.3]{ZhuM00} implies that the mapping $h \mapsto x_e(h,.)$ is sequentially weak-strong continuous from $\Lambda(Q) \subseteq L^2(\planningInterval)^\Pc$ to \mbox{$L^2([0,K])^E$}. Since both, walk inflow rates and edge outflow rates, are bounded, we can then apply \cite[Proposition 3.1]{ZhuM00} to show that the mapping is even sequentially weak-strong continuous to $C([0,K])^E$. From this we again immediately get \cref{ass:EffectivePathDelayContinuous,ass:fContinuous,ass:fUniformlyContinuous,ass:fConvergesUniform,ass:PsiConvergesUniform,ass:EdgeDelaysConvergeUniform}.
	
	\Cref{ass:EdgeDelaysNonNegative} follows directly from the definition of $D_e$ and the nonnegativity of the queue length $q_e$ or the flow volume $x_e$, respectively. \Cref{ass:tEqualOnCommonPrefix,ass:tauConvergesUniform} follow from \ref{ass:EdgeDelaysConvergeUniform} in the same way as in the proof of \Cref{thm:ExistenceFDAddSpaceExCPInterval}.
	
	It remains to show that \cref{ass:StrongPrincipleOfCausation,ass:FIFOcompatiblePrincipleOfCausation} (the principles of causation) hold as well. This can be shown in the same way for both models: For \ref{ass:StrongPrincipleOfCausation} we observe that the flow volume of an edge can only increase during some interval $[a,b]$ if there is positive inflow into this edge for some subset $J \subseteq [a,b]$ of positive measure. The definition of the flow dynamics then directly implies the existence of some walk $p$ with $e=(v_j,v_{j+1}) \in p$ and some set $J^{-1} \subseteq \planningInterval$ of positive measure such that $h_p(t) > 0$ and $\tau^j_p(h,t) \in J \subseteq [a,b]$ for all $t \in J^{-1}$.
	
	For \ref{ass:FIFOcompatiblePrincipleOfCausation} we also use flow conservation on edges~\eqref{eq:FlowConservationOnEdges} which implies that any flow on some edge $e$ at time $a$ has left this edge by time $a+D_e(h,a)$. Thus, if there is still positive flow volume on edge $e$ at some later time $b > a+D_e(h,a)$, there must have been some additional inflow into this edge between $a$ and $b$. This then gives us the desired walk $p$ and set $J^{-1}$ in exactly the same way as before.
\end{proof}

\begin{cor}\label{cor:ExistenceVickrey}
	Using either the Vickrey point queue model or the linear edge delay model as described above
	\begin{itemize}
		\item any network satisfying \cref{ass:FinitelyManyWalks,ass:PathInflowBounds,ass:CapacityNonDecreasing,ass:CapacityNN,ass:ExistenceOfUnsaturatedPath,ass:FeasibleAtStart} has a \sCDEuP{} and
		\item any network satisfying \cref{ass:FinitelyManyWalks,ass:PathInflowBounds,ass:CapacityNN,ass:CapacityContinuous,ass:FeasibleAtStartInterval,ass:ExistenceOfUnsaturatedPathInterval} has a \wCDEuP.
	\end{itemize}
\end{cor}

\begin{proof}
	This follows directly from \Cref{lemma:VickreyModelSatisfiesAssumptions} together with \Cref{thm:ExistenceFDAddSpaceExCP,thm:ExistenceFDAddSpaceExCPInterval}.
\end{proof}

We conclude by noting that, in contrast to unconstrained dynamic equilibria, it seems unlikely that an existence result like \Cref{cor:ExistenceVickrey} for the Vickrey point queue model with fixed network inflow rates can be shown using an extension approach instead wherein one ``constructs'' an equilibrium by iteratively extending the walk inflow over longer and longer time intervals (cf. \cite{Koch11,SeringThesis}). This is, because an important ingredient for the success of such a construction process is the observation that, in an unconstrained dynamic equilibrium, later starting particles can never influence earlier starting particles (and, thus, later extensions can not invalidate earlier ones). For side-constrained dynamic equilibria, however, there exists a simple single-commodity instance wherein this is not true, i.e. even in an equilibrium particles may still overtake each other. Moreover, this instance does indeed have a unique equilibrium which has a prefix which is not an equilibrium on its own:

\begin{figure}[ht]
	\centering
	\input{tikz/CounterExamplePhaseConstruction}
	%\includegraphics[width=.8\textwidth]{Images/PhaseExtension.pdf}
	\caption{A single-commodity network with fixed network inflow rate and a volume-constraint on one edge. All values of $\nu$ not explicitly given are infinity. Under the Vickrey point queue model this instance has a unique \wCDEu{} (which is also a \sCDEu) with the property that restricting it to $[0,2]$ is not an equilibrium for this instance.}\label{fig:PhaseExtensionImpossible}
\end{figure}

\begin{example}\label{ex:PhaseExtensionImpossible}
	\Cref{fig:PhaseExtensionImpossible} depicts a single-commodity network with fixed network inflow rate and a constant volume-constraint on one edge. Under the Vickrey point queue model this instance has a unique \wCDEu: Over the whole interval $[0,3]$ particles are send into the path $e_1,vt$ at a rate of $2$. Between time $1$ and $2$ the remaining particles are send over the direct edge towards $t$ and after time $2$ the remaining particles are sent into the path $e_2,vt$. To see why this is an equilibrium, observe that after time $1$ the volume constraint on edge $e_1$ is always tight and, thus, switching to path $e_1,vt$ is never an \addmDev. Furthermore, due to the queue on edge $vt$ the travel time over path $e_2,vt$ is strictly larger than $6$ during $(0,2)$. 
	
	However, restricting this path inflow to the interval $[0,2]$ does not yield a \wCDEu{} as then the queue on edge $vt$ will never grow beyond a length of $2$ and, consequently the travel time over path $e_2,vt$ will always be strictly shorter then over edge $st$ (except at time $1$).
	
	Note, that in the equilibrium for the whole interval $[0,3]$ particles travelling along path $e_2,vt$ will get overtaken by later starting particles travelling along path $e_1,vt$. This is something that cannot happen in the unconstrained model as there the former particles could than always improve by copying the latter's strategy. Here, on the other hand, this is not allowed due to the capacity constraint. This effect is essentially independent of the exact equilibrium concept, i.e. the above observation is equally true for all the equilibrium concepts defined in \Cref{def:TypesOfCDE}.
\end{example}