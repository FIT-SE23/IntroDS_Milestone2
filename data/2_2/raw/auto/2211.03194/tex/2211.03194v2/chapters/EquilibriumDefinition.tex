% !TeX spellcheck = en_GB
%!TEX root = ../side-constrained.tex

\section{A General Framework for Side-Constrained Dynamic Equilibria}\label{sec:framework}

The general idea of dynamic equilibria is to find a walk inflow $h$ such that (almost) no particle has a better alternative. In the unconstrained case, ``alternative'' just means any other walk (and departure time) available to that particle's commodity. In particular, the set of all alternatives of any given particle is independent of the specific flow induced by $h$. This need not be the case anymore for flows with side-constraints as, for example, a certain walk may become unavailable depending on the flow volume already on any particular edge of this walk under $h$.

We will now introduce an abstract framework that will allow us to define different types of such side-constrained equilibria. This framework consists of two objects: First, we have a constraint set $S \subseteq \Lambda(Q)$ defining the set of feasible walk inflows. Second, for every commodity $i \in I$ and walk $p \in \Pc_i$, there is a correspondence
	\[A_p: S \to 2^{\Pc_i \times \mathcal{M}(\planningInterval) \times \IR_{\geq 0} \times \IR}, h \mapsto A_p(h),\]
mapping every walk inflow $h$ to the set of \emph{\addmEpsDev s} of commodity $i$ from walk $p$. Hereby, $2^X$ denotes the power set of $X$ and $\mathcal{M}(\planningInterval)$ the set of all measurable subsets of $\planningInterval$. An element $(q,J,\varepsilon,\Delta) \in A_{p}(h)$ then denotes the following \addmEpsDev: Given the walk inflow $h$, commodity $i$ is allowed to shift flow at a rate of $\varepsilon$ \emph{in space} from walk $p$ to walk $q$ and \emph{in time} from $J$ to $J + \Delta \coloneqq \Set{t + \Delta | t \in J}$. For any such $(q,J,\varepsilon,\Delta) \in A_{p}(h)$ we will denote the walk inflow obtained after this deviation by
\begin{equation}\label{eq:H-r}
	H_{p\to q}(h,J,\varepsilon,\Delta) \coloneqq (h'_w)_{w \in \Pc} \text{ with } h'_w \coloneqq \begin{cases} 
		\left[h_p-\varepsilon \CharF[J]\right]_+, &\text{for } w=p\\
		h_q+ \left(h_p(\_-\Delta)-h'_p(\_-\Delta)\right), &\text{for } w=q\\
		h_{w}, &\text{else}
	\end{cases},
\end{equation}
where 
\[\CharF[J]: [t_0,t_f] \to \R, t \mapsto \begin{cases}
	1, &\text{ if } t \in J \\
	0, &\text{ else }
\end{cases}\]
is the indicator function of the set $J$ and for any function $g: \planningInterval \to \IR$ the function $[g]_+$ is the non-negative part of $g$, \ie the function
\[[g]_+: \planningInterval \to \IR, t \mapsto \max\{g(t),0\}.\]
Furthermore, we implicitly assume that all walk inflows are $0$ outside the planning horizon~$\planningInterval$. \Cref{fig:ExampleAddmEpsDev} gives an example for how $H_{p\to q}(h,J,\varepsilon,\Delta)$ is obtained from $h$.

\begin{figure}[h]
	\centering
	\begin{adjustbox}{max width=.7\textwidth}
		\input{tikz/ExampleAdmEpsDev}
	\end{adjustbox}
	\caption{An example for how an \addmEpsDev{} $(q,J,\varepsilon,\Delta) \in A_{p}(h)$ changes the path inflow rates on the involved paths $p$ and $q$ from the original flow $h$ (left) to the new flow $h' \coloneqq H_{p\to q}(h,J,\varepsilon,\Delta)$ (right).}\label{fig:ExampleAddmEpsDev}
\end{figure}

From now on we will always require that for any $h \in S$ and $(q,J,\varepsilon,\Delta) \in A_p(h)$ we have $H_{p \to q}(h,J,\varepsilon,\Delta) \in \Lambda(Q)$. This ensures that \addmEpsDev s cannot lead to a violation of the walk-inflow bounds $B_p$ or move inflow outside the planning horizon $\planningInterval$. The latter, in particular, implies that we always have $H_{p \to q}(h,J,\varepsilon,\Delta) \in L^2_+(\planningInterval)^\Pc$ and, thus, $\Psi$ is well defined on any such flow.

The correspondence
\[
\begin{aligned}
	M_i: &S \to L^2_+ ([t_0,t_f])^{\Pc}\\ 
	& h \mapsto \set{h' \in L^2 ([t_0,t_f])^{\Pc} | \exists p \in \Pc_i, (q,J,\varepsilon,\Delta) \in A_p(h): h' = H_{p \to q}(h,J,\varepsilon,\Delta)}\end{aligned}\]
then returns for any given walk inflow $h$ the set of all possible walk inflows obtained by any of commodity $i$'s \addmEpsDev. Note that, in general, $M_i$ and $S$ can be completely independent of each other. In particular, a flow obtained by an \addmEpsDev{} might be infeasible (\ie $M_i(h) \not\subseteq S$) and not all feasible flows might be reachable by an \addmEpsDev{} even if they only differ by a single commodity's deviation (\ie $\Set{H_{p\to q}(h,J,\varepsilon,\Delta) \in S} \not\subseteq M_i(h)$).

Now, any constraint set $S$ together with a family of deviation correspondences $A_p$ gives rise to the following informal equilibrium concept: A walk inflow $h$ is an equilibrium with respect to $S$ and $A_p$, if it is feasible and no particle can improve by an \addmEpsDev. 
To make this mathematically precise, 
we introduce the concept of \emph{\addmDev s} to some fixed walk $p$ of commodity $i$ with respect to some $h \in S$ at any fixed time $t \geq 0$ by defining the set
\begin{align}\label{eq:feasible-deviation} 
	\!\!U_{p}(h, t) 
	&\coloneqq \Set{\!
		(q,\Delta)\in \Pc_i \times \IR |\! \begin{array}{l}
			\forall \delta > 0, \varepsilon > 0: \exists J \subseteq [t-\delta,t+\delta], \varepsilon' \leq \varepsilon:
			\\
			\int_J \min\set{h_p(t'),\varepsilon'} \diff t' > 0 \text{ and } (q,J,\varepsilon',\Delta) \in A_p(h) 
		\end{array}\!\!\!
	}.
\end{align}
In words: A walk $q$ and a shift $\Delta$ form an admissible alternative to $p$ at time $t$, if we can shift arbitrarily small amounts of flow in space from $p$ to $q$ and in time from small neighbourhoods of $t$  to small neighbourhoods of $t+\Delta$. 
This concept can be interpreted as a dynamic extension of the methodology of Bernstein and Smith~\cite{BernsteinS94}.

Note that, if there is no inflow into a walk $p$ in some neighbourhood of $t$, then $U_{p}(h,t)$ will always be empty (regardless of the state of the alternative walks). If we assume that the trivial deviation  (\ie shifting flow from $p$ to $p$ and from $J$ to $J$) is always admissible then the converse also holds, \ie we have: $U_{p}(h,t)$ is non-empty if and only if there is inflow into $p$ near $t$. We formalize this assumption as

\begin{enumerate}[label=(A\arabic*),resume=Assumptions]
	\item For any walk inflow $h \in S$, commodity $i \in I$, walk $p \in \Pc_i$, measurable set $J \in \mathcal{M}([t_0,t_f])$ and $\varepsilon > 0$, we have $(p,J,\varepsilon,0) \in A_{p}(h)$.\label[asmpt]{ass:TrivialDeviation}
\end{enumerate}

From now on, we will always assume that the \effWalkDelay{} for any given walk inflow $h$ is continuous.

\begin{enumerate}[label=(A\arabic*),resume=Assumptions]
	\item For any $h \in S$ and $p \in \Pc$, the function $\Psi_{p}(h,.): [t_0,t_f] \to \IR$ is continuous.\label[asmpt]{ass:EffectivePathDelayContinuous}
\end{enumerate}

We can then formally define the concept of a side-constrained dynamic equilibrium in our model as follows:
\begin{framed}
\begin{definition}\label{def:DCE}
	Given a graph $G$, a set of commodities $I$, a set of feasible walks $\Pc$, an \effWalkDelay{} operator $\Psi$, a constraint set $S$ and for every walk $p \in \Pc$ a correspondence $A_p$. Then a feasible flow $h^*\in S$ is a \emph{\SCDE[full] (\SCDE)} \wrt $S$ and $A_p$, if for all $p \in \Pc$ and all $t \in [t_0,t_f]$ the following condition holds:
	\begin{equation}\label{eq:CDE} 
		\Psi_p(h^*,t) \leq  \Psi_q(h^*,t+\Delta) \text{ for all } (q,\Delta) \in U_{p}(h^*, t).
	\end{equation}
\end{definition}
\end{framed}

Note that the above model encompasses both (side-constrained) dynamic equilibria with and without departure time choice. In particular, to disable departure time choice we just choose some $S \subseteq \Lambda(r)$ and define $A_p$ such that it only contains deviations of the form $(q,J,\varepsilon,0)$.

\subsection{Some properties of \SCDE}

We observe that an alternative (negative) definition of side-constrained dynamic equilibria is as follows: A flow is \emph{not} an equilibrium if there exist two walk-time pairs $(p,t)$ and $(q,t')$ such that the cost of walk $q$ at time $t'$ is strictly lower than that of walk $p$ at time $t$ and we can shift flow in arbitrarily small neighbourhoods of $t$ from $p$ to neighbourhoods of $t'$ on $q$. This is formalized in the following lemma:
\begin{lemma}\label{lemma:NegativeCharacterization}
	A flow $h \in S$ is \emph{not} a \SCDE{} if and only if there exists a commodity $i \in I$, walks $p,q \in \Pc_i$, times $t,t' \in \planningInterval$, a sequence of measurable sets $J_n \subseteq [t_0,t_f]$ and a sequence of constants $\varepsilon_n > 0$ such that
	\begin{enumerate}[label=\alph*)]
		\item $\lim_n \varepsilon_n = 0$,
		\item $\lim_n \inf J_n = t = \lim_n \sup J_n$, 
		\item $\Psi_p(h,t) > \Psi_q(h,t')$ and
		\item $\int_{J_n} h_p(\theta) \diff\theta > 0$ and $(q,J_n,\varepsilon_n,t'-t) \in A_p(h)$ for all $n \in \IN$.
	\end{enumerate}
\end{lemma}

\begin{proof}
	If the conditions from the lemma are satisfied then a), b) and d) together show that $(q,t'-t) \in U_{p}(h,t)$. Then c) implies that $h$ is not a \SCDE.
	
	If, on the other hand, we know that $h$ is not a \SCDE[full], then there must be some $t \in [t_0,t_f]$, $i \in I$, $p,q \in \Pc_i$ and $\Delta \in \IR$ such that both $\Psi_p(h,t) > \Psi_q(h,t+\Delta)$ and $(q,\Delta) \in U_{p}(h,t)$ hold. The latter then implies the existence of $J_n \in \mathcal{M}([t_0,t_f])$ and $\varepsilon_n > 0$ satisfying a), b) and d) while the former is exactly c) with $t'\coloneqq t + \Delta$.
\end{proof}
The next lemma formalizes the intuition that larger sets of \addmEpsDev s lead to stronger equilibria.
\begin{lemma}\label{lemma:MoreAlternativesGiveStrongerEquilibria}
	Let $S$ be a \setS{} and $A_p$ and $A'_p$ two correspondences defining \addmEpsDev s. If $h^* \in S$ is a \SCDE{} \wrt $S$ and $A_p$ and $A'_p(h^*) \subseteq A_p(h^*)$ holds for every $p \in \Pc$ then $h^*$ is also a \SCDE{} \wrt $S$ and $A'_p$.
\end{lemma}

\begin{proof}
	This follows immediately from the observation that $A'_p(h^*) \subseteq A_p(h^*)$ implies $U'_p(h^*,t) \subseteq U_p(h^*,t)$ for all $t \in [t_0,t_f]$ (where $U'_p$ denotes the \addmDev s defined by $A'_p$). 
\end{proof}

The following two lemmas show that in many cases, we can \wlofg restrict ourselves to smaller sets of feasible walks $\Pc_i$ (\eg in order to make them finite and satisfy \ref{ass:FinitelyManyWalks}) or assume that the effective walk-delay operators $\Psi_p$ are bounded (\ie satisfy \ref{ass:PsiBounded}). For the first lemma we make use of the concept of dominating walks introduced in \cite{GHP22}.

\begin{definition}
	We call a subset $\Pc' \subseteq \Pc$ a \emph{dominating walk set}, if for every walk $p \in \Pc$, $h \in S$, $t \in [t_0,t_f]$ and $(q,\Delta) \in U_p(h,t)$, there exists some $(q',\Delta') \in U_p(h,t)$ such that $q' \in \Pc'$ and $\Psi_{q'}(h,t+\Delta') \leq \Psi_q(h,t+\Delta)$.
\end{definition}

\begin{lemma}\label{lemma:RestrictToDominatingWalkSet}
	Let $\Pc' \subseteq \Pc$ a dominating walk-set and define 
		\[A'_p(h,t) \coloneqq \set{(q,J,\varepsilon,\Delta) \in A_p(h,t) | q \in \Pc'}.\]
	Then, any $h^* \in S' \coloneqq \Set{h \in S | h_p \equiv 0 \text{ for all } p \in \Pc\setminus\Pc'}$ is a \SCDE{} \wrt $S'$ and $A'_p$ if and only if it is a \SCDE{} \wrt $S$ and $A_p$.
\end{lemma}

\begin{proof}
	The `if'-part follows directly from \Cref{lemma:MoreAlternativesGiveStrongerEquilibria}. For the `only if'-part, take any walk $p \in \Pc_i$, time $t \in \planningInterval$ and \addmDev{} $(q,\Delta) \in U_p(h^*,t)$. Since $\Pc'$ is a dominating walk set, there must be some $(q',\Delta') \in U_p(h^*,t)$ with $\Psi_{q'}(h^*,t+\Delta') \leq \Psi_q(h^*,t+\Delta)$ and $q' \in \Pc'$. Since $h^*$ is a \SCDE{} \wrt $A'_p$, this gives us
		\[\Psi_p(h^*,t) \leq \Psi_{q'}(h^*,t+\Delta') \leq \Psi_q(h^*,t+\Delta).\] 
	Thus, $h^*$ is a \SCDE{} \wrt $A_p$ as well.
\end{proof}

\begin{definition}\label{def:truncatedPsi}
	For any $M \in \IR,$ we define the \emph{truncated effective walk delay operator} $\truncated{\Psi}{M}$ of $\Psi$ by setting
		\[\truncated{\Psi}{M}_p(h,t) \coloneqq \min\set{\Psi_p(h,t), M} \text{ for all } p \in \Pc, h \in \Lambda(Q), t \in \planningInterval.\]
\end{definition}

\begin{lemma}\label{lemma:RestrictToTruncatedPsi}
	Given $M \in \IR$ such that for all $h \in S$, $t \in \planningInterval$ and $p \in \Pc$ with $U_p(h,t) \neq \emptyset$ there exists some $(q,\Delta) \in U_p(h,t)$ such that $\Psi_q(h,t+\Delta) < M$,
	then any walk inflow $h^*$ is a \SCDE{} with respect to $\Psi$ if and only if it is a \SCDE{} with respect to $\truncated{\Psi}{M}$.
\end{lemma}

\begin{proof}
	First, let $h^*$ be a \SCDE{} with respect to $\Psi$. Then, for any $p \in \Pc$, $i \in I$ and $(q,\Delta) \in U_p(h^*,t)$, we have
		\[\truncated{\Psi}{M}_p(h^*,t) = \min\set{\Psi_p(h^*,t),M} \leq \min\set{\Psi_q(h^*,t+\Delta),M} = \truncated{\Psi}{M}_p(h^*,t+\Delta).\]
	Therefore, $h^*$ is also a \SCDE{} with respect to $\truncated{\Psi}{M}$.
	
	Now, let $h^*$ be a \SCDE{} with respect to $\truncated{\Psi}{M}$. Again, take any $p \in \Pc$, $i \in I$ and $(q,\Delta) \in U_p(h^*,t)$. Then, by the lemma's assumption, we have some $(q',\Delta') \in U_p(h^*,t)$ such that $\Psi_{q'}(h^*,t+\Delta') < M$ implying
		\[\truncated{\Psi}{M}_p(h^*,t) \leq \truncated{\Psi}{M}_q(h^*,t+\Delta') \leq \Psi_{q'}(h^*,t+\Delta') < M\]
	and, therefore, $\truncated{\Psi}{M}_p(h^*,t) = \Psi_p(h^*,t)$. This, in turn, implies
		\[\Psi_p(h^*,t) = \truncated{\Psi}{M}_p(h^*,t) \leq \truncated{\Psi}{M}_q(h^*,t+\Delta) \leq \Psi_q(h^*,t+\Delta).\]
	Thus, $h^*$ is a \SCDE{} with respect to $\Psi$.		
\end{proof}

\subsection{Some special cases of \SCDE}

We observe that the standard unconstrained dynamic equilibrium concepts are special cases of our model:

\begin{lemma}
	Assume that \ref{ass:EffectivePathDelayContinuous} holds. If we define $S \coloneqq \Lambda(Q)$ and 
		\[A_p(h) \coloneqq \Set{(q,J,\varepsilon,\Delta) | \begin{array}{l}
				q \in \Pc_i, J \in \mathcal{M}([t_0,t_f]), \varepsilon > 0, J, J+\Delta \subseteq [t_0,t_f] \text{ and }\\
				h_q(t) + \varepsilon \leq B_q \text{ for almost all } t \in J+\Delta \text{ or } q=p \text{ and } \Delta = 0
			\end{array}}\]
	for all $h \in S$, $p \in \Pc_i$ and $i \in I$, then any flow $h^* \in S$ is a \SCDE[full] in the sense of \eqref{eq:CDE} if and only if it is a dynamic equilibrium with fixed flow volumes and departure time choice in the sense of \eqref{eq:de-volume}.
\end{lemma}

\begin{proof}
	First, let $h^*$ be an equilibrium in the sense of \eqref{eq:de-volume} with corresponding values $\nu_i$. Now, take any time $t \in [t_0,t_f]$, shift $\Delta$ and walks $p,q \in \Pc_i$ such that $\Psi_p(h^*,t) > \Psi_q(h^*,t+\Delta)$. We then have to show that $(q,\Delta)$ is not an \addmDev, \ie that $(q,\Delta) \notin U_p(h^*,t)$. For this, we distinguish two cases: If we have $\Psi_q(h^*,t+\Delta) < \nu_i$, then \ref{ass:EffectivePathDelayContinuous} guarantees the existence of some neighbourhood $[t-\delta,t+\delta]$ of $t$ such that $\Psi_q(h^*,t'+\Delta) < \nu_i$ holds for all $t' \in [t-\delta,t+\delta]$. From \eqref{eq:de-volume} we then get that $h^*_q(t'+\Delta) \geq B_q$ for almost all these $t' \in [t-\delta,t+\delta]$ which, in turn, implies $(q,\Delta) \notin U_p(h^*,t)$. If, on the other hand, we have $\Psi_q(h^*,t+\Delta) \geq \nu_i$, then we have $\Psi_p(h^*,t) > \nu_i$ by our initial assumption. \Cref{ass:EffectivePathDelayContinuous} then again guarantees the existence of some $\delta > 0$ with $\Psi_p(h^*,t') > \nu_i$ for all $t' \in [t-\delta,t+\delta]$. From this \eqref{eq:de-volume} allows us to deduce $h^*_p(t')=0$ for almost all those $t'$ and, hence $U_p(h^*,t) = \emptyset$. 
	
	Now, let $h^*$ be an equilibrium in the sense of \eqref{eq:CDE} and assume for contradiction that it is not an equilibrium in the sense of \eqref{eq:de-volume}. Then, there must exist some commodity $i \in I$ such that there exists no $\nu_i \in \IR$ satisfying \eqref{eq:de-volume}. In particular, we must have $Q_i > 0$, and therefore 
		\[\nu_i \coloneqq \esssup\set{\Psi_p(h^*,t) | p \in \Pc_i, t \in [t_0,t_f], h^*_p(t) > 0} > -\infty\]
	where $\esssup$ denotes the essential supremum, \ie 
		\[\esssup\Set{g(x) | x \in X} \coloneqq \inf\Set{b \in \IR | \abs{\set{x \in X | g(x) > b}} = 0}\]
	where $\abs{.}$ denotes the measure on $X$. Since this $\nu_i$ cannot satisfy \eqref{eq:de-volume}, there must be a walk $q \in \Pc_i$, some $\varepsilon, \gamma > 0$ and a set $J_q \subseteq [t_0,t_f]$ of positive measure such that we have 
		\[h^*_q(t) \leq B_q - \varepsilon \text{ and } \Psi_q(h^*,t) \leq \nu_i - \gamma \text{ for all } t \in J_q.\]
	At the same time the definition of $\nu_i$ guarantees the existence of some walk $p \in \Pc_i$ and set $J_p \subseteq [t_0,t_f]$ of positive measure such that
		\[h^*_p(t) > 0 \text{ and } \Psi_p(h^*,t) > \nu_i - \gamma \text{ for all } t \in J_p.\]
	Now there must exist some $\Delta \in \IR$ such that $(J_p + \Delta) \cap J_q$ has positive measure. Defining $J \coloneqq J_p \cap (J_q-\Delta)$ gives us a set containing at least one $t \in J$ such that for all $n \in \IN$ the set $J_n \coloneqq [t-\frac{1}{n},t+\frac{1}{n}] \cap J$ has positive measure. Taking all this together we have
	\begin{itemize}
		\item $\lim_n\inf J_n = t = \lim_n \sup J_n$,
		\item $\Psi_p(h^*,t) > \nu_i - \gamma \geq \Psi_q(h^*,t+\Delta)$ since $t \in J \subseteq J_p$ and $t + \Delta \in J + \Delta \subseteq J_q$,
		\item $\int_{J_n}h^*_p(\theta)\diff\theta > 0$ for all $n \in \IN$ as $J_n \subseteq J_p$ has positive measure and
		\item $(q,J_n,\frac{\varepsilon}{n},\Delta) \in A_{p}(h^*)$ for all $n \in \IN$ since $h^*_q (t) + \frac{\varepsilon}{n} \leq h^*_q (t) + \varepsilon \leq B_q$ for all $t \in J_n + \Delta \subseteq J_q$.
	\end{itemize}
	By \Cref{lemma:NegativeCharacterization} this implies that $h^*$ is not a \SCDE[full] -- a contradiction to our initial assumption.
\end{proof}

\begin{lemma}
	Assume that \ref{ass:EffectivePathDelayContinuous} holds. If we set $S \coloneqq \Lambda(r)$ and 
		\[A_p(h) \coloneqq \set{(q,J,\varepsilon,0) | q \in \Pc_i, J \in \mathcal{M}([t_0,t_f]), \varepsilon > 0}\]
	for all $h \in S$, $p \in \Pc_i$ and $i \in I$, then, any flow $h^* \in S$ is a \SCDE[full] in the sense of \eqref{eq:CDE} if and only if it is a dynamic equilibrium with fixed inflow rate in the sense of \eqref{eq:de-rate}.
\end{lemma}

\begin{proof}
	First, let $h^*$ be an equilibrium in the sense of \eqref{eq:de-rate}. Then, for any point $t \in [t_0,t_f]$ and walks $p,q \in \Pc_i$ with $\Psi_p(h^*,t) > \Psi_q(h^*,t)$ \cref{ass:EffectivePathDelayContinuous} guarantees the existence of some neighbourhood $[t-\delta,t+\delta]$ of $t$ with $\Psi_p(h^*,t') > \Psi_q(h^*,t')$ for all $t' \in [t-\delta,t+\delta]$. \Cref{eq:de-rate} then implies that $h^*_p(t') = 0$ for almost all $t'$ from this interval and, thus, $U_{p}(h^*,t) = \emptyset$. In particular, we have $q \notin U_{p}(h^*,t)$ which shows that \eqref{eq:CDE} is satisfied by $h^*$.
	
	Now, let $h^*$ be an equilibrium in the sense of \eqref{eq:CDE}. Then, for every time $t \in [t_0,t_f]$ and each pair of walks $p,q$ with $\Psi_p(h^*,t) > \Psi_q(h^*,t)$, we have $q \notin U_{p}(h^*,t)$. As we are in the unconstrained case, this can only be because there exists some $\delta_t > 0$ such that for any $J \subseteq [t-\delta_t,t+\delta_t]$ and $\varepsilon > 0$ we have $\int_J \min\set{h^*_p(t'),\varepsilon}\diff t' = 0$ or, equivalently, $h^*_p(t') = 0$ for almost all $t' \in [t-\delta_t,t+\delta_t]$. Since this is true for all such times $t$, we clearly have
		\[\set{t \in [t_0,t_f] | \Psi_p(h^*,t) > \Psi_q(h^*,t)} \subseteq \bigcup_{t \in [t_0,t_f]:\Psi_p(h^*,t) > \Psi_q(h^*,t)}[t-\delta_t,t+\delta_t].\]
	But then there also exists a countable such covering, \ie a countable set 
		\[K \subseteq \set{t \in [t_0,t_f] | \Psi_p(h^*,t) > \Psi_q(h^*,t)}\]
	such that 
		\[\set{t \in [t_0,t_f] | \Psi_p(h^*,t) > \Psi_q(h^*,t)} \subseteq \bigcup_{t \in K}[t-\delta_t,t+\delta_t].\]
	Therefore, for almost all $t \in \set{t \in [t_0,t_f] | \Psi_p(h^*,t) > \Psi_q(h^*,t)}$ we have $h^*_p(t') = 0$ which shows that $h^*$ satisfies \eqref{eq:de-rate}.
\end{proof}

In general our model requires us to define two objects in order to completely specify a type of side-constraint dynamic equilibrium: The \setS{} $S$ and the \addmEpsDev s $A_p$. We will make use of this flexibility later on (in particular in \Cref{sec:SCviaNL}) but we can also just take any \setS{} $S \subseteq \Lambda(Q)$ and then derive \addmEpsDev s from it: Namely, we can say that a potential \epsDev{} is admissible if and only if it leads to another feasible flow, \ie 
	\begin{align}\label{eq:ApglobalSCDE}
		A_{p}(h) \coloneqq \set{(q,J,\varepsilon,\Delta) | H_{p \to q}(h,J,\varepsilon,\Delta) \in S}
	\end{align}
or, equivalently,
	\[M_i(h) \coloneqq \set{h' \in L^2 ([t_0,t_f])^{\Pc} | \exists p, q, i, J, \varepsilon,\Delta: h' = H_{p \to q}(h,J,\varepsilon,\Delta) \in S}.\]
This imposes a global feasibility constraint on the possible deviations: That is, particles are only allowed to deviate if the resulting alternative flow is feasible for \emph{all} particles (not just the ones deviating). This is a generalization of the capacitated dynamic equilibria defined in \cite{GHP22}. Here, we will call these types of side-constrained dynamic equilibria \emph{\globalSCDE[fulls]{}}.

\begin{definition}\label{def:strongCDE}
	A \emph{\globalSCDE[full] (\globalSCDE)} with respect to some set $S \subseteq \Lambda(Q)$ is a side-constrained dynamic equilibrium \wrt $S$ and \addmEpsDev{}s $A_{p}(h)$ defined by \eqref{eq:ApglobalSCDE}.
\end{definition}